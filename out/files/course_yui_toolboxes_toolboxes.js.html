<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>course&#x2F;yui&#x2F;toolboxes&#x2F;toolboxes.js - Moodle YUI module API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="&#x2F;moodle&#x2F;pix&#x2F;moodlelogo.gif" title="Moodle YUI module API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;classes/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;classes/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;classes/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;classes/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;classes/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;classes/course-resource-toolbox.html">course-resource-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-section-toolbox.html">course-section-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-toolboxes.html">course-toolboxes</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;modules/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;modules/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;modules/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;modules/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;modules/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;modules/course-toolboxes.html">course-toolboxes</a></li>
            
                <li><a href="..&#x2F;modules/enrol-notification.html">enrol-notification</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: course&#x2F;yui&#x2F;toolboxes&#x2F;toolboxes.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Provides toolboxes
 *
 * @module course-toolboxes
 *&#x2F;
YUI.add(&#x27;moodle-course-toolboxes&#x27;, function(Y) {
    WAITICON = {&#x27;pix&#x27;:&quot;i&#x2F;loading_small&quot;,&#x27;component&#x27;:&#x27;moodle&#x27;};
    &#x2F;&#x2F; The CSS selectors we use
    var CSS = {
        ACTIVITYLI : &#x27;li.activity&#x27;,
        COMMANDSPAN : &#x27;span.commands&#x27;,
        SPINNERCOMMANDSPAN : &#x27;span.commands&#x27;,
        CONTENTAFTERLINK : &#x27;div.contentafterlink&#x27;,
        DELETE : &#x27;a.editing_delete&#x27;,
        DIMCLASS : &#x27;dimmed&#x27;,
        DIMMEDTEXT : &#x27;dimmed_text&#x27;,
        EDITTITLE : &#x27;a.editing_title&#x27;,
        EDITTITLECLASS : &#x27;edittitle&#x27;,
        GENERICICONCLASS : &#x27;iconsmall&#x27;,
        GROUPSNONE : &#x27;a.editing_groupsnone&#x27;,
        GROUPSSEPARATE : &#x27;a.editing_groupsseparate&#x27;,
        GROUPSVISIBLE : &#x27;a.editing_groupsvisible&#x27;,
        HASLABEL : &#x27;label&#x27;,
        HIDE : &#x27;a.editing_hide&#x27;,
        HIGHLIGHT : &#x27;a.editing_highlight&#x27;,
        INSTANCENAME : &#x27;span.instancename&#x27;,
        LIGHTBOX : &#x27;lightbox&#x27;,
        MODINDENTCOUNT : &#x27;mod-indent-&#x27;,
        MODINDENTDIV : &#x27;div.mod-indent&#x27;,
        MODINDENTHUGE : &#x27;mod-indent-huge&#x27;,
        MODULEIDPREFIX : &#x27;module-&#x27;,
        MOVELEFT : &#x27;a.editing_moveleft&#x27;,
        MOVELEFTCLASS : &#x27;editing_moveleft&#x27;,
        MOVERIGHT : &#x27;a.editing_moveright&#x27;,
        PAGECONTENT : &#x27;div#page-content&#x27;,
        RIGHTSIDE : &#x27;.right&#x27;,
        SECTIONHIDDENCLASS : &#x27;hidden&#x27;,
        SECTIONIDPREFIX : &#x27;section-&#x27;,
        SECTIONLI : &#x27;li.section&#x27;,
        SHOW : &#x27;a.editing_show&#x27;,
        SHOWHIDE : &#x27;a.editing_showhide&#x27;,
        CONDITIONALHIDDEN : &#x27;conditionalhidden&#x27;,
        AVAILABILITYINFODIV : &#x27;div.availabilityinfo&#x27;,
        SHOWCLASS : &#x27;editing_show&#x27;,
        HIDECLASS : &#x27;hide&#x27;
    };

    &#x2F;**
     * The toolbox classes
     *
     * TOOLBOX is a generic class which should never be directly instantiated
     * RESOURCETOOLBOX is a class extending TOOLBOX containing code specific to resources
     * SECTIONTOOLBOX is a class extending TOOLBOX containing code specific to sections
     *
     * @class course-toolboxes
     * @constructor
     *&#x2F;
    var TOOLBOX = function() {
        TOOLBOX.superclass.constructor.apply(this, arguments);
    }

    Y.extend(TOOLBOX, Y.Base, {
        &#x2F;**
         * Toggle the visibility and availability for the specified
         * resource show&#x2F;hide button
         *
         * @method toggle_hide_resource_ui
         * @param {Node|String} button The button to toggle
         *&#x2F;
        toggle_hide_resource_ui : function(button) {
            var element = button.ancestor(CSS.ACTIVITYLI);
            var hideicon = button.one(&#x27;img&#x27;);

            var dimarea;
            var toggle_class;
            if (this.is_label(element)) {
                toggle_class = CSS.DIMMEDTEXT;
                dimarea = element.one(CSS.MODINDENTDIV + &#x27; div&#x27;);
            } else {
                toggle_class = CSS.DIMCLASS;
                dimarea = element.one(&#x27;a&#x27;);
            }

            var status = &#x27;&#x27;;
            var value;
            if (button.hasClass(CSS.SHOWCLASS)) {
                status = &#x27;hide&#x27;;
                value = 1;
            } else {
                status = &#x27;show&#x27;;
                value = 0;
            }
            &#x2F;&#x2F; Update button info.
            var newstring = M.util.get_string(status, &#x27;moodle&#x27;);
            hideicon.setAttrs({
                &#x27;alt&#x27; : newstring,
                &#x27;src&#x27;   : M.util.image_url(&#x27;t&#x2F;&#x27; + status)
            });
            button.set(&#x27;title&#x27;, newstring);
            button.set(&#x27;className&#x27;, &#x27;editing_&#x27;+status);

            &#x2F;&#x2F; If activity is conditionally hidden, then don&#x27;t toggle.
            if (!dimarea.hasClass(CSS.CONDITIONALHIDDEN)) {
                &#x2F;&#x2F; Change the UI.
                dimarea.toggleClass(toggle_class);
                &#x2F;&#x2F; We need to toggle dimming on the description too.
                element.all(CSS.CONTENTAFTERLINK).toggleClass(CSS.DIMMEDTEXT);
            }
            &#x2F;&#x2F; Toggle availablity info for conditional activities.
            var availabilityinfo = element.one(CSS.AVAILABILITYINFODIV);

            if (availabilityinfo) {
                availabilityinfo.toggleClass(CSS.HIDECLASS);
            }
            return value;
        },
        &#x2F;**
         * Send a request using the REST API
         *
         * @method send_request
         * @param {Object} data The data to submit
         * @param {Node} statusspinner (optional) A statusspinner which may contain a section
         * loader
         * @param {Object} optionalconfig (optional) Any additional configuration to submit
         * @return response responseText field from responce
         *&#x2F;
        send_request : function(data, statusspinner, optionalconfig) {
            &#x2F;&#x2F; Default data structure
            if (!data) {
                data = {};
            }
            &#x2F;&#x2F; Handle any variables which we must pass back through to
            var pageparams = this.get(&#x27;config&#x27;).pageparams;
            for (varname in pageparams) {
                data[varname] = pageparams[varname];
            }

            data.sesskey = M.cfg.sesskey;
            data.courseId = this.get(&#x27;courseid&#x27;);

            var uri = M.cfg.wwwroot + this.get(&#x27;ajaxurl&#x27;);

            &#x2F;&#x2F; Define the configuration to send with the request
            var responsetext = [];
            var config = {
                method: &#x27;POST&#x27;,
                data: data,
                on: {
                    success: function(tid, response) {
                        try {
                            responsetext = Y.JSON.parse(response.responseText);
                            if (responsetext.error) {
                                new M.core.ajaxException(responsetext);
                            }
                        } catch (e) {}
                        if (statusspinner) {
                            window.setTimeout(function(e) {
                                statusspinner.hide();
                            }, 400);
                        }
                    },
                    failure : function(tid, response) {
                        if (statusspinner) {
                            statusspinner.hide();
                        }
                        new M.core.ajaxException(response);
                    }
                },
                context: this,
                sync: true
            }

            &#x2F;&#x2F; Apply optional config
            if (optionalconfig) {
                for (varname in optionalconfig) {
                    config[varname] = optionalconfig[varname];
                }
            }

            if (statusspinner) {
                statusspinner.show();
            }

            &#x2F;&#x2F; Send the request
            Y.io(uri, config);
            return responsetext;
        },
        is_label : function(target) {
            return target.hasClass(CSS.HASLABEL);
        },
        &#x2F;**
         * Return the module ID for the specified element
         *
         * @method get_element_id
         * @param {Node} element The &lt;li&gt; element to determine a module-id number for
         * @return {String} The module ID
         *&#x2F;
        get_element_id : function(element) {
            return element.get(&#x27;id&#x27;).replace(CSS.MODULEIDPREFIX, &#x27;&#x27;);
        },
        &#x2F;**
         * Return the module ID for the specified element
         *
         * @method get_section_id
         * @param {Node} element The &lt;li&gt; element to determine a module-id number for
         * @return {String} The module ID
         *&#x2F;
        get_section_id : function(section) {
            return section.get(&#x27;id&#x27;).replace(CSS.SECTIONIDPREFIX, &#x27;&#x27;);
        }
    },
    {
        NAME : &#x27;course-toolbox&#x27;,
        ATTRS : {
            &#x2F;&#x2F; The ID of the current course
            courseid : {
                &#x27;value&#x27; : 0
            },
            ajaxurl : {
                &#x27;value&#x27; : 0
            },
            config : {
                &#x27;value&#x27; : 0
            }
        }
    }
    );


    var RESOURCETOOLBOX = function() {
        RESOURCETOOLBOX.superclass.constructor.apply(this, arguments);
    }

    &#x2F;**
     * The resourcetoolbox
     *
     * TOOLBOX is a generic class which should never be directly instantiated
     * RESOURCETOOLBOX is a class extending TOOLBOX containing code specific to resources
     * SECTIONTOOLBOX is a class extending TOOLBOX containing code specific to sections
     *
     * @class course-resource-toolbox
     * @constructor
     *&#x2F;
    Y.extend(RESOURCETOOLBOX, TOOLBOX, {
        &#x2F;&#x2F; Variables
        GROUPS_NONE     : 0,
        GROUPS_SEPARATE : 1,
        GROUPS_VISIBLE  : 2,

        &#x2F;**
         * Initialize the resource toolbox
         * Updates all span.commands with relevant handlers and other required changes
         *
         * @method initializer
         *&#x2F;
        initializer : function(config) {
            this.setup_for_resource();
            M.course.coursebase.register_module(this);

            var prefix = CSS.ACTIVITYLI + &#x27; &#x27; + CSS.COMMANDSPAN + &#x27; &#x27;;
            Y.delegate(&#x27;click&#x27;, this.edit_resource_title, CSS.PAGECONTENT, prefix + CSS.EDITTITLE, this);
            Y.delegate(&#x27;click&#x27;, this.move_left, CSS.PAGECONTENT, prefix + CSS.MOVELEFT, this);
            Y.delegate(&#x27;click&#x27;, this.move_right, CSS.PAGECONTENT, prefix + CSS.MOVERIGHT, this);
            Y.delegate(&#x27;click&#x27;, this.delete_resource, CSS.PAGECONTENT, prefix + CSS.DELETE, this);
            Y.delegate(&#x27;click&#x27;, this.toggle_hide_resource, CSS.PAGECONTENT, prefix + CSS.HIDE, this);
            Y.delegate(&#x27;click&#x27;, this.toggle_hide_resource, CSS.PAGECONTENT, prefix + CSS.SHOW, this);
            Y.delegate(&#x27;click&#x27;, this.toggle_groupmode, CSS.PAGECONTENT, prefix + CSS.GROUPSNONE, this);
            Y.delegate(&#x27;click&#x27;, this.toggle_groupmode, CSS.PAGECONTENT, prefix + CSS.GROUPSSEPARATE, this);
            Y.delegate(&#x27;click&#x27;, this.toggle_groupmode, CSS.PAGECONTENT, prefix + CSS.GROUPSVISIBLE, this);
        },

        &#x2F;**
         * Update any span.commands within the scope of the specified
         * selector with AJAX equivelants
         *
         * @method setup_for_resource
         * @param {Node|String} baseselector The selector to limit scope to
         *&#x2F;
        setup_for_resource : function(baseselector) {
            if (!baseselector) {
                var baseselector = CSS.PAGECONTENT + &#x27; &#x27; + CSS.ACTIVITYLI;
            }

            Y.all(baseselector).each(this._setup_for_resource, this);
        },
        _setup_for_resource : function(toolboxtarget) {
            toolboxtarget = Y.one(toolboxtarget);
            &#x2F;&#x2F; &quot;Disable&quot; show&#x2F;hide icons (change cursor to not look clickable) if section is hidden
            var showhide = toolboxtarget.all(CSS.COMMANDSPAN + &#x27; &#x27; + CSS.HIDE);
            showhide.concat(toolboxtarget.all(CSS.COMMANDSPAN + &#x27; &#x27; + CSS.SHOW));
            showhide.each(function(node) {
                var section = node.ancestor(CSS.SECTIONLI);
                if (section &amp;&amp; section.hasClass(CSS.SECTIONHIDDENCLASS)) {
                    node.setStyle(&#x27;cursor&#x27;, &#x27;auto&#x27;);
                }
            });

            &#x2F;&#x2F; Set groupmode attribute for use by this.toggle_groupmode()
            var groups;
            groups = toolboxtarget.all(CSS.COMMANDSPAN + &#x27; &#x27; + CSS.GROUPSNONE);
            groups.setAttribute(&#x27;groupmode&#x27;, this.GROUPS_NONE);

            groups = toolboxtarget.all(CSS.COMMANDSPAN + &#x27; &#x27; + CSS.GROUPSSEPARATE);
            groups.setAttribute(&#x27;groupmode&#x27;, this.GROUPS_SEPARATE);

            groups = toolboxtarget.all(CSS.COMMANDSPAN + &#x27; &#x27; + CSS.GROUPSVISIBLE);
            groups.setAttribute(&#x27;groupmode&#x27;, this.GROUPS_VISIBLE);
        },
        move_left : function(e) {
            this.move_leftright(e, -1);
        },
        move_right : function(e) {
            this.move_leftright(e, 1);
        },
        move_leftright : function(e, direction) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Get the element we&#x27;re working on
            var element = e.target.ancestor(CSS.ACTIVITYLI);

            &#x2F;&#x2F; And we need to determine the current and new indent level
            var indentdiv = element.one(CSS.MODINDENTDIV);
            var indent = indentdiv.getAttribute(&#x27;class&#x27;).match(&#x2F;mod-indent-(\d{1,})&#x2F;);

            if (indent) {
                var oldindent = parseInt(indent[1]);
                var newindent = Math.max(0, (oldindent + parseInt(direction)));
                indentdiv.removeClass(indent[0]);
            } else {
                var oldindent = 0;
                var newindent = 1;
            }

            &#x2F;&#x2F; Perform the move
            indentdiv.addClass(CSS.MODINDENTCOUNT + newindent);
            var data = {
                &#x27;class&#x27; : &#x27;resource&#x27;,
                &#x27;field&#x27; : &#x27;indent&#x27;,
                &#x27;value&#x27; : newindent,
                &#x27;id&#x27;    : this.get_element_id(element)
            };
            var spinner = M.util.add_spinner(Y, element.one(CSS.SPINNERCOMMANDSPAN));
            this.send_request(data, spinner);

            &#x2F;&#x2F; Handle removal&#x2F;addition of the moveleft button
            if (newindent == 0) {
                element.one(CSS.MOVELEFT).remove();
            } else if (newindent == 1 &amp;&amp; oldindent == 0) {
                this.add_moveleft(element);
            }

            &#x2F;&#x2F; Handle massive indentation to match non-ajax display
            var hashugeclass = indentdiv.hasClass(CSS.MODINDENTHUGE);
            if (newindent &gt; 15 &amp;&amp; !hashugeclass) {
                indentdiv.addClass(CSS.MODINDENTHUGE);
            } else if (newindent &lt;= 15 &amp;&amp; hashugeclass) {
                indentdiv.removeClass(CSS.MODINDENTHUGE);
            }
        },
        delete_resource : function(e) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Get the element we&#x27;re working on
            var element   = e.target.ancestor(CSS.ACTIVITYLI);

            var confirmstring = &#x27;&#x27;;
            if (this.is_label(element)) {
                &#x2F;&#x2F; Labels are slightly different to other activities
                var plugindata = {
                    type : M.util.get_string(&#x27;pluginname&#x27;, &#x27;label&#x27;)
                }
                confirmstring = M.util.get_string(&#x27;deletechecktype&#x27;, &#x27;moodle&#x27;, plugindata)
            } else {
                var plugindata = {
                    type : M.util.get_string(&#x27;pluginname&#x27;, element.getAttribute(&#x27;class&#x27;).match(&#x2F;modtype_([^\s]*)&#x2F;)[1]),
                    name : element.one(CSS.INSTANCENAME).get(&#x27;firstChild&#x27;).get(&#x27;data&#x27;)
                }
                confirmstring = M.util.get_string(&#x27;deletechecktypename&#x27;, &#x27;moodle&#x27;, plugindata);
            }

            &#x2F;&#x2F; Confirm element removal
            if (!confirm(confirmstring)) {
                return false;
            }

            &#x2F;&#x2F; Actually remove the element
            element.remove();
            var data = {
                &#x27;class&#x27; : &#x27;resource&#x27;,
                &#x27;action&#x27; : &#x27;DELETE&#x27;,
                &#x27;id&#x27;    : this.get_element_id(element)
            };
            this.send_request(data);
        },
        toggle_hide_resource : function(e) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Return early if the current section is hidden
            var section = e.target.ancestor(M.course.format.get_section_selector(Y));
            if (section &amp;&amp; section.hasClass(CSS.SECTIONHIDDENCLASS)) {
                return;
            }

            &#x2F;&#x2F; Get the element we&#x27;re working on
            var element = e.target.ancestor(CSS.ACTIVITYLI);

            var button = e.target.ancestor(&#x27;a&#x27;, true);

            var value = this.toggle_hide_resource_ui(button);

            &#x2F;&#x2F; Send the request
            var data = {
                &#x27;class&#x27; : &#x27;resource&#x27;,
                &#x27;field&#x27; : &#x27;visible&#x27;,
                &#x27;value&#x27; : value,
                &#x27;id&#x27;    : this.get_element_id(element)
            };
            var spinner = M.util.add_spinner(Y, element.one(CSS.SPINNERCOMMANDSPAN));
            this.send_request(data, spinner);
            return false; &#x2F;&#x2F; Need to return false to stop the delegate for the new state firing
        },
        toggle_groupmode : function(e) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Get the element we&#x27;re working on
            var element = e.target.ancestor(CSS.ACTIVITYLI);

            var button = e.target.ancestor(&#x27;a&#x27;, true);
            var icon = button.one(&#x27;img&#x27;);

            &#x2F;&#x2F; Current Mode
            var groupmode = button.getAttribute(&#x27;groupmode&#x27;);
            groupmode++;
            if (groupmode &gt; 2) {
                groupmode = 0;
            }
            button.setAttribute(&#x27;groupmode&#x27;, groupmode);

            var newtitle = &#x27;&#x27;;
            var iconsrc = &#x27;&#x27;;
            switch (groupmode) {
                case this.GROUPS_NONE:
                    newtitle = &#x27;groupsnone&#x27;;
                    iconsrc = M.util.image_url(&#x27;t&#x2F;groupn&#x27;);
                    break;
                case this.GROUPS_SEPARATE:
                    newtitle = &#x27;groupsseparate&#x27;;
                    iconsrc = M.util.image_url(&#x27;t&#x2F;groups&#x27;);
                    break;
                case this.GROUPS_VISIBLE:
                    newtitle = &#x27;groupsvisible&#x27;;
                    iconsrc = M.util.image_url(&#x27;t&#x2F;groupv&#x27;);
                    break;
            }
            newtitle = M.util.get_string(&#x27;clicktochangeinbrackets&#x27;, &#x27;moodle&#x27;,
                    M.util.get_string(newtitle, &#x27;moodle&#x27;));

            &#x2F;&#x2F; Change the UI
            icon.setAttrs({
                &#x27;alt&#x27; : newtitle,
                &#x27;src&#x27; : iconsrc
            });
            button.setAttribute(&#x27;title&#x27;, newtitle);

            &#x2F;&#x2F; And send the request
            var data = {
                &#x27;class&#x27; : &#x27;resource&#x27;,
                &#x27;field&#x27; : &#x27;groupmode&#x27;,
                &#x27;value&#x27; : groupmode,
                &#x27;id&#x27;    : this.get_element_id(element)
            };
            var spinner = M.util.add_spinner(Y, element.one(CSS.SPINNERCOMMANDSPAN));
            this.send_request(data, spinner);
            return false; &#x2F;&#x2F; Need to return false to stop the delegate for the new state firing
        },
        &#x2F;**
         * Add the moveleft button
         * This is required after moving left from an initial position of 0
         *
         * @method add_moveleft
         * @param {Node} target The encapsulating &lt;li&gt; element
         *&#x2F;
        add_moveleft : function(target) {
            var left_string = M.util.get_string(&#x27;moveleft&#x27;, &#x27;moodle&#x27;);
            var moveimage = &#x27;t&#x2F;left&#x27;; &#x2F;&#x2F; ltr mode
            if ( Y.one(document.body).hasClass(&#x27;dir-rtl&#x27;) ) {
                moveimage = &#x27;t&#x2F;right&#x27;;
            } else {
                moveimage = &#x27;t&#x2F;left&#x27;;
            }
            var newicon = Y.Node.create(&#x27;&lt;img &#x2F;&gt;&#x27;)
                .addClass(CSS.GENERICICONCLASS)
                .setAttrs({
                    &#x27;src&#x27;   : M.util.image_url(moveimage, &#x27;moodle&#x27;),
                    &#x27;alt&#x27;   : left_string
                });
            var moveright = target.one(CSS.MOVERIGHT);
            var newlink = moveright.getAttribute(&#x27;href&#x27;).replace(&#x27;indent=1&#x27;, &#x27;indent=-1&#x27;);
            var anchor = new Y.Node.create(&#x27;&lt;a &#x2F;&gt;&#x27;)
                .setStyle(&#x27;cursor&#x27;, &#x27;pointer&#x27;)
                .addClass(CSS.MOVELEFTCLASS)
                .setAttribute(&#x27;href&#x27;, newlink)
                .setAttribute(&#x27;title&#x27;, left_string);
            anchor.appendChild(newicon);
            moveright.insert(anchor, &#x27;before&#x27;);
        },
        &#x2F;**
         * Edit the title for the resource
         *
         * @method edit_resource_title
         * @param {EventHandle} e The event triggering the action
         *&#x2F;
        edit_resource_title : function(e) {
            &#x2F;&#x2F; Get the element we&#x27;re working on
            var element = e.target.ancestor(CSS.ACTIVITYLI);
            var elementdiv = element.one(&#x27;div&#x27;);
            var instancename  = element.one(CSS.INSTANCENAME);
            var currenttitle = instancename.get(&#x27;firstChild&#x27;);
            var oldtitle = currenttitle.get(&#x27;data&#x27;);
            var titletext = oldtitle;
            var editbutton = element.one(&#x27;a.&#x27; + CSS.EDITTITLECLASS + &#x27; img&#x27;);

            &#x2F;&#x2F; Handle events for edit_resource_title
            var listenevents = [];
            var thisevent;

            &#x2F;&#x2F; Grab the anchor so that we can swap it with the edit form
            var anchor = instancename.ancestor(&#x27;a&#x27;);

            var data = {
                &#x27;class&#x27;   : &#x27;resource&#x27;,
                &#x27;field&#x27;   : &#x27;gettitle&#x27;,
                &#x27;id&#x27;      : this.get_element_id(element)
            };

            &#x2F;&#x2F; Try to retrieve the existing string from the server
            var response = this.send_request(data, editbutton);
            if (response.instancename) {
                titletext = response.instancename;
            }

            &#x2F;&#x2F; Create the editor and submit button
            var editor = Y.Node.create(&#x27;&lt;input &#x2F;&gt;&#x27;)
                .setAttrs({
                    &#x27;name&#x27;  : &#x27;title&#x27;,
                    &#x27;value&#x27; : titletext,
                    &#x27;autocomplete&#x27; : &#x27;off&#x27;
                })
                .addClass(&#x27;titleeditor&#x27;);
            var editform = Y.Node.create(&#x27;&lt;form &#x2F;&gt;&#x27;)
                .addClass(&#x27;activityinstance&#x27;)
                .setAttribute(&#x27;action&#x27;, &#x27;#&#x27;);
            var editinstructions = Y.Node.create(&#x27;&lt;span &#x2F;&gt;&#x27;)
                .addClass(&#x27;editinstructions&#x27;)
                .set(&#x27;innerHTML&#x27;, M.util.get_string(&#x27;edittitleinstructions&#x27;, &#x27;moodle&#x27;));
            var activityicon = element.one(&#x27;img.activityicon&#x27;).cloneNode();

            &#x2F;&#x2F; Clear the existing content and put the editor in
            currenttitle.set(&#x27;data&#x27;, &#x27;&#x27;);
            editform.appendChild(activityicon);
            editform.appendChild(editor);
            anchor.replace(editform);
            elementdiv.appendChild(editinstructions);
            e.preventDefault();

            &#x2F;&#x2F; Focus and select the editor text
            editor.focus().select();

            &#x2F;&#x2F; Handle removal of the editor
            var clear_edittitle = function() {
                &#x2F;&#x2F; Detach all listen events to prevent duplicate triggers
                var thisevent;
                while (thisevent = listenevents.shift()) {
                    thisevent.detach();
                }

                if (editinstructions) {
                    &#x2F;&#x2F; Convert back to anchor and remove instructions
                    editform.replace(anchor);
                    editinstructions.remove();
                    editinstructions = null;
                }
            }

            &#x2F;&#x2F; Handle cancellation of the editor
            var cancel_edittitle = function(e) {
                clear_edittitle();

                &#x2F;&#x2F; Set the title and anchor back to their previous settings
                currenttitle.set(&#x27;data&#x27;, oldtitle);
            };

            &#x2F;&#x2F; Cancel the edit if we lose focus or the escape key is pressed
            thisevent = editor.on(&#x27;blur&#x27;, cancel_edittitle);
            listenevents.push(thisevent);
            thisevent = Y.one(&#x27;document&#x27;).on(&#x27;keyup&#x27;, function(e) {
                if (e.keyCode == 27) {
                    cancel_edittitle(e);
                }
            });
            listenevents.push(thisevent);

            &#x2F;&#x2F; Handle form submission
            thisevent = editform.on(&#x27;submit&#x27;, function(e) {
                &#x2F;&#x2F; We don&#x27;t actually want to submit anything
                e.preventDefault();

                &#x2F;&#x2F; Clear the edit title boxes
                clear_edittitle();

                &#x2F;&#x2F; We only accept strings which have valid content
                var newtitle = Y.Lang.trim(editor.get(&#x27;value&#x27;));
                if (newtitle != null &amp;&amp; newtitle != &quot;&quot; &amp;&amp; newtitle != titletext) {
                    var data = {
                        &#x27;class&#x27;   : &#x27;resource&#x27;,
                        &#x27;field&#x27;   : &#x27;updatetitle&#x27;,
                        &#x27;title&#x27;   : newtitle,
                        &#x27;id&#x27;      : this.get_element_id(element)
                    };
                    var response = this.send_request(data, editbutton);
                    if (response.instancename) {
                        currenttitle.set(&#x27;data&#x27;, response.instancename);
                    }
                } else {
                    &#x2F;&#x2F; Invalid content. Set the title back to it&#x27;s original contents
                    currenttitle.set(&#x27;data&#x27;, oldtitle);
                }
            }, this);
            listenevents.push(thisevent);
        }
    }, {
        NAME : &#x27;course-resource-toolbox&#x27;,
        ATTRS : {
            courseid : {
                &#x27;value&#x27; : 0
            },
            format : {
                &#x27;value&#x27; : &#x27;topics&#x27;
            }
        }
    });

    var SECTIONTOOLBOX = function() {
        SECTIONTOOLBOX.superclass.constructor.apply(this, arguments);
    }

    &#x2F;**
     * The section toolbox
     *
     * The course-section-toolbox extends course-toolbox to provide
     *
     * @class course-section-toolbox
     * @constructor
     *&#x2F;
    Y.extend(SECTIONTOOLBOX, TOOLBOX, {
        &#x2F;**
         * Updates all span.commands with relevant handlers and other required changes.
         *
         * @method initializer
         *&#x2F;
        initializer : function(config) {
            this.setup_for_section();
            M.course.coursebase.register_module(this);

            &#x2F;&#x2F; Section Highlighting
            Y.delegate(&#x27;click&#x27;, this.toggle_highlight, CSS.PAGECONTENT, CSS.SECTIONLI + &#x27; &#x27; + CSS.HIGHLIGHT, this);
            &#x2F;&#x2F; Section Visibility
            Y.delegate(&#x27;click&#x27;, this.toggle_hide_section, CSS.PAGECONTENT, CSS.SECTIONLI + &#x27; &#x27; + CSS.SHOWHIDE, this);
        },
        &#x2F;**
         * Update any section areas within the scope of the specified
         * selector with AJAX equivelants
         *
         * @method setup_for_section
         * @param {Node|String} baseselector The selector to limit scope to
         *&#x2F;
        setup_for_section : function(baseselector) {
            &#x2F;&#x2F; Left here for potential future use - not currently needed due to YUI delegation in initializer()
            &#x2F;*if (!baseselector) {
                var baseselector = CSS.PAGECONTENT;
            }

            Y.all(baseselector).each(this._setup_for_section, this);*&#x2F;
        },
        _setup_for_section : function(toolboxtarget) {
            &#x2F;&#x2F; Left here for potential future use - not currently needed due to YUI delegation in initializer()
        },
        toggle_hide_section : function(e) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Get the section we&#x27;re working on
            var section = e.target.ancestor(M.course.format.get_section_selector(Y));
            var button = e.target.ancestor(&#x27;a&#x27;, true);
            var hideicon = button.one(&#x27;img&#x27;);

            &#x2F;&#x2F; The value to submit
            var value;
            &#x2F;&#x2F; The status text for strings and images
            var status;

            if (!section.hasClass(CSS.SECTIONHIDDENCLASS)) {
                section.addClass(CSS.SECTIONHIDDENCLASS);
                value = 0;
                status = &#x27;show&#x27;;

            } else {
                section.removeClass(CSS.SECTIONHIDDENCLASS);
                value = 1;
                status = &#x27;hide&#x27;;
            }

            var newstring = M.util.get_string(status + &#x27;fromothers&#x27;, &#x27;format_&#x27; + this.get(&#x27;format&#x27;));
            hideicon.setAttrs({
                &#x27;alt&#x27; : newstring,
                &#x27;src&#x27;   : M.util.image_url(&#x27;i&#x2F;&#x27; + status)
            });
            button.set(&#x27;title&#x27;, newstring);

            &#x2F;&#x2F; Change the highlight status
            var data = {
                &#x27;class&#x27; : &#x27;section&#x27;,
                &#x27;field&#x27; : &#x27;visible&#x27;,
                &#x27;id&#x27;    : this.get_section_id(section.ancestor(M.course.format.get_section_wrapper(Y), true)),
                &#x27;value&#x27; : value
            };

            var lightbox = M.util.add_lightbox(Y, section);
            lightbox.show();

            var response = this.send_request(data, lightbox);

            var activities = section.all(CSS.ACTIVITYLI);
            activities.each(function(node) {
                if (node.one(CSS.SHOW)) {
                    var button = node.one(CSS.SHOW);
                } else {
                    var button = node.one(CSS.HIDE);
                }
                var activityid = this.get_element_id(node);

                if (Y.Array.indexOf(response.resourcestotoggle, activityid) != -1) {
                    this.toggle_hide_resource_ui(button);
                }

                if (value == 0) {
                    button.setStyle(&#x27;cursor&#x27;, &#x27;auto&#x27;);
                } else {
                    button.setStyle(&#x27;cursor&#x27;, &#x27;pointer&#x27;);
                }
            }, this);
        },
        toggle_highlight : function(e) {
            &#x2F;&#x2F; Prevent the default button action
            e.preventDefault();

            &#x2F;&#x2F; Get the section we&#x27;re working on
            var section = e.target.ancestor(M.course.format.get_section_selector(Y));
            var button = e.target.ancestor(&#x27;a&#x27;, true);
            var buttonicon = button.one(&#x27;img&#x27;);

            &#x2F;&#x2F; Determine whether the marker is currently set
            var togglestatus = section.hasClass(&#x27;current&#x27;);
            var value = 0;

            &#x2F;&#x2F; Set the current highlighted item text
            var old_string = M.util.get_string(&#x27;markthistopic&#x27;, &#x27;moodle&#x27;);
            Y.one(CSS.PAGECONTENT)
                .all(M.course.format.get_section_selector(Y) + &#x27;.current &#x27; + CSS.HIGHLIGHT)
                .set(&#x27;title&#x27;, old_string);
            Y.one(CSS.PAGECONTENT)
                .all(M.course.format.get_section_selector(Y) + &#x27;.current &#x27; + CSS.HIGHLIGHT + &#x27; img&#x27;)
                .set(&#x27;alt&#x27;, old_string)
                .set(&#x27;src&#x27;, M.util.image_url(&#x27;i&#x2F;marker&#x27;));

            &#x2F;&#x2F; Remove the highlighting from all sections
            var allsections = Y.one(CSS.PAGECONTENT).all(M.course.format.get_section_selector(Y))
                .removeClass(&#x27;current&#x27;);

            &#x2F;&#x2F; Then add it if required to the selected section
            if (!togglestatus) {
                section.addClass(&#x27;current&#x27;);
                value = this.get_section_id(section.ancestor(M.course.format.get_section_wrapper(Y), true));
                var new_string = M.util.get_string(&#x27;markedthistopic&#x27;, &#x27;moodle&#x27;);
                button
                    .set(&#x27;title&#x27;, new_string);
                buttonicon
                    .set(&#x27;alt&#x27;, new_string)
                    .set(&#x27;src&#x27;, M.util.image_url(&#x27;i&#x2F;marked&#x27;));
            }

            &#x2F;&#x2F; Change the highlight status
            var data = {
                &#x27;class&#x27; : &#x27;course&#x27;,
                &#x27;field&#x27; : &#x27;marker&#x27;,
                &#x27;value&#x27; : value
            };
            var lightbox = M.util.add_lightbox(Y, section);
            lightbox.show();
            this.send_request(data, lightbox);
        }
    }, {
        NAME : &#x27;course-section-toolbox&#x27;,
        ATTRS : {
            courseid : {
                &#x27;value&#x27; : 0
            },
            format : {
                &#x27;value&#x27; : &#x27;topics&#x27;
            }
        }
    });

    M.course = M.course || {};

    M.course.init_resource_toolbox = function(config) {
        return new RESOURCETOOLBOX(config);
    };

    M.course.init_section_toolbox = function(config) {
        return new SECTIONTOOLBOX(config);
    };

},
&#x27;@VERSION@&#x27;, {
    requires : [&#x27;base&#x27;, &#x27;node&#x27;, &#x27;io&#x27;, &#x27;moodle-course-coursebase&#x27;]
}
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
