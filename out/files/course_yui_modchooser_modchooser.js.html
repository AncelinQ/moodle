<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>course&#x2F;yui&#x2F;modchooser&#x2F;modchooser.js - Moodle YUI module API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="&#x2F;moodle&#x2F;pix&#x2F;moodlelogo.gif" title="Moodle YUI module API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;classes/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;classes/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;classes/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;classes/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;classes/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;classes/course-resource-toolbox.html">course-resource-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-section-toolbox.html">course-section-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-toolboxes.html">course-toolboxes</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;modules/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;modules/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;modules/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;modules/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;modules/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;modules/course-toolboxes.html">course-toolboxes</a></li>
            
                <li><a href="..&#x2F;modules/enrol-notification.html">enrol-notification</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: course&#x2F;yui&#x2F;modchooser&#x2F;modchooser.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
YUI.add(&#x27;moodle-course-modchooser&#x27;, function(Y) {
    var CSS = {
        PAGECONTENT : &#x27;div#page-content&#x27;,
        SECTION : &#x27;li.section&#x27;,
        SECTIONMODCHOOSER : &#x27;span.section-modchooser-link&#x27;,
        SITEMENU : &#x27;div.block_site_main_menu&#x27;,
        SITETOPIC : &#x27;div.sitetopic&#x27;
    };

    var MODCHOOSERNAME = &#x27;course-modchooser&#x27;;

    var MODCHOOSER = function() {
        MODCHOOSER.superclass.constructor.apply(this, arguments);
    }

    Y.extend(MODCHOOSER, M.core.chooserdialogue, {
        &#x2F;&#x2F; The current section ID
        sectionid : null,

        &#x2F;&#x2F; The hidden element holding the jump param
        jumplink : null,

        initializer : function(config) {
            var dialogue = Y.one(&#x27;.chooserdialoguebody&#x27;);
            var header = Y.one(&#x27;.choosertitle&#x27;);
            var params = {};
            this.setup_chooser_dialogue(dialogue, header, params);

            &#x2F;&#x2F; Initialize existing sections and register for dynamically created sections
            this.setup_for_section();
            M.course.coursebase.register_module(this);

            &#x2F;&#x2F; Catch the page toggle
            Y.all(&#x27;.block_settings #settingsnav .type_course .modchoosertoggle a&#x27;).on(&#x27;click&#x27;, this.toggle_mod_chooser, this);
        },
        &#x2F;**
         * Update any section areas within the scope of the specified
         * selector with AJAX equivalents
         *
         * @method setup_for_section
         * @param {Node|String} baseselector The selector to limit scope to
         *&#x2F;
        setup_for_section : function(baseselector) {
            if (!baseselector) {
                var baseselector = CSS.PAGECONTENT;
            }

            &#x2F;&#x2F; Setup for site topics
            Y.one(baseselector).all(CSS.SITETOPIC).each(function(section) {
                this._setup_for_section(section);
            }, this);

            &#x2F;&#x2F; Setup for standard course topics
            Y.one(baseselector).all(CSS.SECTION).each(function(section) {
                this._setup_for_section(section);
            }, this);

            &#x2F;&#x2F; Setup for the block site menu
            Y.one(baseselector).all(CSS.SITEMENU).each(function(section) {
                this._setup_for_section(section);
            }, this);
        },
        _setup_for_section : function(section, sectionid) {
            var chooserspan = section.one(CSS.SECTIONMODCHOOSER);
            if (!chooserspan) {
                return;
            }
            var chooserlink = Y.Node.create(&quot;&lt;a href=&#x27;#&#x27; &#x2F;&gt;&quot;);
            chooserspan.get(&#x27;children&#x27;).each(function(node) {
                chooserlink.appendChild(node);
            });
            chooserspan.insertBefore(chooserlink);
            chooserlink.on(&#x27;click&#x27;, this.display_mod_chooser, this);
        },
        &#x2F;**
         * Display the module chooser
         *
         * @method dialogue
         * @param {EventHandle} e Event Triggering Event
         *&#x2F;
        display_mod_chooser : function (e) {
            &#x2F;&#x2F; Set the section for this version of the dialogue
            if (e.target.ancestor(CSS.SITETOPIC)) {
                &#x2F;&#x2F; The site topic has a sectionid of 1
                this.sectionid = 1;
            } else if (e.target.ancestor(CSS.SECTION)) {
                var section = e.target.ancestor(CSS.SECTION);
                this.sectionid = section.get(&#x27;id&#x27;).replace(&#x27;section-&#x27;, &#x27;&#x27;);
            } else if (e.target.ancestor(CSS.SITEMENU)) {
                &#x2F;&#x2F; The block site menu has a sectionid of 0
                this.sectionid = 0;
            }
            this.display_chooser(e);
        },
        toggle_mod_chooser : function(e) {
            &#x2F;&#x2F; Get the add section link
            var modchooserlinks = Y.all(&#x27;div.addresourcemodchooser&#x27;);

            &#x2F;&#x2F; Get the dropdowns
            var dropdowns = Y.all(&#x27;div.addresourcedropdown&#x27;);

            if (modchooserlinks.size() == 0) {
                &#x2F;&#x2F; Continue with non-js action if there are no modchoosers to add
                return;
            }

            &#x2F;&#x2F; We need to update the text and link
            var togglelink = Y.one(&#x27;.block_settings #settingsnav .type_course .modchoosertoggle a&#x27;);

            &#x2F;&#x2F; The actual text is in the last child
            var toggletext = togglelink.get(&#x27;lastChild&#x27;);

            var usemodchooser;
            &#x2F;&#x2F; Determine whether they&#x27;re currently hidden
            if (modchooserlinks.item(0).hasClass(&#x27;visibleifjs&#x27;)) {
                &#x2F;&#x2F; The modchooser is currently visible, hide it
                usemodchooser = 0;
                modchooserlinks
                    .removeClass(&#x27;visibleifjs&#x27;)
                    .addClass(&#x27;hiddenifjs&#x27;);
                dropdowns
                    .addClass(&#x27;visibleifjs&#x27;)
                    .removeClass(&#x27;hiddenifjs&#x27;);
                toggletext.set(&#x27;data&#x27;, M.util.get_string(&#x27;modchooserenable&#x27;, &#x27;moodle&#x27;));
                togglelink.set(&#x27;href&#x27;, togglelink.get(&#x27;href&#x27;).replace(&#x27;off&#x27;, &#x27;on&#x27;));
            } else {
                &#x2F;&#x2F; The modchooser is currently not visible, show it
                usemodchooser = 1;
                modchooserlinks
                    .addClass(&#x27;visibleifjs&#x27;)
                    .removeClass(&#x27;hiddenifjs&#x27;);
                dropdowns
                    .removeClass(&#x27;visibleifjs&#x27;)
                    .addClass(&#x27;hiddenifjs&#x27;);
                toggletext.set(&#x27;data&#x27;, M.util.get_string(&#x27;modchooserdisable&#x27;, &#x27;moodle&#x27;));
                togglelink.set(&#x27;href&#x27;, togglelink.get(&#x27;href&#x27;).replace(&#x27;on&#x27;, &#x27;off&#x27;));
            }

            M.util.set_user_preference(&#x27;usemodchooser&#x27;, usemodchooser);

            &#x2F;&#x2F; Prevent the page from reloading
            e.preventDefault();
        },
        option_selected : function(thisoption) {
            &#x2F;&#x2F; Add the sectionid to the URL
            this.jumplink.set(&#x27;value&#x27;, thisoption.get(&#x27;value&#x27;) + &#x27;&amp;section=&#x27; + this.sectionid);
        }
    },
    {
        NAME : MODCHOOSERNAME,
        ATTRS : {
        }
    });
    M.course = M.course || {};
    M.course.init_chooser = function(config) {
        return new MODCHOOSER(config);
    }
},
&#x27;@VERSION@&#x27;, {
    requires:[&#x27;base&#x27;, &#x27;overlay&#x27;, &#x27;moodle-core-chooserdialogue&#x27;, &#x27;transition&#x27;]
}
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
