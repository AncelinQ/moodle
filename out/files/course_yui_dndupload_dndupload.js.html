<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>course&#x2F;yui&#x2F;dndupload&#x2F;dndupload.js - Moodle YUI module API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="&#x2F;moodle&#x2F;pix&#x2F;moodlelogo.gif" title="Moodle YUI module API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;classes/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;classes/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;classes/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;classes/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;classes/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;classes/course-resource-toolbox.html">course-resource-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-section-toolbox.html">course-section-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-toolboxes.html">course-toolboxes</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;modules/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;modules/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;modules/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;modules/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;modules/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;modules/course-toolboxes.html">course-toolboxes</a></li>
            
                <li><a href="..&#x2F;modules/enrol-notification.html">enrol-notification</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: course&#x2F;yui&#x2F;dndupload&#x2F;dndupload.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
YUI.add(&#x27;moodle-course-dndupload&#x27;, function(Y, NAME) {
    &#x2F;**
     * Provides the moodle course drag and drop upload class
     *
     * @module course-dndupload
     *&#x2F;

    &#x2F;**
     * Provides the Course drag and drop upload functionality
     *
     * @class course-dndupload
     * @constructor
     *&#x2F;
    var DNDUPLOAD = function() {
        DNDUPLOAD.superclass.constructor.apply(this, arguments);
    },
    CSS = {
        &#x2F;&#x2F; TODO This needs to move to coursebase and be overridable somehow
        sectiontype : &#x27;li&#x27;,
        sectionclasses : [
            &#x27;section&#x27;,
            &#x27;main&#x27;
        ]
    };

    Y.extend(DNDUPLOAD, Y.Base, {
        &#x2F;**
         * The section selector string used to identify and locate sections
         *
         * @private
         * @property sectionselector
         * @type string
         * @default null
         *&#x2F;
        sectionselector : null,

        &#x2F;**
         * A reference to the status node.
         * This node is used initially to inform users that Drag and Drop upload is available
         * to them.
         *
         * @private
         * @property string
         * @type Node
         * @default null
         *&#x2F;
        statusnode : null,

        &#x2F;**
         * Nasty hack to distinguish between dragenter(first entry),
         * dragenter+dragleave(moving between child elements) and dragleave (leaving element)
         *
         * @private
         * @property entercount
         * @type Integer
         * @default 0
         *&#x2F;
        entercount: 0,

        &#x2F;**
         * A reference to the page body since we use this a lot
         *
         * @private
         * @property body
         * @type Node
         * @default null
         *&#x2F;
        body: null,

        &#x2F;**
         * A reference to the preview element
         *
         * @private
         * @property preview_element
         * @type Node
         * @default null
         *&#x2F;
        preview_element: null,

        &#x2F;**
         * A reference to the preview element&#x27;s span which contains the text we update
         *
         * @private
         * @property preview_element_span
         * @type Node
         * @default null
         *&#x2F;
        preview_element_span: null,

        initializer : function() {
            document.dnd = this;
            var sectiontest;

            this.body = Y.one(&#x27;body&#x27;);

            if (!this.browser_supported()) {
                &#x2F;&#x2F; Browser does not support the required functionality
                return;
            }

            &#x2F;&#x2F; Check whether there are any sections available
            this.sectionselector = M.course.format.get_sectionnode() + &#x27;.&#x27; + M.course.format.get_sectionclass();
            sectiontest = Y.one(this.sectionselector);
            if (!sectiontest) {
                return;
            }

            &#x2F;&#x2F; We have at least one section available, setup listeners
            this.body.delegate(&#x27;dragenter&#x27;, this.drag_enter, this.sectionselector, this);
            this.body.delegate(&#x27;dragleave&#x27;, this.drag_leave, this.sectionselector, this);
            this.body.delegate(&#x27;dragover&#x27;,  this.drag_over,  this.sectionselector, this);
            this.body.delegate(&#x27;drop&#x27;,      this.drop,       this.sectionselector, this);

            &#x2F;&#x2F; Add the information message if necessary
            if (this.get(&#x27;showstatus&#x27;)) {
                this.add_status_message();
            }
        },

        &#x2F;**
         * Check whether the current browser has the required functionality.
         *
         * @method browser_supported
         * @return {boolean} Whether the browser is supported or not
         *&#x2F;
        browser_supported: function() {
            if (typeof FileReader === &#x27;undefined&#x27;) {
                return false;
            }
            if (typeof FormData === &#x27;undefined&#x27;) {
                return false;
            }
            return true;
        },

        &#x2F;**
         * Add an element to tell the user that drag and drop upload is available (or to
         * explain why it is not available).
         *
         * @method add_status_message
         * @return {undefined} Nothing is returned
         *&#x2F;
        add_status_message: function() {
            var contentdiv,
            messagetitle,
            pagecontents,
            fadeanim;

            &#x2F;&#x2F; Ensure that we can actually add the status message
            pagecontents = Y.one(&#x27;#page&#x27;);
            if (pagecontents) {
                return false;
            }

            &#x2F;&#x2F; Create the status message
            this.statusnode = Y.Node.create(&#x27;&lt;div class=&quot;dndupload_status_message&quot; &#x2F;&gt;&#x27;)
                .setStyle(&#x27;opacity&#x27;, &#x27;0.0&#x27;);

            &#x2F;&#x2F; Set the initial status message
            messagetitle = &#x27;dndworking&#x27;;
            if (this.get(&#x27;handlefile&#x27;)) {
                messagetitle += &#x27;file&#x27;;
            }
            if (this.get(&#x27;handletext&#x27;)) {
                messagetitle += &#x27;text&#x27;;
            }
            if (this.get(&#x27;handlelink&#x27;)) {
                messagetitle += &#x27;link&#x27;;
            }

            this.statusnode.setContent(M.util.get_string(messagetitle, &#x27;moodle&#x27;));

            &#x2F;&#x2F; Add the status message to the page
            pagecontents.insertBefore(this.statusnode, pagecontents.firstChild);

            &#x2F;&#x2F; Setup the animation to fade from 0.0 opacity to 1.0 opacity
            fadeanim = new Y.Anim({
                node: this.statusnode,
                from: {
                    opacity: 0.0,
                    top: &#x27;-30px&#x27;
                },
                to: {
                    opacity: 1.0,
                    top: &#x27;0px&#x27;
                },
                duration: 0.5
            });

            &#x2F;&#x2F; We need the animation to reverse after a short period
            fadeanim.once(&#x27;end&#x27;, function(e) {
                this.set(&#x27;reverse&#x27;, 1);
                Y.later(3000, this, &#x27;run&#x27;, null, false);
            });

            &#x2F;&#x2F; Now it&#x27;s set up, run the animation
            fadeanim.run();
        },

        &#x2F;**
         * Handle a dragenter event: add a suitable &#x27;add here&#x27; message when a drag event
         * occurs, containing a registered data type.
         *
         * @method drag_enter
         * @param {Event} e The event defining the dragenter
         * @return {boolean} Always returns false to ensure that further event processing
         * does not occur
         *&#x2F;
        drag_enter: function(e) {
            var type, section;

            e.preventDefault();

            type = this.check_drag(e);
            if (!type) {
                &#x2F;&#x2F; Return early if the drag didn&#x27;t match
                return false;
            }

            &#x2F;&#x2F; Get the section value for the current section
            section = M.course.coursebase.get_section(e.currentTarget);
            if (!section) {
                return false;
            }

            &#x2F;&#x2F; TODO What does this bit do!?
            if (this.currentsection &amp;&amp; this.currentsection !== section) {
                this.currentsection = section;
                this.entercount = 1;
            } else {
                this.entercount++;
                if (this.entercount &gt; 2) {
                    this.entercount = 2;
                    return false;
                }
            }

            &#x2F;&#x2F; TODO what does this do?
            this.show_preview_element(section, type);

            return false;
        },

        &#x2F;**
         * Handle a dragleave event: remove the &#x27;add here&#x27; message (if present)
         *
         * @method drag_leave
         * @param {event} e event data
         *&#x2F;
        drag_leave: function(e) {
            &#x2F;&#x2F; Prevent any further actions
            e.preventDefault();

            &#x2F;&#x2F; This event type does not support drag and drop upload
            if (!this.check_drag(e)) {
                return;
            }

            this.entercount--;
            if (this.entercount == 1) {
                return;
            }
            this.entercount = 0;


            this.currentsection = null;

            &#x2F;&#x2F; Stop previewing the element now
            this.hide_preview_element();

            return;
        },

        &#x2F;**
         * Handle a dragover event: just prevent the browser default (necessary to allow drag
         * and drop handling to work)
         *
         * @method drag_over
         * @param {Event} e event data
         *&#x2F;
        drag_over: function(e) {
            this.check_drag(e);
            return false;
        },

        &#x2F;**
         * Handle a drop event: hide the &#x27;add here&#x27; message, check the attached data type and
         * start the upload process
         *
         * @method drop
         * @param {event} e event data
         *&#x2F;
        drop: function(e) {
            var type,
            files,
            i,
            contents;
            type = this.check_drag(e);
            if (!type) {
                return false;
            }

            this.hide_preview_element();

            &#x2F;&#x2F; Work out the number of the section we are on (from its id)
            &#x2F;&#x2F; TODO fix this
            var section = M.course.coursebase.get_section(e.currentTarget);
            var sectionnumber = M.course.coursebase.get_section_number(section);

            &#x2F;&#x2F; Process the file or the included data
            if (type.type === &#x27;Files&#x27;) {
                files = e._event.dataTransfer.files;
                for (i = 0; i &lt; files.length; i++) {
                    f = files[i];
                    this.handle_file(f, section, sectionnumber);
                }
            } else {
                contents = e._event.dataTransfer.getData(type.realtype);
                if (contents) {
                    this.handle_item(type, contents, section, sectionnumber);
                }
            }

            return false;
        },

        &#x2F;**
         * Check if the given event includes data of the given type.
         *
         * @method types_includes
         * @param {Event} e the event details
         * @param {String} type the data type to check for
         * @return {boolean} Whether the data type was found in the event data
         *&#x2F;
        types_includes: function(e, type) {
            var i,
            types = e._event.dataTransfer.types;
            for (i = 0; i &lt; types.length; i++) {
                if (types[i] === type) {
                    return true;
                }
            }
            return false;
        },

        &#x2F;**
         * Look through the event data, checking it against the registered data types
         * (in order of priority) and return details of the first matching data type.
         *
         * The type is an object containing:
         *     realtype: the type as given by the browser
         *     addmessage: the message to show to the user during dragging
         *     namemessage: the message for requesting a name for the resource from the user
         *     type: the identifier of the type (may match several &#x27;realtype&#x27;s)
         *
         * @method drag_type
         * @param {Event} e the event details
         * @return {boolean|Object} If no matching type was found return false, otherwise
         * an object containing the details of the registered upload type.
         *&#x2F;
        drag_type: function(e) {
            var types, i, dttypes, j;
            &#x2F;&#x2F; Check there is some data attached.
            if (e._event.dataTransfer === null) {
                return false;
            }
            if (e._event.dataTransfer.types === null) {
                return false;
            }
            if (e._event.dataTransfer.types.length === 0) {
                return false;
            }

            &#x2F;&#x2F; Check for files first.
            if (this.types_includes(e, &#x27;Files&#x27;)) {
                if (e.type !== &#x27;drop&#x27; || e._event.dataTransfer.files.length !== 0) {
                    if (this.get(&#x27;handlers&#x27;).filehandlers.length === 0) {
                        return false; &#x2F;&#x2F; No available file handlers - ignore this drag.
                    }
                    return {
                        realtype: &#x27;Files&#x27;,
                        addmessage: M.util.get_string(&#x27;addfilehere&#x27;, &#x27;moodle&#x27;),
                        namemessage: null, &#x2F;&#x2F; Should not be asked for anyway
                        type: &#x27;Files&#x27;
                    };
                }
            }

            &#x2F;&#x2F; Check each of the registered types.
            types = this.get(&#x27;handlers&#x27;).types;
            for (i = 0; i &lt; types.length; i++) {
                &#x2F;&#x2F; Check each of the different identifiers for this type
                dttypes = types[i].datatransfertypes;
                for (j = 0; j &lt; dttypes.length; j++) {
                    if (this.types_includes(e, dttypes[j])) {
                        return {
                            realtype: dttypes[j],
                            addmessage: types[i].addmessage,
                            namemessage: types[i].namemessage,
                            type: types[i].identifier,
                            handlers: types[i].handlers
                        };
                    }
                }
            }
            &#x2F;&#x2F; No types we can handle
            return false;
        },

        &#x2F;**
         * Check the content of the drag&#x2F;drop includes a type we can handle.
         * If so, notify the browser that we want to handle it
         *
         * @method check_drag
         * @param {Event} e The event handler to check
         * @return {String|boolean} type of the event or false
         *&#x2F;
        check_drag: function(e) {
            var type = this.drag_type(e);
            if (type) {
                &#x2F;&#x2F; Notify browser that we will handle this drag&#x2F;drop
                e.stopPropagation();
                e.preventDefault();
            }
            return type;
        },

        &#x2F;**
         * Hide the dndupload-preview element if it has been created
         *
         * @method hide_preview_element
         *&#x2F;
        hide_preview_element: function() {
            if (!this.preview_element) {
                return false;
            }
            this.preview_element.addClass(&#x27;dndupload-hidden&#x27;);
        },

        &#x2F;**
         * Unhide the preview element for the given section and set it to display the
         * correct message.
         *
         * If a preview element does not yet exist, then one is automatically created.
         *
         * @method show_preview_element
         * @param section the YUI node representing the selected course section
         * @param type the details of the data type detected in the drag (including the message to display)
         *&#x2F;
        show_preview_element: function(section, type) {
            var modulelist;
            this.hide_preview_element();

            if (!this.preview_element) {
                &#x2F;&#x2F; Create the preview element once
                this.preview_element = Y.Node.create(&#x27;&lt;li class=&quot;dndupload-preview dndupload-hidden&quot;&gt;&#x27; + 
                            &#x27;&lt;div class=&quot;mod-indent&quot;&gt;&#x27; + 
                                &#x27;&lt;img src=&quot;&#x27; + M.util.image_url(&#x27;t&#x2F;addfile&#x27;) + &#x27;&quot; class=&quot;icon&quot; &#x2F;&gt; &#x27; +
                                &#x27;&lt;span class=&quot;instancename&quot;&gt;&#x27; + M.util.get_string(&#x27;addfilehere&#x27;, &#x27;moodle&#x27;) + &#x27;&lt;&#x2F;span&gt;&#x27; +
                            &#x27;&lt;&#x2F;div&gt;&#x27; +
                        &#x27;&lt;&#x2F;li&gt;&#x27;);
                this.preview_element_span = this.preview_element.one(&#x27;span&#x27;);
            }

            &#x2F;&#x2F; Set the new span content message
            this.preview_element_span.setContent(type.addmessage);
            
            &#x2F;&#x2F; Unhide the element
            this.preview_element.removeClass(&#x27;dndupload-hidden&#x27;);

            &#x2F;&#x2F; Ensure that it is visible within the correct section
            modulelist = M.course.coursebase.get_module_list(section);
            modulelist.appendChild(this.preview_element);
        },

        &#x2F;**
         * Find the registered handler for the given file type. If there is more than one,
         * ask the user which one to use. Then upload the file to the server.
         *
         * @method handle_file
         * @param {Object} file the details of the file, taken from the FileList in the drop event
         * @param {Node} section the Node representing the selected course section
         * @param {integer} sectionnumber the number of the selected course section
         *&#x2F;
        handle_file: function(file, section, sectionnumber) {
            var handlers = [],
            filehandlers = this.get(&#x27;handlers&#x27;).filehandlers,
            extension = &#x27;&#x27;,
            dotpos = file.name.lastIndexOf(&#x27;.&#x27;),
            i;

            if (dotpos !== -1) {
                &#x2F;&#x2F; Determine the file extension
                extension = file.name.substr(dotpos + 1, file.name.length);
            }

            for (i = 0; i &lt; filehandlers.length; i++) {
                &#x2F;&#x2F; Build a list of appropriate handlers for this file type
                if (filehandlers[i].extension === &#x27;*&#x27; || filehandlers[i].extension === extension) {
                    handlers.push(filehandlers[i]);
                }
            }

            if (handlers.length === 0) {
                &#x2F;&#x2F; No associated file handlers present so exit here.
                return;
            }

            if (handlers.length === 1) {
                &#x2F;&#x2F; Only one file handler here - use it.
                this.upload_file(file, section, sectionnumber, handlers[0].module);
                return;
            }

            &#x2F;&#x2F; There is more than one handler available, offer the user the options.
            this.file_handler_dialog(handlers, extension, file, section, sectionnumber);
        },

        &#x2F;**
         * Perform a file upload for the specified file. This consists of:
         *
         * - showing the dummy element;
         * - using an AJAX call to send the data to the server;
         * - updating the progress bar for the file; then
         * - replacing the dummy element with the real information once the AJAX call completes.
         *
         * @method upload_file
         * @param {Object} file the details of the file, taken from the FileList in the drop event
         * @param {Node} section the Node representing the selected course section
         * @param {integer} sectionnumber the number of the selected course section
         *&#x2F;
        upload_file: function(file, section, sectionnumber, module) {
            &#x2F;&#x2F; This would be an ideal place to use the Y.io function
            &#x2F;&#x2F; however, this does not support data encoded using the
            &#x2F;&#x2F; FormData object, which is needed to transfer data from
            &#x2F;&#x2F; the DataTransfer object into an XMLHTTPRequest
            &#x2F;&#x2F; This can be converted when the YUI issue has been integrated:
            &#x2F;&#x2F; http:&#x2F;&#x2F;yuilibrary.com&#x2F;projects&#x2F;yui3&#x2F;ticket&#x2F;2531274
            var xhr = new XMLHttpRequest();
            var self = this;

            if (file.size &gt; this.maxbytes) {
                &#x2F;&#x2F; TODO switch to M.core.exception
                alert(&quot;&#x27;&quot;+file.name+&quot;&#x27; &quot;+M.util.get_string(&#x27;filetoolarge&#x27;, &#x27;moodle&#x27;));
                return;
            }

            &#x2F;&#x2F; Add the file to the display
            &#x2F;&#x2F;var resel = this.add_resource_element(file.name, section);
            
            var formData = new FormData();
            formData.append(&#x27;repo_upload_file&#x27;, file);
            formData.append(&#x27;sesskey&#x27;, M.cfg.sesskey);
            formData.append(&#x27;course&#x27;, this.get(&#x27;courseid&#x27;));
            formData.append(&#x27;section&#x27;, sectionnumber);
            formData.append(&#x27;module&#x27;, module);
            formData.append(&#x27;type&#x27;, &#x27;Files&#x27;);

            Y.log(formData);

            eformData = {
                &#x27;repo_upload_file&#x27;: file,
                &#x27;sesskey&#x27;: M.cfg.sesskey,
                &#x27;course&#x27;: this.get(&#x27;courseid&#x27;),
                &#x27;section&#x27;: sectionnumber,
                &#x27;module&#x27;: module,
                &#x27;type&#x27;: &#x27;Files&#x27;
            };
            Y.log(eformData);

            config = {
                method: &#x27;POST&#x27;,
                data: eformData,
                on: {
                    progress: function(e) {
                        Y.log(&quot;Got some progress&quot;);
                        if (e.lengthComputable) {
                            var percentage = Math.round((e.loaded * 100) &#x2F; e.total);
                            &#x2F;&#x2F;resel.progress.style.width = percentage + &#x27;%&#x27;;
                            Y.log(&quot;Now at &quot; + percentage + &#x27;%&#x27;);
                        }
                    },
                    complete: function(e) {
                        Y.log(&quot;We have completion&quot;);
                    }
                },
                context: this
            };
            Y.io(this.get(&#x27;uri&#x27;), config);
            return;

            &#x2F;&#x2F; Wait for the AJAX call to complete, then update the
            &#x2F;&#x2F; dummy element with the returned details
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        var result = JSON.parse(xhr.responseText);
                        if (result) {
                            if (result.error === 0) {
                                &#x2F;&#x2F; All OK - update the dummy element
                                resel.icon.src = result.icon;
                                resel.a.href = result.link;
                                resel.namespan.innerHTML = result.name;

                                if (result.groupingname) {
                                    resel.groupingspan.innerHTML = &#x27;(&#x27; + result.groupingname + &#x27;)&#x27;;
                                } else {
                                    resel.div.removeChild(resel.groupingspan);
                                }

                                resel.div.removeChild(resel.progressouter);
                                resel.li.id = result.elementid;
                                resel.indentdiv.innerHTML += result.commands;
                                if (result.onclick) {
                                    resel.a.onclick = result.onclick;
                                }
                                if (self.Y.UA.gecko &gt; 0) {
                                    &#x2F;&#x2F; Fix a Firefox bug which makes sites with a &#x27;~&#x27; in their wwwroot
                                    &#x2F;&#x2F; log the user out when clicking on the link (before refreshing the page).
                                    resel.div.innerHTML = unescape(resel.div.innerHTML);
                                }
                                self.add_editing(result.elementid);
                            } else {
                                &#x2F;&#x2F; Error - remove the dummy element
                                resel.parent.removeChild(resel.li);
                                alert(result.error);
                            }
                        }
                    } else {
                        alert(M.util.get_string(&#x27;servererror&#x27;, &#x27;moodle&#x27;));
                    }
                }
            };

            &#x2F;&#x2F; Prepare the data to send
            &#x2F;&#x2F;var formData = new FormData();
            &#x2F;&#x2F;formData.append(&#x27;repo_upload_file&#x27;, file);
            &#x2F;&#x2F;formData.append(&#x27;sesskey&#x27;, M.cfg.sesskey);
            &#x2F;&#x2F;formData.append(&#x27;course&#x27;, this.courseid);
            &#x2F;&#x2F;formData.append(&#x27;section&#x27;, sectionnumber);
            &#x2F;&#x2F;formData.append(&#x27;module&#x27;, module);
            &#x2F;&#x2F;formData.append(&#x27;type&#x27;, &#x27;Files&#x27;);

            &#x2F;&#x2F; Send the AJAX call
            &#x2F;&#x2F;xhr.open(&quot;POST&quot;, this.url, true);
            &#x2F;&#x2F;xhr.send(formData);
        },

        TODO : function() {
        }


    },
    {
        NAME : DNDUPLOAD,
        ATTRS : {
            &#x2F;**
             * The URI to use for upload requests
             *
             * @optional
             * @attribute uri
             * @default M.cfg.wwwroot + &#x27;&#x2F;course&#x2F;dndupload.php&#x27;
             *&#x2F;
            uri : {
                &#x27;value&#x27; : M.cfg.wwwroot + &#x27;&#x2F;course&#x2F;dndupload.php&#x27;
            },

            &#x2F;**
             * The course ID of the course currently being edited
             *
             * @required
             * @attribute courseid
             * @writeOnce
             * @default null
             *&#x2F;
            courseid : {
                &#x27;value&#x27; : null
            },

            &#x2F;**
             * The maximum size of files allowed in this form
             *
             * @required
             * @attribute maxbytes
             * @writeOnce
             * @default 0
             *&#x2F;
            maxbytes : {
                &#x27;value&#x27; : 0
            },

            &#x2F;**
             * The handlers available to this form
             *
             * @required
             * @attribute handlers
             * @writeOnce
             * @default null
             *&#x2F;
            handlers : {
                &#x27;value&#x27; : null
            },

            &#x2F;**
             * Whether this form handles file uploads
             *
             * @required
             * @attribute handlefile
             * @writeOnce
             * @default false
             *&#x2F;
            handlefile : {
                &#x27;value&#x27; : false
            },

            &#x2F;**
             * Whether this form handles upload of text
             *
             * @required
             * @attribute handletext
             * @writeOnce
             * @default false
             *&#x2F;
            handletext : {
                &#x27;value&#x27; : false
            },

            &#x2F;**
             * Whether this form handles link uploads
             *
             * @required
             * @attribute handlelink
             * @writeOnce
             * @default false
             *&#x2F;
            handlelink : {
                &#x27;value&#x27; : false
            }
        }
    });

    M.course = M.course || {};
    M.course.init_dndupload = function(params) {
        return new DNDUPLOAD(params);
    };
}, &#x27;@VERSION@&#x27;, {requires:[&quot;node&quot;, &quot;event&quot;, &quot;json&quot;, &quot;core_filepicker&quot;, &quot;moodle-core-dialogue&quot;, &quot;moodle-course-coursebase&quot;, &quot;io-form&quot;]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
