<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib&#x2F;yui&#x2F;formchangechecker&#x2F;formchangechecker.js - Moodle YUI module API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="&#x2F;moodle&#x2F;pix&#x2F;moodlelogo.gif" title="Moodle YUI module API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;classes/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;classes/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;classes/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;classes/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;classes/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;classes/course-resource-toolbox.html">course-resource-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-section-toolbox.html">course-section-toolbox</a></li>
            
                <li><a href="..&#x2F;classes/course-toolboxes.html">course-toolboxes</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/core-chooserdialogue.html">core-chooserdialogue</a></li>
            
                <li><a href="..&#x2F;modules/core-dragdrop.html">core-dragdrop</a></li>
            
                <li><a href="..&#x2F;modules/core-formautosubmit.html">core-formautosubmit</a></li>
            
                <li><a href="..&#x2F;modules/core-formchangechecker.html">core-formchangechecker</a></li>
            
                <li><a href="..&#x2F;modules/course-coursebase.html">course-coursebase</a></li>
            
                <li><a href="..&#x2F;modules/course-dndupload.html">course-dndupload</a></li>
            
                <li><a href="..&#x2F;modules/course-toolboxes.html">course-toolboxes</a></li>
            
                <li><a href="..&#x2F;modules/enrol-notification.html">enrol-notification</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib&#x2F;yui&#x2F;formchangechecker&#x2F;formchangechecker.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Form change checker
 *
 * @module core-formchangechecker
 *&#x2F;
YUI.add(&#x27;moodle-core-formchangechecker&#x27;,
    function(Y) {
        &#x2F;&#x2F; The CSS selectors we use
        var CSS = {
        };

        var FORMCHANGECHECKERNAME = &#x27;core-formchangechecker&#x27;;

        &#x2F;**
         * Warns users before moving away from a modified form
         *
         * @class core-formchangechecker
         * @constructor
         *&#x2F;
        var FORMCHANGECHECKER = function() {
            FORMCHANGECHECKER.superclass.constructor.apply(this, arguments);
        }

        Y.extend(FORMCHANGECHECKER, Y.Base, {

                &#x2F;&#x2F; The delegated listeners we need to detach after the initial value has been stored once
                initialvaluelisteners : [],

                &#x2F;**
                 * Initialize the module
                 *
                 * @method initializer
                 *&#x2F;
                initializer : function(config) {
                    var formid = &#x27;form#&#x27; + this.get(&#x27;formid&#x27;);

                    &#x2F;&#x2F; Add change events to the form elements
                    var currentform = Y.one(formid);
                    currentform.delegate(&#x27;change&#x27;, M.core_formchangechecker.set_form_changed, &#x27;input&#x27;, this);
                    currentform.delegate(&#x27;change&#x27;, M.core_formchangechecker.set_form_changed, &#x27;textarea&#x27;, this);
                    currentform.delegate(&#x27;change&#x27;, M.core_formchangechecker.set_form_changed, &#x27;select&#x27;, this);

                    &#x2F;&#x2F; Add a focus event to check for changes which are made without triggering a change event
                    this.initialvaluelisteners.push(currentform.delegate(&#x27;focus&#x27;, this.store_initial_value, &#x27;input&#x27;, this));
                    this.initialvaluelisteners.push(currentform.delegate(&#x27;focus&#x27;, this.store_initial_value, &#x27;textarea&#x27;, this));
                    this.initialvaluelisteners.push(currentform.delegate(&#x27;focus&#x27;, this.store_initial_value, &#x27;select&#x27;, this));

                    &#x2F;&#x2F; We need any submit buttons on the form to set the submitted flag
                    Y.one(formid).on(&#x27;submit&#x27;, M.core_formchangechecker.set_form_submitted, this);

                    &#x2F;&#x2F; YUI doesn&#x27;t support onbeforeunload properly so we must use the DOM to set the onbeforeunload. As
                    &#x2F;&#x2F; a result, the has_changed must stay in the DOM too
                    window.onbeforeunload = M.core_formchangechecker.report_form_dirty_state;
                },

                &#x2F;**
                 * Store the initial value of the currently focussed element
                 *
                 * If an element has been focussed and changed but not yet blurred, the on change
                 * event won&#x27;t be fired. We need to store it&#x27;s initial value to compare it in the
                 * get_form_dirty_state function later.
                 *
                 * @method store_initial_value
                 * @param {EventHandle} e The event handle triggering the initial value storage
                 *&#x2F;
                store_initial_value : function(e) {
                    if (e.target.hasClass(&#x27;ignoredirty&#x27;)) {
                        &#x2F;&#x2F; Don&#x27;t warn on elements with the ignoredirty class
                        return;
                    }
                    if (M.core_formchangechecker.get_form_dirty_state()) {
                        &#x2F;&#x2F; Clear the store_initial_value listeners as the form is already dirty so
                        &#x2F;&#x2F; we no longer need to call this function
                        var formid = &#x27;form#&#x27; + this.get(&#x27;formid&#x27;);

                        &#x2F;&#x2F; Detach all listen events to prevent duplicate initial value setting
                        var thisevent;
                        while (thisevent = this.initialvaluelisteners.shift()) {
                            thisevent.detach();
                        }

                        return;
                    }

                    &#x2F;&#x2F; Make a note of the current element so that it can be interrogated and
                    &#x2F;&#x2F; compared in the get_form_dirty_state function
                    M.core_formchangechecker.stateinformation.focused_element = {
                        element : e.target,
                        initial_value : e.target.get(&#x27;value&#x27;)
                    }
                }
            },
            {
                NAME : FORMCHANGECHECKERNAME,
                ATTRS : {
                    formid : {
                        &#x27;value&#x27; : &#x27;&#x27;
                    }
                }
            }
        );

        M.core_formchangechecker = M.core_formchangechecker || {};

        &#x2F;&#x2F; We might have multiple instances of the form change protector
        M.core_formchangechecker.instances = M.core_formchangechecker.instances || [];
        M.core_formchangechecker.init = function(config) {
            var formchangechecker = new FORMCHANGECHECKER(config);
            M.core_formchangechecker.instances.push(formchangechecker);
            return formchangechecker;
        }

        &#x2F;&#x2F; Store state information
        M.core_formchangechecker.stateinformation = [];

        &#x2F;**
         * Set the form changed state to true
         *
         * @method M.core_formchangechecker.set_form_changed
         * @param {EventHandle} e The event that triggered a form change
         *&#x2F;
        M.core_formchangechecker.set_form_changed = function(e) {
            if (e &amp;&amp; e.target &amp;&amp; e.target.hasClass(&#x27;ignoredirty&#x27;)) {
                &#x2F;&#x2F; Don&#x27;t warn on elements with the ignoredirty class
                return;
            }
            M.core_formchangechecker.stateinformation.formchanged = 1;

            &#x2F;&#x2F; Once the form has been marked as dirty, we no longer need to keep track of form elements
            &#x2F;&#x2F; which haven&#x27;t yet blurred
            delete M.core_formchangechecker.stateinformation.focused_element;
        }

        &#x2F;**
         * Set the form submitted state to true
         *
         * @method M.core_formchangechecker.set_form_submitted
         *&#x2F;
        M.core_formchangechecker.set_form_submitted = function() {
            M.core_formchangechecker.stateinformation.formsubmitted = 1;
        }

        &#x2F;**
         * Attempt to determine whether the form has been modified in any way and
         * is thus &#x27;dirty&#x27;
         *
         * @method M.core_formchangechecker.get_form_dirty_state
         * @return Integer 1 is the form is dirty; 0 if not
         *&#x2F;
        M.core_formchangechecker.get_form_dirty_state = function() {
            var state = M.core_formchangechecker.stateinformation;

            &#x2F;&#x2F; If the form was submitted, then return a non-dirty state
            if (state.formsubmitted) {
                return 0;
            }

            &#x2F;&#x2F; If any fields have been marked dirty, return a dirty state
            if (state.formchanged) {
                return 1;
            }

            &#x2F;&#x2F; If a field has been focused and changed, but still has focus then the browser won&#x27;t fire the
            &#x2F;&#x2F; onChange event. We check for this eventuality here
            if (state.focused_element) {
                if (state.focused_element.element.get(&#x27;value&#x27;) != state.focused_element.initial_value) {
                    return 1;
                }
            }

            &#x2F;&#x2F; Handle TinyMCE editor instances
            &#x2F;&#x2F; We can&#x27;t add a listener in the initializer as the editors may not have been created by that point
            &#x2F;&#x2F; so we do so here instead
            if (typeof tinyMCE != &#x27;undefined&#x27;) {
                for (var editor in tinyMCE.editors) {
                    if (tinyMCE.editors[editor].isDirty()) {
                        return 1;
                    }
                }
            }

            &#x2F;&#x2F; If we reached here, then the form hasn&#x27;t met any of the dirty conditions
            return 0;
        };

        &#x2F;**
         * Return a suitable message if changes have been made to a form
         *
         * @method M.core_formchangechecker.report_form_dirty_state
         * @param {EventHandle} e
         *&#x2F;
        M.core_formchangechecker.report_form_dirty_state = function(e) {
            if (!M.core_formchangechecker.get_form_dirty_state()) {
                &#x2F;&#x2F; the form is not dirty, so don&#x27;t display any message
                return;
            }

            &#x2F;&#x2F; This is the error message that we&#x27;ll show to browsers which support it
            var warningmessage = M.util.get_string(&#x27;changesmadereallygoaway&#x27;, &#x27;moodle&#x27;);

            &#x2F;&#x2F; Most browsers are happy with the returnValue being set on the event
            &#x2F;&#x2F; But some browsers do not consistently pass the event
            if (e) {
                e.returnValue = warningmessage;
            }

            &#x2F;&#x2F; But some require it to be returned instead
            return warningmessage;
        };
    },
    &#x27;@VERSION@&#x27;, {
        requires : [&#x27;base&#x27;, &#x27;event-focus&#x27;]
    }
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
