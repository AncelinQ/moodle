{"version":3,"sources":["../src/participants.js"],"names":["Selectors","bulkActionSelect","bulkUserSelectedCheckBoxes","checkCountButton","showCountText","showCountToggle","stateHelpIcon","tableForm","uniqueId","init","uniqueid","noteStateNames","root","document","querySelector","getTableFromUniqueId","DynamicTableSelectors","main","fromRegionId","registerEventListeners","CustomEvents","define","events","accessibleChange","on","e","action","target","value","tableRoot","checkboxes","querySelectorAll","indexOf","preventDefault","ids","forEach","checkbox","push","getAttribute","replace","showSendMessage","catch","Notification","exception","showAddNote","length","form","submit","resetBulkAction","addEventListener","showCountLink","showCountLinkClicked","contains","checkCountButtonClicked","DynamicTable","setPageSize","dataset","targetPageSize","then","CheckboxToggleAll","setGroupState","Events","tableContentRefreshed","defaultPageSize","parseInt","tableDefaultPerPage","currentPageSize","tablePageSize","totalRowCount","tableTotalRows","updateSlavesFromMasterState","pageCountStrings","key","component","param","classList","add","remove","Str","get_strings","showingParticipantCountString","showCountString","selectCountString","showingParticipantCount","innerHTML","users","Promise","resolve","states","label","selected","context","stateNames","titlePromise","get_string","ModalFactory","create","type","types","SAVE_CANCEL","body","Templates","render","title","buttons","save","modal","getRoot","ModalEvents","hidden","bulkActionSelector","focus","submitAddNote","show","text","find","val","publishstate","notes","map","userid","courseid","courseId","Repository","createNotesForUsers","noteIds","msg","submitSendMessage","messages","touserid","sendMessagesToUsers","messageIds"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Some UI stuff for participants page.\n * This is also used by the report/participants/index.php because it has the same functionality.\n *\n * @module     core_user/participants\n * @package    core_user\n * @copyright  2017 Damyon Wiese\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as DynamicTable from 'core_table/dynamic';\nimport * as Repository from './repository';\nimport * as Str from 'core/str';\nimport jQuery from 'jquery';\nimport CheckboxToggleAll from 'core/checkbox-toggleall';\nimport CustomEvents from 'core/custom_interaction_events';\nimport DynamicTableSelectors from 'core_table/local/dynamic/selectors';\nimport ModalEvents from 'core/modal_events';\nimport ModalFactory from 'core/modal_factory';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport {add as notifyUser} from 'core/toast';\n\nconst Selectors = {\n    bulkActionSelect: \"#formactionid\",\n    bulkUserSelectedCheckBoxes: \"input[data-togglegroup='participants-table']:checked\",\n    checkCountButton: \"#checkall\",\n    showCountText: '[data-region=\"participant-count\"]',\n    showCountToggle: '[data-action=\"showcount\"]',\n    stateHelpIcon: '[data-region=\"state-help-icon\"]',\n    tableForm: uniqueId => `form[data-table-unique-id=\"${uniqueId}\"]`,\n};\n\nexport const init = ({\n    uniqueid,\n    noteStateNames = {},\n}) => {\n    const root = document.querySelector(Selectors.tableForm(uniqueid));\n    const getTableFromUniqueId = uniqueId => root.querySelector(DynamicTableSelectors.main.fromRegionId(uniqueId));\n\n    /**\n     * Private method.\n     *\n     * @method registerEventListeners\n     * @private\n     */\n    const registerEventListeners = () => {\n        CustomEvents.define(Selectors.bulkActionSelect, [CustomEvents.events.accessibleChange]);\n        jQuery(Selectors.bulkActionSelect).on(CustomEvents.events.accessibleChange, e => {\n            const action = e.target.value;\n            const tableRoot = getTableFromUniqueId(uniqueid);\n            const checkboxes = tableRoot.querySelectorAll(Selectors.bulkUserSelectedCheckBoxes);\n\n            if (action.indexOf('#') !== -1) {\n                e.preventDefault();\n\n                const ids = [];\n                checkboxes.forEach(checkbox => {\n                    ids.push(checkbox.getAttribute('name').replace('user', ''));\n                });\n\n                if (action === '#messageselect') {\n                    showSendMessage(ids).catch(Notification.exception);\n                } else if (action === '#addgroupnote') {\n                    showAddNote(ids).catch(Notification.exception);\n                }\n            } else if (action !== '' && checkboxes.length) {\n                e.target.form().submit();\n            }\n\n            resetBulkAction(e.target);\n        });\n\n        root.addEventListener('click', e => {\n            // Handle clicking of the \"Show [all|count]\" and \"Select all\" actions.\n            const showCountLink = root.querySelector(Selectors.showCountToggle);\n            const checkCountButton = root.querySelector(Selectors.checkCountButton);\n\n            const showCountLinkClicked = showCountLink && showCountLink.contains(e.target);\n            const checkCountButtonClicked = checkCountButton && checkCountButton.contains(e.target);\n\n            if (showCountLinkClicked || checkCountButtonClicked) {\n                e.preventDefault();\n\n                const tableRoot = getTableFromUniqueId(uniqueid);\n\n                DynamicTable.setPageSize(tableRoot, showCountLink.dataset.targetPageSize)\n                .then(tableRoot => {\n                    // Always update the toggle state.\n                    // This ensures that the bulk actions are disabled after changing the page size.\n                    CheckboxToggleAll.setGroupState(tableRoot, 'participants-table', checkCountButtonClicked);\n\n                    return tableRoot;\n                })\n                .catch(Notification.exception);\n            }\n        });\n\n        // When the content is refreshed, update the row counts in various places.\n        root.addEventListener(DynamicTable.Events.tableContentRefreshed, e => {\n            const showCountLink = root.querySelector(Selectors.showCountToggle);\n            const checkCountButton = root.querySelector(Selectors.checkCountButton);\n\n            const tableRoot = e.target;\n\n            const defaultPageSize = parseInt(root.dataset.tableDefaultPerPage, 10);\n            const currentPageSize = parseInt(tableRoot.dataset.tablePageSize, 10);\n            const totalRowCount = parseInt(tableRoot.dataset.tableTotalRows, 10);\n\n            CheckboxToggleAll.updateSlavesFromMasterState(tableRoot, 'participants-table');\n\n            const pageCountStrings = [\n                {\n                    key: 'countparticipantsfound',\n                    component: 'core_user',\n                    param: totalRowCount,\n                },\n            ];\n\n\n            if (totalRowCount <= defaultPageSize) {\n                // There are fewer than the default page count numbers of rows.\n                showCountLink.classList.add('hidden');\n                checkCountButton.classList.add('hidden');\n            } else if (totalRowCount <= currentPageSize) {\n                // The are fewer than the current page size.\n                pageCountStrings.push({\n                    key: 'showperpage',\n                    component: 'core',\n                    param: defaultPageSize,\n                });\n\n                pageCountStrings.push({\n                    key: 'selectalluserswithcount',\n                    component: 'core',\n                    param: defaultPageSize,\n                });\n\n                // Show the 'Show [x]' link.\n                showCountLink.classList.remove('hidden');\n                showCountLink.dataset.targetPageSize = defaultPageSize;\n\n                // The 'Check all [x]' button is only visible when there are values to set.\n                checkCountButton.classList.add('hidden');\n            } else {\n                pageCountStrings.push({\n                    key: 'showall',\n                    component: 'core',\n                    param: totalRowCount,\n                });\n\n                pageCountStrings.push({\n                    key: 'selectalluserswithcount',\n                    component: 'core',\n                    param: totalRowCount,\n                });\n\n                // Show both the 'Show [x]' link, and the 'Check all [x]' button.\n                showCountLink.classList.remove('hidden');\n                showCountLink.dataset.targetPageSize = totalRowCount;\n                checkCountButton.classList.remove('hidden');\n            }\n\n            Str.get_strings(pageCountStrings)\n            .then(([showingParticipantCountString, showCountString, selectCountString]) => {\n                const showingParticipantCount = root.querySelector(Selectors.showCountText);\n                showingParticipantCount.innerHTML = showingParticipantCountString;\n\n                if (showCountString) {\n                    showCountLink.innerHTML = showCountString;\n                }\n\n                if (selectCountString) {\n                    checkCountButton.value = selectCountString;\n                }\n\n                return;\n            })\n            .catch(Notification.exception);\n        });\n    };\n\n    const resetBulkAction = bulkActionSelect => {\n        bulkActionSelect.value = '';\n    };\n\n    /**\n     * Show the add note popup\n     *\n     * @param {int[]} users\n     * @return {Promise}\n     */\n    const showAddNote = users => {\n        if (!users.length) {\n            // No users were selected.\n            return Promise.resolve();\n        }\n\n        const states = [];\n        for (let key in noteStateNames) {\n            switch (key) {\n                case 'draft':\n                    states.push({value: 'personal', label: noteStateNames[key]});\n                    break;\n                case 'public':\n                    states.push({value: 'course', label: noteStateNames[key], selected: 1});\n                    break;\n                case 'site':\n                    states.push({value: key, label: noteStateNames[key]});\n                    break;\n            }\n        }\n\n        const context = {\n            stateNames: states,\n            stateHelpIcon: root.querySelector(Selectors.stateHelpIcon).innerHTML,\n        };\n\n        let titlePromise = null;\n        if (users.length === 1) {\n            titlePromise = Str.get_string('addbulknotesingle', 'core_notes');\n        } else {\n            titlePromise = Str.get_string('addbulknote', 'core_notes', users.length);\n        }\n\n        return ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: Templates.render('core_user/add_bulk_note', context),\n            title: titlePromise,\n            buttons: {\n                save: titlePromise,\n            },\n        })\n        .then(modal => {\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                // Focus on the action select when the dialog is closed.\n                const bulkActionSelector = root.querySelector(Selectors.bulkActionSelect);\n                resetBulkAction(bulkActionSelector);\n                bulkActionSelector.focus();\n            });\n\n            modal.getRoot().on(ModalEvents.save, () => {\n                submitAddNote(modal, users);\n            });\n\n            modal.show();\n\n            return modal;\n        });\n    };\n\n    /**\n     * Add a note to this list of users.\n     *\n     * @param {Modal} modal\n     * @param {Number[]} users\n     * @return {Promise}\n     */\n    const submitAddNote = (modal, users) => {\n        const text = modal.getRoot().find('form textarea').val();\n        const publishstate = modal.getRoot().find('form select').val();\n\n        const notes = users.map(userid => {\n            return {\n                userid,\n                text,\n                courseid: root.dataset.courseId,\n                publishstate,\n            };\n        });\n\n        return Repository.createNotesForUsers(notes)\n        .then(noteIds => {\n            if (noteIds.length === 1) {\n                return Str.get_string('addbulknotedonesingle', 'core_notes');\n            } else {\n                return Str.get_string('addbulknotedone', 'core_notes', noteIds.length);\n            }\n        })\n        .then(msg => notifyUser(msg))\n        .catch(Notification.exception);\n    };\n\n    /**\n     * Show the send message popup.\n     *\n     * @param {Number[]} users\n     * @return {Promise}\n     */\n    const showSendMessage = users => {\n        if (!users.length) {\n            // Nothing to do.\n            return Promise.resolve();\n        }\n\n        let titlePromise;\n        if (users.length === 1) {\n            titlePromise = Str.get_string('sendbulkmessagesingle', 'core_message');\n        } else {\n            titlePromise = Str.get_string('sendbulkmessage', 'core_message', users.length);\n        }\n\n        return ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: Templates.render('core_user/send_bulk_message', {}),\n            title: titlePromise,\n            buttons: {\n                save: titlePromise,\n            },\n        })\n        .then(modal => {\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                // Focus on the action select when the dialog is closed.\n                const bulkActionSelector = root.querySelector(Selectors.bulkActionSelect);\n                resetBulkAction(bulkActionSelector);\n                bulkActionSelector.focus();\n            });\n\n            modal.getRoot().on(ModalEvents.save, () => {\n                submitSendMessage(modal, users);\n            });\n\n            modal.show();\n\n            return modal;\n        });\n    };\n\n    /**\n     * Send a message to these users.\n     *\n     * @param {Modal} modal\n     * @param {Number[]} users\n     * @return {Promise}\n     */\n    const submitSendMessage = (modal, users) => {\n        const text = modal.getRoot().find('form textarea').val();\n\n        const messages = users.map(touserid => {\n            return {\n                touserid,\n                text,\n            };\n        });\n\n        return Repository.sendMessagesToUsers(messages)\n        .then(messageIds => {\n            if (messageIds.length == 1) {\n                return Str.get_string('sendbulkmessagesentsingle', 'core_message');\n            } else {\n                return Str.get_string('sendbulkmessagesent', 'core_message', messageIds.length);\n            }\n        })\n        .then(msg => notifyUser(msg))\n        .catch(Notification.exception);\n    };\n\n    registerEventListeners();\n};\n"],"file":"participants.min.js"}