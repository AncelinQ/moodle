define ("core_user/participants",["exports","core_table/dynamic","./repository","core/str","core_table/local/dynamic/selectors","core/modal_events","core/modal_factory","core/notification","core/templates","core/toast","core/custom_interaction_events"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=m(b);c=m(c);d=m(d);e=l(e);f=l(f);g=l(g);h=l(h);i=l(i);k=l(k);function l(a){return a&&a.__esModule?a:{default:a}}function m(a){if(a&&a.__esModule){return a}else{var b={};if(null!=a){for(var c in a){if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};if(d.get||d.set){Object.defineProperty(b,c,d)}else{b[c]=a[c]}}}}b.default=a;return b}}function n(a,b){return q(a)||p(a,b)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function p(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function q(a){if(Array.isArray(a))return a}var r={bulkActionSelect:"#formactionid",bulkUserCheckBoxes:"input.usercheckbox",bulkUserSelectedCheckBoxes:"input.usercheckbox:checked",checkCountButton:"#checkall",showCountText:"[data-region=\"participant-count\"]",showCountToggle:"[data-action=\"showcount\"]",stateHelpIcon:"[data-region=\"state-help-icon\"]",tableForm:function tableForm(a){return"form[data-table-unique-id=\"".concat(a,"\"]")}};a.init=function init(a){var l=a.uniqueid,m=a.noteStateNames,o=void 0===m?{}:m,p=document.querySelector(r.tableForm(l)),q=function(a){return p.querySelector(e.default.main.fromRegionId(a))},s=function(){p.querySelector(r.bulkActionSelect).addEventListener(k.default.events.accessibleChange,function(a){var b=a.target.value;if(-1!==b.indexOf("#")){a.preventDefault();var c=q(l),d=[];c.querySelectorAll(r.bulkUserSelectedCheckBoxes).forEach(function(a){d.push(a.getAttribute("name").replace("user",""))});if("#messageselect"===b){w(d).catch(h.default.exception)}else if("#addgroupnote"===b){u(d).catch(h.default.exception)}}else if(""!==b){var e=q(l);if(e.querySelectorAll(r.bulkUserSelectedCheckBoxes).length){a.target.form().submit()}}t(a.target)});p.addEventListener("click",function(a){var c=p.querySelector(r.showCountToggle),d=p.querySelector(r.checkCountButton),e=c.contains(a.target),f=d.contains(a.target);if(e||f){a.preventDefault();var g=q(l);b.setPageSize(g,c.dataset.targetPageSize).then(function(a){if(f){a.querySelectorAll(r.bulkUserCheckBoxes).forEach(function(a){a.checked=!0})}return a}).catch(h.default.exception)}});p.addEventListener(b.Events.tableContentRefreshed,function(a){var b=p.querySelector(r.showCountToggle),c=p.querySelector(r.checkCountButton),e=a.target,f=parseInt(p.dataset.tableDefaultPerPage,10),g=parseInt(e.dataset.tablePageSize,10),i=parseInt(e.dataset.tableTotalRows,10);if(i<=f){b.classList.add("hidden");c.classList.add("hidden");return}var j,k;b.classList.remove("hidden");if(i<=g){j="showperpage";k=f;c.classList.add("hidden")}else{j="showall";k=i;c.classList.remove("hidden")}b.dataset.targetPageSize=k;d.get_strings([{key:"countparticipantsfound",component:"core_user",param:i},{key:j,component:"core",param:k},{key:"selectalluserswithcount",component:"core",param:k}]).then(function(a){var d=n(a,3),e=d[0],f=d[1],g=d[2],h=p.querySelector(r.showCountText);h.innerHTML=e;b.innerHTML=f;c.value=g}).catch(h.default.exception)})},t=function(a){a.value=""},u=function(a){if(!a.length){return Promise.resolve()}var b=[];for(var h in o){switch(h){case"draft":b.push({value:"personal",label:o[h]});break;case"public":b.push({value:"course",label:o[h],selected:1});break;case"site":b.push({value:h,label:o[h]});break;}}var c={stateNames:b,stateHelpIcon:p.querySelector(r.stateHelpIcon).innerHTML},e=null;if(1===a.length){e=d.get_string("addbulknotesingle","core_notes")}else{e=d.get_string("addbulknote","core_notes",a.length)}return g.default.create({type:g.default.types.SAVE_CANCEL,body:i.default.render("core_user/add_bulk_note",c),title:e,buttons:{save:e}}).then(function(b){b.getRoot().on(f.default.hidden,function(){var a=p.querySelector(r.bulkActionSelect);t(a);a.focus()});b.getRoot().on(f.default.save,function(){v(b,a)});b.show();return b})},v=function(a,b){var e=a.getRoot().find("form textarea").val(),f=a.getRoot().find("form select").val(),g=b.map(function(a){return{userid:a,text:e,courseid:p.dataset.courseId,publishstate:f}});return c.createNotesForUsers(g).then(function(a){if(1===a.length){return d.get_string("addbulknotedonesingle","core_notes")}else{return d.get_string("addbulknotedone","core_notes",a.length)}}).then(function(a){return(0,j.add)(a)}).catch(h.default.exception)},w=function(a){if(!a.length){return Promise.resolve()}var b;if(1===a.length){b=d.get_string("sendbulkmessagesingle","core_message")}else{b=d.get_string("sendbulkmessage","core_message",a.length)}return g.default.create({type:g.default.types.SAVE_CANCEL,body:i.default.render("core_user/send_bulk_message",{}),title:b,buttons:{save:b}}).then(function(b){b.getRoot().on(f.default.hidden,function(){var a=p.querySelector(r.bulkActionSelect);t(a);a.focus()});b.getRoot().on(f.default.save,function(){x(b,a)});b.show();return b})},x=function(a,b){var e=a.getRoot().find("form textarea").val(),f=b.map(function(a){return{touserid:a,text:e}});return c.sendMessagesToUsers(f).then(function(a){if(1==a.length){return d.get_string("sendbulkmessagesentsingle","core_message")}else{return d.get_string("sendbulkmessagesent","core_message",a.length)}}).then(function(a){return(0,j.add)(a)}).catch(h.default.exception)};s()}});
//# sourceMappingURL=participants.min.js.map
