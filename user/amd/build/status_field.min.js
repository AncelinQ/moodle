define ("core_user/status_field",["exports","core/ajax","core/fragment","core/modal_events","core/modal_factory","core/notification","core/str","core/templates","jquery"],function(a,b,c,d,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=k(b);c=k(c);d=k(d);f=k(f);g=k(g);h=function(a){if(a&&a.__esModule){return a}else{var b={};if(null!=a){for(var c in a){if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};if(d.get||d.set){Object.defineProperty(b,c,d)}else{b[c]=a[c]}}}}b.default=a;return b}}(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function m(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function n(a,b,c){if(b)m(a.prototype,b);if(c)m(a,c);return a}var o={editEnrolment:"[data-action=\"editenrolment\"]",showDetails:"[data-action=\"showdetails\"]",unenrol:"[data-action=\"unenrol\"]"},p=function(){function a(b){l(this,a);this.contextid=b.contextid;this.courseid=b.courseid;this.bindEditEnrol();this.bindUnenrol();this.bindStatusDetails()}n(a,[{key:"bindEditEnrol",value:function bindEditEnrol(){var a=this;(0,j.default)(o.editEnrolment).click(function(b){b.preventDefault();var c=(0,j.default)(this),e=c.parent(),i=e.data("fullname"),k=c.attr("rel");j.default.when(h.get_string("edituserenrolment","enrol",i)).then(function(a){return f.default.create({large:!0,title:a,type:f.default.types.SAVE_CANCEL})}).done(function(b){b.getRoot().on(d.default.save,function(c){c.preventDefault();a.submitEditFormAjax(b)});b.getRoot().on(d.default.hidden,function(){b.destroy()});b.setBody(a.getBody(k));b.show()}).fail(g.default.exception)})}},{key:"bindUnenrol",value:function bindUnenrol(){var a=this;(0,j.default)(o.unenrol).click(function(b){b.preventDefault();var c=(0,j.default)(this),e=c.parent(),i=[{key:"unenrol",component:"enrol"},{key:"unenrolconfirm",component:"enrol",param:{user:e.data("fullname"),course:e.data("coursename"),enrolinstancename:e.data("enrolinstancename")}}],k=f.default.create({type:f.default.types.SAVE_CANCEL});j.default.when(h.get_strings(i),k).done(function(e,f){var g=e[0],h=e[1];f.setTitle(g);f.setBody(h);f.setSaveButtonText(g);f.getRoot().on(d.default.save,function(){var d={ueid:(0,j.default)(c).attr("rel")};b.preventDefault();a.submitUnenrolFormAjax(f,d)});f.getRoot().on(d.default.hidden,function(){f.destroy()});f.show()}).fail(g.default.exception)})}},{key:"bindStatusDetails",value:function bindStatusDetails(){(0,j.default)(o.showDetails).click(function(a){a.preventDefault();var b=(0,j.default)(this),c=b.parent(),e={fullname:c.data("fullname"),coursename:c.data("coursename"),enrolinstancename:c.data("enrolinstancename"),status:c.data("status"),statusclass:c.find("span").attr("class"),timestart:c.data("timestart"),timeend:c.data("timeend"),timeenrolled:c.data("timeenrolled")},k=b.next(o.editEnrolment);if(k.length){e.editenrollink=(0,j.default)("<div>").append(k.clone()).html()}var l=h.get_strings([{key:"enroldetails",component:"enrol"}]),m=f.default.create({large:!0,type:f.default.types.CANCEL});j.default.when(l,m).done(function(a,b){var c=i.default.render("core_user/status_details",e);b.setTitle(a[0]);b.setBody(c);if(k.length){b.getRoot().on("click",o.editEnrolment,function(a){a.preventDefault();b.hide();(0,j.default)(k).trigger("click")})}b.show();b.getRoot().on(d.default.hidden,function(){b.destroy()})}).fail(g.default.exception)})}},{key:"submitEditFormAjax",value:function submitEditFormAjax(a){var c=this,d=a.getRoot().find("form"),e=(0,j.default)(d).find("[name=\"ue\"]").val(),f={methodname:"core_enrol_submit_user_enrolment_form",args:{formdata:d.serialize()}};b.default.call([f])[0].done(function(b){if(b.result){a.hide();if("undefined"!=typeof window.M.core_formchangechecker){window.M.core_formchangechecker.reset_form_dirty_state()}window.location.reload()}else{var f=JSON.stringify(d.serialize());a.setBody(c.getBody(e,f))}}).fail(g.default.exception)}},{key:"submitUnenrolFormAjax",value:function submitUnenrolFormAjax(a,c){b.default.call([{methodname:"core_enrol_unenrol_user_enrolment",args:c}])[0].done(function(b){if(b.result){a.hide();if("undefined"!=typeof window.M.core_formchangechecker){window.M.core_formchangechecker.reset_form_dirty_state()}window.location.reload()}else{g.default.alert(b.errors[0].key,b.errors[0].message)}}).fail(g.default.exception)}},{key:"getBody",value:function getBody(a,b){var d={ueid:a};if("undefined"!=typeof b){d.formdata=b}return c.default.loadFragment("enrol","user_enrolment_form",this.contextid,d).fail(g.default.exception)}}]);return a}();a.init=function init(a){new p(a)}});
//# sourceMappingURL=status_field.min.js.map
