{"version":3,"sources":["../src/message_area_profile.js"],"names":["define","$","Ajax","Templates","Notification","Str","Config","CustomEvents","Events","SELECTORS","PROFILE","PROFILEADDCONTACT","PROFILEBLOCKCONTACT","PROFILEREMOVECONTACT","PROFILESENDMESSAGE","PROFILEUNBLOCKCONTACT","PROFILEVIEW","SHOWCONTACTS","MESSAGESAREA","MESSAGINGAREA","Profile","messageArea","_init","prototype","node","events","activate","onCustomEvent","CONTACTSELECTED","_viewProfile","bind","onDelegateEvent","e","data","_viewFullProfile","originalEvent","preventDefault","_sendMessage","_unblockContact","_blockContact","_addContact","_removeContact","_hideMessagingArea","event","userid","render","done","html","js","replaceNodeContents","find","promises","call","methodname","args","currentuserid","getCurrentUserId","otheruserid","then","fail","exception","window","location","href","wwwroot","_getUserId","trigger","SENDMESSAGE","action","_performAction","CONTACTBLOCKED","CONTACTUNBLOCKED","CONTACTADDED","CONTACTREMOVED","service","string","oldaction","newaction","newclass","userargs","blockeduserid","unblockeduserid","requesteduserid","userids","get_string","s","_changeText","text","anchor","removeClass","addClass","attr"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles the profile area of the messaging area.\n *\n * @module     core_message/message_area_profile\n * @package    core_message\n * @copyright  2016 Mark Nelson <markn@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/config',\n        'core/custom_interaction_events', 'core_message/message_area_events'],\n    function($, Ajax, Templates, Notification, Str, Config, CustomEvents, Events) {\n\n        /** @type {Object} The list of selectors for the message area. */\n        var SELECTORS = {\n            PROFILE: \"[data-region='profile']\",\n            PROFILEADDCONTACT: \"[data-action='profile-add-contact']\",\n            PROFILEBLOCKCONTACT: \"[data-action='profile-block-contact']\",\n            PROFILEREMOVECONTACT: \"[data-action='profile-remove-contact']\",\n            PROFILESENDMESSAGE: \"[data-action='profile-send-message']\",\n            PROFILEUNBLOCKCONTACT: \"[data-action='profile-unblock-contact']\",\n            PROFILEVIEW: \"[data-action='profile-view']\",\n            SHOWCONTACTS: \"[data-action='show-contacts']\",\n            MESSAGESAREA: \"[data-region='messages-area']\",\n            MESSAGINGAREA: \"[data-region='messaging-area']\"\n        };\n\n        /**\n         * Profile class.\n         *\n         * @param {Messagearea} messageArea The messaging area object.\n         */\n        function Profile(messageArea) {\n            this.messageArea = messageArea;\n            this._init();\n        }\n\n        /** @type {Messagearea} The messaging area object. */\n        Profile.prototype.messageArea = null;\n\n        /**\n         * Initialise the event listeners.\n         *\n         * @private\n         */\n        Profile.prototype._init = function() {\n            CustomEvents.define(this.messageArea.node, [\n                CustomEvents.events.activate\n            ]);\n\n            this.messageArea.onCustomEvent(Events.CONTACTSELECTED, this._viewProfile.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILEVIEW,\n                function(e, data) {\n                    this._viewFullProfile();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILESENDMESSAGE,\n                function(e, data) {\n                    this._sendMessage();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILEUNBLOCKCONTACT,\n                function(e, data) {\n                    this._unblockContact();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILEBLOCKCONTACT,\n                function(e, data) {\n                    this._blockContact();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILEADDCONTACT,\n                function(e, data) {\n                    this._addContact();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.PROFILEREMOVECONTACT,\n                function(e, data) {\n                    this._removeContact();\n                    data.originalEvent.preventDefault();\n                }.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.SHOWCONTACTS,\n                this._hideMessagingArea.bind(this));\n        };\n\n        /**\n         * Handles viewing the profile.\n         *\n         * @param {Event} event\n         * @param {int} userid\n         * @return {Promise} The promise resolved when the profile has been rendered\n         * @private\n         */\n        Profile.prototype._viewProfile = function(event, userid) {\n            // Show loading template.\n            Templates.render('core/loading', {}).done(function(html, js) {\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.MESSAGESAREA), html, js);\n            }.bind(this));\n\n            // Call the web service to return the profile.\n            var promises = Ajax.call([{\n                methodname: 'core_message_data_for_messagearea_get_profile',\n                args: {\n                    currentuserid: this.messageArea.getCurrentUserId(),\n                    otheruserid: userid\n                }\n            }]);\n\n            // Show the profile.\n            return promises[0].then(function(data) {\n                return Templates.render('core_message/message_area_profile', data);\n            }).then(function(html, js) {\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.MESSAGESAREA), html, js);\n            }.bind(this)).fail(Notification.exception);\n        };\n\n        /**\n         * Handles viewing the user's full profile.\n         *\n         * @private\n         */\n        Profile.prototype._viewFullProfile = function() {\n            window.location.href = Config.wwwroot + '/user/profile.php?id=' + this._getUserId();\n        };\n\n        /**\n         * Handles viewing the messages with the user.\n         *\n         * @private\n         */\n        Profile.prototype._sendMessage = function() {\n            this.messageArea.trigger(Events.SENDMESSAGE, this._getUserId());\n        };\n\n        /**\n         * Handles blocking the contact.\n         *\n         * @return {Promise} The promise resolved when the contact has been blocked\n         * @private\n         */\n        Profile.prototype._blockContact = function() {\n            var action = this._performAction('core_message_block_user', 'unblockcontact', 'profile-block-contact',\n                'profile-unblock-contact', '');\n            return action.then(function() {\n                this.messageArea.trigger(Events.CONTACTBLOCKED, this._getUserId());\n            }.bind(this));\n        };\n\n        /**\n         * Handles unblocking the contact.\n         *\n         * @return {Promise} The promise resolved when the contact has been unblocked\n         * @private\n         */\n        Profile.prototype._unblockContact = function() {\n            var action = this._performAction('core_message_unblock_user', 'blockcontact', 'profile-unblock-contact',\n                'profile-block-contact', 'danger');\n            return action.then(function() {\n                this.messageArea.trigger(Events.CONTACTUNBLOCKED, this._getUserId());\n            }.bind(this));\n        };\n\n        /**\n         * Handles adding the contact.\n         *\n         * @return {Promise} The promise resolved when the contact has been added\n         * @private\n         */\n        Profile.prototype._addContact = function() {\n            var action = this._performAction('core_message_create_contact_request', 'removecontact', 'profile-add-contact',\n                'profile-remove-contact', 'danger');\n            return action.then(function() {\n                this.messageArea.trigger(Events.CONTACTADDED, this._getUserId());\n            }.bind(this));\n        };\n\n        /**\n         * Handles removing the contact.\n         *\n         * @return {Promise} The promise resolved when the contact has been removed\n         * @private\n         */\n        Profile.prototype._removeContact = function() {\n            var action = this._performAction('core_message_delete_contacts', 'addcontact', 'profile-remove-contact',\n                'profile-add-contact', '');\n            return action.then(function() {\n                this.messageArea.trigger(Events.CONTACTREMOVED, this._getUserId());\n            }.bind(this));\n        };\n\n        /**\n         * Helper function to perform actions on the profile page.\n         *\n         * @param {String} service The web service to call.\n         * @param {String} string The string to change the button value to\n         * @param {String} oldaction The data-action of the button\n         * @param {string} newaction The data-action to change the button to\n         * @param {String} newclass The CSS class we want to add\n         * @return {Promise} The promise resolved when the action has been performed\n         * @private\n         */\n        Profile.prototype._performAction = function(service, string, oldaction, newaction, newclass) {\n            // This is a temporary hack as we are getting rid of this UI.\n            var userargs = '';\n            switch (service) {\n                case 'core_message_block_user':\n                    userargs = {\n                        userid: this.messageArea.getCurrentUserId(),\n                        blockeduserid: this._getUserId()\n                    };\n                    break;\n                case 'core_message_unblock_user':\n                    userargs = {\n                        userid: this.messageArea.getCurrentUserId(),\n                        unblockeduserid: this._getUserId()\n                    };\n                    break;\n                case 'core_message_create_contact_request':\n                    userargs = {\n                        userid: this.messageArea.getCurrentUserId(),\n                        requesteduserid: this._getUserId()\n                    };\n                    break;\n                default:\n                    userargs = {\n                        userid: this.messageArea.getCurrentUserId(),\n                        userids: [\n                            this._getUserId()\n                        ]\n                    };\n            }\n\n\n            var promises = Ajax.call([{\n                methodname: service,\n                args: userargs\n            }]);\n\n            return promises[0].then(function() {\n                return Str.get_string(string, 'message');\n            }).then(function(s) {\n                this._changeText(s, oldaction, newaction, newclass);\n            }.bind(this)).fail(Notification.exception);\n        };\n\n        /**\n         * Changes the text in the profile area.\n         *\n         * @param {String} text The string to change the button value to\n         * @param {string} oldaction The data-action of the button\n         * @param {string} newaction The data-action to change the button to\n         * @param {String} newclass The CSS class we want to add\n         * @private\n         */\n        Profile.prototype._changeText = function(text, oldaction, newaction, newclass) {\n            var anchor = this.messageArea.find(\"[data-action='\" + oldaction + \"']\");\n            // Change the text.\n            anchor.text(text);\n            // Remove any class.\n            anchor.removeClass();\n            // Add the class if there is one.\n            if (newclass) {\n                anchor.addClass(newclass);\n            }\n\n            anchor.attr('data-action', newaction);\n        };\n\n        /**\n         * Returns the ID of the user whos profile we are viewing.\n         *\n         * @return {int} The user ID\n         * @private\n         */\n        Profile.prototype._getUserId = function() {\n            return this.messageArea.find(SELECTORS.PROFILE).data('userid');\n        };\n\n        /**\n         * Hide the messaging area. This only applies on smaller screen resolutions.\n         */\n        Profile.prototype._hideMessagingArea = function() {\n            this.messageArea.find(SELECTORS.MESSAGINGAREA)\n                .removeClass('show-messages')\n                .addClass('hide-messages');\n        };\n\n        return Profile;\n    }\n);\n"],"file":"message_area_profile.es6.min.js"}