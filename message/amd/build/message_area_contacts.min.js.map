{"version":3,"sources":["../src/message_area_contacts.js"],"names":["define","$","Ajax","Templates","Notification","CustomEvents","Str","Events","SELECTORS","CONTACT","CONTACTICONBLOCKED","CONTACTS","CONTACTSAREA","CONVERSATIONS","COURSE","LASTMESSAGETEXT","LASTMESSAGEUSER","LOADINGICON","MESSAGETEXT","MESSAGINGAREA","NOCONTACTS","SEARCHBOX","SEARCHRESULTSAREA","SEARCHTEXTAREA","SELECTEDVIEWCONVERSATION","SELECTEDVIEWPROFILE","SHOWMESSAGES","VIEWCONVERSATION","VIEWPROFILE","Contacts","messageArea","_init","prototype","_isLoadingConversations","_isLoadingContacts","_numContactsDisplayed","_numContactsToRetrieve","_numConversationsDisplayed","_numConversationsToRetrieve","_messageLength","node","events","activate","down","up","onCustomEvent","MESSAGESEARCHCANCELED","_viewConversations","bind","USERSSEARCHCANCELED","_viewContacts","CONTACTSSELECTED","CONVERSATIONDELETED","_deleteConversation","CONVERSATIONSSELECTED","MESSAGESDELETED","_updateLastMessage","MESSAGESENT","_handleMessageSent","CONTACTREMOVED","e","userid","_removeContact","CONTACTADDED","_addContact","CONTACTBLOCKED","_blockContact","CONTACTUNBLOCKED","_unblockContact","CHOOSEMESSAGESTODELETE","_startDeleting","CANCELDELETEMESSAGES","_stopDeleting","onDelegateEvent","_viewConversation","_viewContact","_showMessagingArea","_selectPreviousContact","_selectNextContact","_selectPreviousConversation","_selectNextConversation","_selectPreviousCourse","_selectNextCourse","_setSearching","_clearSearching","find","scrollBottom","_loadConversations","_loadContacts","showContactsFirst","addClass","removeClass","hide","show","event","text","user","_getUserNode","length","usercontact","clone","attr","remove","prependTo","scrollTop","_updateContactText","_setSelectedUser","numberreceived","render","then","html","js","appendNodeContents","replaceNodeContents","_getItems","data","contacts","isconversation","fail","exception","trigger","currentTarget","messageid","selector","CONVERSATIONSELECTED","CONTACTSELECTED","webservice","limitfrom","limitnum","promises","call","methodname","args","getCurrentUserId","_hideMessagingArea","updatemessage","updatemessagetext","trim","sentbyuser","empty","_getContactText","substr","document","createTextNode","get_string","done","string","append","always","contact","target","closest","next","focus","originalEvent","preventDefault","stopPropagation","previous","prev","course","conversation"],"mappings":"AAuBAA,MAAM,sCAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,gBAAxB,CAA0C,mBAA1C,CAA+D,gCAA/D,CAAiG,UAAjG,CACC,kCADD,CAAD,CAEF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA6BC,CAA7B,CAA2CC,CAA3C,CAAyDC,CAAzD,CAA8DC,CAA9D,CAAsE,CAGlE,GAAIC,CAAAA,CAAS,CAAG,CACZC,OAAO,CAAE,yBADG,CAEZC,kBAAkB,CAAE,sCAFR,CAGZC,QAAQ,CAAE,0DAHE,CAIZC,YAAY,CAAE,+BAJF,CAKZC,aAAa,CAAE,+DALH,CAMZC,MAAM,CAAE,wBANI,CAOZC,eAAe,CAAE,mCAPL,CAQZC,eAAe,CAAE,mCARL,CASZC,WAAW,CAAE,eATD,CAUZC,WAAW,CAAE,8BAVD,CAWZC,aAAa,CAAE,gCAXH,CAYZC,UAAU,CAAE,2BAZA,CAaZC,SAAS,CAAE,4BAbC,CAcZC,iBAAiB,CAAE,qCAdP,CAeZC,cAAc,CAAE,kCAfJ,CAgBZC,wBAAwB,CAAE,2CAhBd,CAiBZC,mBAAmB,CAAE,+CAjBT,CAkBZC,YAAY,CAAE,+BAlBF,CAmBZC,gBAAgB,CAAE,kCAnBN,CAoBZC,WAAW,CAAE,sCApBD,CAAhB,CA4BA,QAASC,CAAAA,CAAT,CAAkBC,CAAlB,CAA+B,CAC3B,KAAKA,WAAL,CAAmBA,CAAnB,CACA,KAAKC,KAAL,EACH,CAGDF,CAAQ,CAACG,SAAT,CAAmBC,uBAAnB,IAGAJ,CAAQ,CAACG,SAAT,CAAmBE,kBAAnB,IAGAL,CAAQ,CAACG,SAAT,CAAmBG,qBAAnB,CAA2C,CAA3C,CAGAN,CAAQ,CAACG,SAAT,CAAmBI,sBAAnB,CAA4C,EAA5C,CAGAP,CAAQ,CAACG,SAAT,CAAmBK,0BAAnB,CAAgD,CAAhD,CAGAR,CAAQ,CAACG,SAAT,CAAmBM,2BAAnB,CAAiD,EAAjD,CAGAT,CAAQ,CAACG,SAAT,CAAmBO,cAAnB,CAAoC,EAApC,CAGAV,CAAQ,CAACG,SAAT,CAAmBF,WAAnB,CAAiC,IAAjC,CAOAD,CAAQ,CAACG,SAAT,CAAmBD,KAAnB,CAA2B,UAAW,CAClC1B,CAAY,CAACL,MAAb,CAAoB,KAAK8B,WAAL,CAAiBU,IAArC,CAA2C,CACvCnC,CAAY,CAACoC,MAAb,CAAoBC,QADmB,CAEvCrC,CAAY,CAACoC,MAAb,CAAoBE,IAFmB,CAGvCtC,CAAY,CAACoC,MAAb,CAAoBG,EAHmB,CAA3C,EAMA,KAAKd,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACuC,qBAAtC,CAA6D,KAAKC,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAA7D,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC0C,mBAAtC,CAA2D,KAAKC,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAA3D,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC4C,gBAAtC,CAAwD,KAAKD,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAAxD,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC6C,mBAAtC,CAA2D,KAAKC,mBAAL,CAAyBL,IAAzB,CAA8B,IAA9B,CAA3D,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC+C,qBAAtC,CAA6D,KAAKP,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAA7D,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC4C,gBAAtC,CAAwD,KAAKD,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAAxD,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACgD,eAAtC,CAAuD,KAAKC,kBAAL,CAAwBR,IAAxB,CAA6B,IAA7B,CAAvD,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACkD,WAAtC,CAAmD,KAAKC,kBAAL,CAAwBV,IAAxB,CAA6B,IAA7B,CAAnD,EACA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACoD,cAAtC,CAAsD,SAASC,CAAT,CAAYC,CAAZ,CAAoB,CACtE,KAAKC,cAAL,CAAoBtD,CAAS,CAACG,QAA9B,CAAwCkD,CAAxC,CACH,CAFqD,CAEpDb,IAFoD,CAE/C,IAF+C,CAAtD,EAGA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACwD,YAAtC,CAAoD,SAASH,CAAT,CAAYC,CAAZ,CAAoB,CACpE,KAAKG,WAAL,CAAiBH,CAAjB,CACH,CAFmD,CAElDb,IAFkD,CAE7C,IAF6C,CAApD,EAGA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC0D,cAAtC,CAAsD,SAASL,CAAT,CAAYC,CAAZ,CAAoB,CACtE,KAAKK,aAAL,CAAmBL,CAAnB,CACH,CAFqD,CAEpDb,IAFoD,CAE/C,IAF+C,CAAtD,EAGA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC4D,gBAAtC,CAAwD,SAASP,CAAT,CAAYC,CAAZ,CAAoB,CACxE,KAAKO,eAAL,CAAqBP,CAArB,CACH,CAFuD,CAEtDb,IAFsD,CAEjD,IAFiD,CAAxD,EAGA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAAC8D,sBAAtC,CACI,KAAKC,cAAL,CAAoBtB,IAApB,CAAyB,IAAzB,CADJ,EAEA,KAAKlB,WAAL,CAAiBe,aAAjB,CAA+BtC,CAAM,CAACgE,oBAAtC,CACI,KAAKC,aAAL,CAAmBxB,IAAnB,CAAwB,IAAxB,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBC,QAArD,CAA+DlC,CAAS,CAACmB,gBAAzE,CACI,KAAK+C,iBAAL,CAAuB1B,IAAvB,CAA4B,IAA5B,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBC,QAArD,CAA+DlC,CAAS,CAACoB,WAAzE,CACI,KAAK+C,YAAL,CAAkB3B,IAAlB,CAAuB,IAAvB,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBC,QAArD,CAA+DlC,CAAS,CAACkB,YAAzE,CACI,KAAKkD,kBAAL,CAAwB5B,IAAxB,CAA6B,IAA7B,CADJ,EAGA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBG,EAArD,CAAyDpC,CAAS,CAACC,OAAnE,CACI,KAAKoE,sBAAL,CAA4B7B,IAA5B,CAAiC,IAAjC,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBE,IAArD,CAA2DnC,CAAS,CAACC,OAArE,CACI,KAAKqE,kBAAL,CAAwB9B,IAAxB,CAA6B,IAA7B,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBG,EAArD,CAAyDpC,CAAS,CAACmB,gBAAnE,CACI,KAAKoD,2BAAL,CAAiC/B,IAAjC,CAAsC,IAAtC,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBE,IAArD,CAA2DnC,CAAS,CAACmB,gBAArE,CACI,KAAKqD,uBAAL,CAA6BhC,IAA7B,CAAkC,IAAlC,CADJ,EAGA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBG,EAArD,CAAyDpC,CAAS,CAACM,MAAnE,CAA2E,KAAKmE,qBAAL,CAA2BjC,IAA3B,EAA3E,EACA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoBE,IAArD,CAA2DnC,CAAS,CAACM,MAArE,CAA6E,KAAKoE,iBAAL,CAAuBlC,IAAvB,EAA7E,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiC,OAAjC,CAA0CjE,CAAS,CAACa,SAApD,CAA+D,KAAK8D,aAAL,CAAmBnC,IAAnB,CAAwB,IAAxB,CAA/D,EACA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiC,MAAjC,CAAyCjE,CAAS,CAACa,SAAnD,CAA8D,KAAK+D,eAAL,CAAqBpC,IAArB,CAA0B,IAA1B,CAA9D,EAGA3C,CAAY,CAACL,MAAb,CAAoB,KAAK8B,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAApB,CAAoE,CAChER,CAAY,CAACoC,MAAb,CAAoB6C,YAD4C,CAApE,EAGAjF,CAAY,CAACL,MAAb,CAAoB,KAAK8B,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,CAApB,CAA+D,CAC3DN,CAAY,CAACoC,MAAb,CAAoB6C,YADuC,CAA/D,EAGA,KAAKxD,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoB6C,YAArD,CAAmE9E,CAAS,CAACK,aAA7E,CACI,KAAK0E,kBAAL,CAAwBvC,IAAxB,CAA6B,IAA7B,CADJ,EAEA,KAAKlB,WAAL,CAAiB2C,eAAjB,CAAiCpE,CAAY,CAACoC,MAAb,CAAoB6C,YAArD,CAAmE9E,CAAS,CAACG,QAA7E,CACI,KAAK6E,aAAL,CAAmBxC,IAAnB,CAAwB,IAAxB,CADJ,EAGA,GAAI,CAAC,KAAKlB,WAAL,CAAiB2D,iBAAjB,EAAL,CAA2C,CAEvC,KAAKpD,0BAAL,CAAkC,EACrC,CACJ,CArED,CA4EAR,CAAQ,CAACG,SAAT,CAAmBsC,cAAnB,CAAoC,UAAW,CAC3C,KAAKxC,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACI,YAAhC,EAA8C8E,QAA9C,CAAuD,SAAvD,CACH,CAFD,CASA7D,CAAQ,CAACG,SAAT,CAAmBwC,aAAnB,CAAmC,UAAW,CAC1C,KAAK1C,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACI,YAAhC,EAA8C+E,WAA9C,CAA0D,SAA1D,CACH,CAFD,CASA9D,CAAQ,CAACG,SAAT,CAAmBe,kBAAnB,CAAwC,UAAW,CAE/C,GAAwC,CAApC,QAAKV,0BAAT,CAA2C,CACvC,KAAKkD,kBAAL,EACH,CAED,KAAKzD,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,EAA0CiF,IAA1C,GACA,KAAK9D,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,EAA+CgF,IAA/C,EACH,CARD,CAeAhE,CAAQ,CAACG,SAAT,CAAmBkB,aAAnB,CAAmC,UAAW,CAE1C,GAAmC,CAA/B,QAAKf,qBAAT,CAAsC,CAClC,KAAKqD,aAAL,EACH,CAED,KAAK1D,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,EAA+C+E,IAA/C,GACA,KAAK9D,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,EAA0CkF,IAA1C,EACH,CARD,CAkBAhE,CAAQ,CAACG,SAAT,CAAmB0B,kBAAnB,CAAwC,SAASoC,CAAT,CAAgBjC,CAAhB,CAAwBkC,CAAxB,CAA8B,CAElE,KAAKhD,kBAAL,GAEA,GAAIiD,CAAAA,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACK,aAA5B,CAA2CgD,CAA3C,CAAX,CAEA,GAAoB,CAAhB,GAAAmC,CAAI,CAACE,MAAT,CAAuB,CAEnB,GAAIC,CAAAA,CAAW,CAAG,KAAKF,YAAL,CAAkBzF,CAAS,CAACG,QAA5B,CAAsCkD,CAAtC,CAAlB,CACA,GAA2B,CAAvB,GAAAsC,CAAW,CAACD,MAAhB,CAA8B,CAE1BC,CAAW,CAAG,KAAKF,YAAL,CAAkBzF,CAAS,CAACc,iBAA5B,CAA+CuC,CAA/C,CACjB,CACD,GAA0B,CAAtB,EAAAsC,CAAW,CAACD,MAAhB,CAA6B,CAEzB,MACH,CACDF,CAAI,CAAGG,CAAW,CAACC,KAAZ,EAAP,CAEAJ,CAAI,CAACK,IAAL,CAAU,aAAV,CAAyB,kBAAzB,EAEA,KAAKvE,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAV,CAA0B,GAA1B,CAClBL,CAAS,CAACY,UADd,EAC0BkF,MAD1B,GAGA,KAAKjE,0BAAL,EACH,CAED2D,CAAI,CAACO,SAAL,CAAe,KAAKzE,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAAf,EAEA,KAAKiB,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,EAA+C2F,SAA/C,CAAyD,CAAzD,EAEA,KAAKC,kBAAL,CAAwBT,CAAxB,CAA8BD,CAA9B,KAEA,KAAKW,gBAAL,CAAsB,iBAAmB7C,CAAnB,CAA4B,IAAlD,CACH,CAlCD,CA0CAhC,CAAQ,CAACG,SAAT,CAAmBuD,kBAAnB,CAAwC,UAAW,CAC/C,GAAI,KAAKtD,uBAAT,CAAkC,CAC9B,QACH,CAGD,KAAKA,uBAAL,IAGA,GAAI0E,CAAAA,CAAc,CAAG,CAArB,CAEA,MAAOxG,CAAAA,CAAS,CAACyG,MAAV,CAAiB,cAAjB,CAAiC,EAAjC,EAAqCC,IAArC,CAA0C,SAASC,CAAT,CAAeC,CAAf,CAAmB,CAChE,GAAI,KAAK1E,0BAAT,CAAqC,CACjClC,CAAS,CAAC6G,kBAAV,CAA6B,KAAKlF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAA7B,CACI,kCAAoCiG,CAApC,CAA2C,QAD/C,CACyDC,CADzD,CAEH,CAHD,IAGO,CACH5G,CAAS,CAAC8G,mBAAV,CAA8B,KAAKnF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAA9B,CACI,kCAAoCiG,CAApC,CAA2C,QAD/C,CACyDC,CADzD,CAEH,CACD,MAAO,MAAKG,SAAL,CAAe,iDAAf,CACH,KAAK7E,0BADF,CAC8B,KAAKC,2BADnC,CAEV,CAVgD,CAU/CU,IAV+C,CAU1C,IAV0C,CAA1C,EAUO6D,IAVP,CAUY,SAASM,CAAT,CAAe,CAC9BR,CAAc,CAAGQ,CAAI,CAACC,QAAL,CAAclB,MAA/B,CACAiB,CAAI,CAACE,cAAL,IACA,MAAOlH,CAAAA,CAAS,CAACyG,MAAV,CAAiB,oCAAjB,CAAuDO,CAAvD,CACV,CAdM,EAcJN,IAdI,CAcC,SAASC,CAAT,CAAeC,CAAf,CAAmB,CAEvB,KAAKjF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAV,CAA0B,GAA1B,CAClBL,CAAS,CAACS,WADd,EAC2BqF,MAD3B,GAGA,GAAqB,CAAjB,CAAAK,CAAJ,CAAwB,CAEpBxG,CAAS,CAAC6G,kBAAV,CAA6B,KAAKlF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAA7B,CAA6EiG,CAA7E,CAAmFC,CAAnF,EAGA,KAAK1E,0BAAL,EAAmC,KAAKC,2BAC3C,CAND,IAMO,IAAI,CAAC,KAAKD,0BAAV,CAAsC,CAEzClC,CAAS,CAAC8G,mBAAV,CAA8B,KAAKnF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACK,aAAhC,CAA9B,CAA8EiG,CAA9E,CAAoFC,CAApF,CACH,CAED,KAAK9E,uBAAL,GACH,CAjBO,CAiBNe,IAjBM,CAiBD,IAjBC,CAdD,EA+BOsE,IA/BP,CA+BYlH,CAAY,CAACmH,SA/BzB,CAgCV,CA3CD,CAmDA1F,CAAQ,CAACG,SAAT,CAAmBwD,aAAnB,CAAmC,UAAW,CAC1C,GAAI,KAAKtD,kBAAT,CAA6B,CACzB,QACH,CAGD,KAAKA,kBAAL,IAGA,GAAIyE,CAAAA,CAAc,CAAG,CAArB,CAEA,MAAOxG,CAAAA,CAAS,CAACyG,MAAV,CAAiB,cAAjB,CAAiC,EAAjC,EAAqCC,IAArC,CAA0C,SAASC,CAAT,CAAeC,CAAf,CAAmB,CAChE,GAAI,KAAK5E,qBAAT,CAAgC,CAC5BhC,CAAS,CAAC6G,kBAAV,CAA6B,KAAKlF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,CAA7B,CACI,kCAAoCmG,CAApC,CAA2C,QAD/C,CACyDC,CADzD,CAEH,CAHD,IAGO,CACH5G,CAAS,CAAC8G,mBAAV,CAA8B,KAAKnF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,CAA9B,CACI,kCAAoCmG,CAApC,CAA2C,QAD/C,CACyDC,CADzD,CAEH,CACD,MAAO,MAAKG,SAAL,CAAe,4CAAf,CACH,KAAK/E,qBADF,CACyB,KAAKC,sBAD9B,CAEV,CAVgD,CAU/CY,IAV+C,CAU1C,IAV0C,CAA1C,EAUO6D,IAVP,CAUY,SAASM,CAAT,CAAe,CAC9BR,CAAc,CAAGQ,CAAI,CAACC,QAAL,CAAclB,MAA/B,CACAiB,CAAI,CAACE,cAAL,IACA,MAAOlH,CAAAA,CAAS,CAACyG,MAAV,CAAiB,oCAAjB,CAAuDO,CAAvD,CACV,CAdM,EAcJN,IAdI,CAcC,SAASC,CAAT,CAAeC,CAAf,CAAmB,CAEvB,KAAKjF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAV,CAAqB,GAArB,CAClBH,CAAS,CAACS,WADd,EAC2BqF,MAD3B,GAGA,GAAqB,CAAjB,CAAAK,CAAJ,CAAwB,CAEpBxG,CAAS,CAAC6G,kBAAV,CAA6B,KAAKlF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,CAA7B,CAAwEmG,CAAxE,CAA8EC,CAA9E,EAEA,KAAK5E,qBAAL,EAA8BwE,CACjC,CALD,IAKO,IAAI,CAAC,KAAKxE,qBAAV,CAAiC,CAEpChC,CAAS,CAAC8G,mBAAV,CAA8B,KAAKnF,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,CAA9B,CAAyEmG,CAAzE,CAA+EC,CAA/E,CACH,CAED,KAAK7E,kBAAL,GACH,CAhBO,CAgBNc,IAhBM,CAgBD,IAhBC,CAdD,EA8BOsE,IA9BP,CA8BYlH,CAAY,CAACmH,SA9BzB,CA+BV,CA1CD,CAkDA1F,CAAQ,CAACG,SAAT,CAAmB0C,iBAAnB,CAAuC,SAASoB,CAAT,CAAgB,CAEnD,KAAKhE,WAAL,CAAiB0F,OAAjB,CAAyBjH,CAAM,CAACgE,oBAAhC,EAFmD,GAI/CV,CAAAA,CAAM,CAAG5D,CAAC,CAAC6F,CAAK,CAAC2B,aAAP,CAAD,CAAuBN,IAAvB,CAA4B,QAA5B,CAJsC,CAK/CO,CAAS,CAAGzH,CAAC,CAAC6F,CAAK,CAAC2B,aAAP,CAAD,CAAuBN,IAAvB,CAA4B,WAA5B,CALmC,CAM/CQ,CAAQ,CAAG,iBAAmB9D,CAAnB,CAA4B,IANQ,CASnD,GAAI6D,CAAJ,CAAe,CACXC,CAAQ,CAAG,oBAAsBD,CAAtB,CAAkC,IAChD,CAED,KAAKhB,gBAAL,CAAsBiB,CAAtB,EACA,KAAK7F,WAAL,CAAiB0F,OAAjB,CAAyBjH,CAAM,CAACqH,oBAAhC,CAAsD/D,CAAtD,EAEA,KAAK/B,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACiB,mBAAhC,EAAqDkE,WAArD,CAAiE,UAAjE,EACA,KAAKf,kBAAL,EACH,CAlBD,CA0BA/C,CAAQ,CAACG,SAAT,CAAmB2C,YAAnB,CAAkC,SAASmB,CAAT,CAAgB,CAE9C,KAAKhE,WAAL,CAAiB0F,OAAjB,CAAyBjH,CAAM,CAACgE,oBAAhC,EAEA,GAAIV,CAAAA,CAAM,CAAG5D,CAAC,CAAC6F,CAAK,CAAC2B,aAAP,CAAD,CAAuBN,IAAvB,CAA4B,QAA5B,CAAb,CACA,KAAKT,gBAAL,CAAsB,iBAAmB7C,CAAnB,CAA4B,IAAlD,EACA,KAAK/B,WAAL,CAAiB0F,OAAjB,CAAyBjH,CAAM,CAACsH,eAAhC,CAAiDhE,CAAjD,EAEA,KAAK/B,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACgB,wBAAhC,EAA0DmE,WAA1D,CAAsE,UAAtE,EACA,KAAKf,kBAAL,EACH,CAVD,CAqBA/C,CAAQ,CAACG,SAAT,CAAmBkF,SAAnB,CAA+B,SAASY,CAAT,CAAqBC,CAArB,CAAgCC,CAAhC,CAA0C,CAErE,GAAIC,CAAAA,CAAQ,CAAG/H,CAAI,CAACgI,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAEL,CADU,CAEtBM,IAAI,CAAE,CACFvE,MAAM,CAAE,KAAK/B,WAAL,CAAiBuG,gBAAjB,EADN,CAEFN,SAAS,CAAEA,CAFT,CAGFC,QAAQ,CAAEA,CAHR,CAFgB,CAAD,CAAV,CAAf,CASA,MAAOC,CAAAA,CAAQ,CAAC,CAAD,CAClB,CAZD,CAqBApG,CAAQ,CAACG,SAAT,CAAmBqB,mBAAnB,CAAyC,SAASyC,CAAT,CAAgBjC,CAAhB,CAAwB,CAE7D,KAAKC,cAAL,CAAoBtD,CAAS,CAACK,aAA9B,CAA6CgD,CAA7C,EACA,KAAKxB,0BAAL,GACA,KAAKiG,kBAAL,GAEA,KAAK9D,aAAL,EACH,CAPD,CAiBA3C,CAAQ,CAACG,SAAT,CAAmBwB,kBAAnB,CAAwC,SAASsC,CAAT,CAAgBjC,CAAhB,CAAwB0E,CAAxB,CAAuC,CAE3E,GAAIA,CAAJ,CAAmB,IACXvC,CAAAA,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACK,aAA5B,CAA2CgD,CAA3C,CADI,CAEX2E,CAAiB,CAAGD,CAAa,CAAClD,IAAd,CAAmB7E,CAAS,CAACU,WAA7B,EAA0C6E,IAA1C,GAAiD0C,IAAjD,EAFT,CAGXC,CAAU,GAHC,CAIf,GAAIH,CAAa,CAACpB,IAAd,CAAmB,UAAnB,GAAkCtD,CAAtC,CAA8C,CAE1C6E,CAAU,GACb,CAED,KAAKjC,kBAAL,CAAwBT,CAAxB,CAA8BwC,CAA9B,CAAiDE,CAAjD,CACH,CAGD,KAAKlE,aAAL,EACH,CAhBD,CAuBA3C,CAAQ,CAACG,SAAT,CAAmBgC,WAAnB,CAAiC,UAAW,CACxC,KAAKlC,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACG,QAAhC,EAA0CgI,KAA1C,GACA,KAAKxG,qBAAL,CAA6B,CAA7B,CACA,KAAKqD,aAAL,EACH,CAJD,CAaA3D,CAAQ,CAACG,SAAT,CAAmB8B,cAAnB,CAAoC,SAAS6D,CAAT,CAAmB9D,CAAnB,CAA2B,CAC3D,KAAKoC,YAAL,CAAkB0B,CAAlB,CAA4B9D,CAA5B,EAAoCyC,MAApC,GACA,KAAKnE,qBAAL,EACH,CAHD,CAWAN,CAAQ,CAACG,SAAT,CAAmBkC,aAAnB,CAAmC,SAASL,CAAT,CAAiB,CAChD,GAAImC,CAAAA,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACG,QAA5B,CAAsCkD,CAAtC,CAAX,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCiF,WAAxC,CAAoD,QAApD,EAEAK,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACK,aAA5B,CAA2CgD,CAA3C,CAAP,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCiF,WAAxC,CAAoD,QAApD,EAEAK,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACc,iBAA5B,CAA+CuC,CAA/C,CAAP,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCiF,WAAxC,CAAoD,QAApD,CACH,CATD,CAiBA9D,CAAQ,CAACG,SAAT,CAAmBoC,eAAnB,CAAqC,SAASP,CAAT,CAAiB,CAClD,GAAImC,CAAAA,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACG,QAA5B,CAAsCkD,CAAtC,CAAX,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCgF,QAAxC,CAAiD,QAAjD,EAEAM,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACK,aAA5B,CAA2CgD,CAA3C,CAAP,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCgF,QAAxC,CAAiD,QAAjD,EAEAM,CAAI,CAAG,KAAKC,YAAL,CAAkBzF,CAAS,CAACc,iBAA5B,CAA+CuC,CAA/C,CAAP,CACAmC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACE,kBAApB,EAAwCgF,QAAxC,CAAiD,QAAjD,CACH,CATD,CAmBA7D,CAAQ,CAACG,SAAT,CAAmBiE,YAAnB,CAAkC,SAAS0B,CAAT,CAAmB9D,CAAnB,CAA2B,CACzD,MAAO,MAAK/B,WAAL,CAAiBuD,IAAjB,CAAsBsC,CAAQ,CAAG,GAAX,CAAiBnH,CAAS,CAACC,OAA3B,CACzB,gBADyB,CACNoD,CADM,CACG,IADzB,CAEV,CAHD,CAWAhC,CAAQ,CAACG,SAAT,CAAmB0E,gBAAnB,CAAsC,SAASiB,CAAT,CAAmB,CAErD,KAAK7F,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACC,OAAhC,EAAyCkF,WAAzC,CAAqD,UAArD,EACA,KAAK7D,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACC,OAAhC,EAAyC4F,IAAzC,CAA8C,cAA9C,KAEA,KAAKvE,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACC,OAAV,CAAoBkH,CAA1C,EAAoDjC,QAApD,CAA6D,UAA7D,EACA,KAAK5D,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACC,OAAV,CAAoBkH,CAA1C,EAAoDtB,IAApD,CAAyD,cAAzD,IACH,CAPD,CAeAxE,CAAQ,CAACG,SAAT,CAAmB4G,eAAnB,CAAqC,SAAS7C,CAAT,CAAe,CAChD,GAAIA,CAAI,CAACG,MAAL,CAAc,KAAK3D,cAAvB,CAAuC,CACnCwD,CAAI,CAAGA,CAAI,CAAC8C,MAAL,CAAY,CAAZ,CAAe,KAAKtG,cAAL,CAAsB,CAArC,CAAP,CACAwD,CAAI,EAAI,KACX,CAGD,MAAO+C,CAAAA,QAAQ,CAACC,cAAT,CAAwBhD,CAAxB,CACV,CARD,CAkBAlE,CAAQ,CAACG,SAAT,CAAmByE,kBAAnB,CAAwC,SAAST,CAAT,CAAeD,CAAf,CAAqB2C,CAArB,CAAiC,CAErE3C,CAAI,CAAG,KAAK6C,eAAL,CAAqB7C,CAArB,CAAP,CACA,GAAI2C,CAAJ,CAAgB,CACZpI,CAAG,CAAC0I,UAAJ,CAAe,KAAf,CAAsB,SAAtB,EAAiCC,IAAjC,CAAsC,SAASC,CAAT,CAAiB,CAEnDlD,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACQ,eAApB,EAAqC2H,KAArC,GAA6CQ,MAA7C,CAAoDD,CAApD,CACH,CAHD,EAGGE,MAHH,CAGU,UAAW,CACjBpD,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACO,eAApB,EAAqC4H,KAArC,GAA6CQ,MAA7C,CAAoDpD,CAApD,CACH,CALD,CAMH,CAPD,IAOO,CACHC,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACQ,eAApB,EAAqC2H,KAArC,GACA3C,CAAI,CAACX,IAAL,CAAU7E,CAAS,CAACO,eAApB,EAAqC4H,KAArC,GAA6CQ,MAA7C,CAAoDpD,CAApD,CACH,CACJ,CAdD,CAsBAlE,CAAQ,CAACG,SAAT,CAAmB8C,kBAAnB,CAAwC,SAASlB,CAAT,CAAYuD,CAAZ,CAAkB,IAClDkC,CAAAA,CAAO,CAAGpJ,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACC,OAA9B,CADwC,CAElD+I,CAAI,CAAGH,CAAO,CAACG,IAAR,EAF2C,CAGtDA,CAAI,CAACC,KAAL,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAPD,CAeA/H,CAAQ,CAACG,SAAT,CAAmB6C,sBAAnB,CAA4C,SAASjB,CAAT,CAAYuD,CAAZ,CAAkB,IACtDkC,CAAAA,CAAO,CAAGpJ,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACC,OAA9B,CAD4C,CAEtDoJ,CAAQ,CAAGR,CAAO,CAACS,IAAR,EAF2C,CAG1DD,CAAQ,CAACJ,KAAT,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAPD,CAeA/H,CAAQ,CAACG,SAAT,CAAmBkD,iBAAnB,CAAuC,SAAStB,CAAT,CAAYuD,CAAZ,CAAkB,CACrD,GAAI4C,CAAAA,CAAM,CAAG9J,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACM,MAA9B,CAAb,CACAiJ,CAAM,CAACP,IAAP,GAAcC,KAAd,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAND,CAcA/H,CAAQ,CAACG,SAAT,CAAmBiD,qBAAnB,CAA2C,SAASrB,CAAT,CAAYuD,CAAZ,CAAkB,CACzD,GAAI4C,CAAAA,CAAM,CAAG9J,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACM,MAA9B,CAAb,CACAiJ,CAAM,CAACD,IAAP,GAAcL,KAAd,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAND,CAcA/H,CAAQ,CAACG,SAAT,CAAmBgD,uBAAnB,CAA6C,SAASpB,CAAT,CAAYuD,CAAZ,CAAkB,IACvD6C,CAAAA,CAAY,CAAG/J,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACmB,gBAA9B,CADwC,CAEvD6H,CAAI,CAAGQ,CAAY,CAACR,IAAb,EAFgD,CAG3DA,CAAI,CAACC,KAAL,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAPD,CAeA/H,CAAQ,CAACG,SAAT,CAAmB+C,2BAAnB,CAAiD,SAASnB,CAAT,CAAYuD,CAAZ,CAAkB,IAC3D6C,CAAAA,CAAY,CAAG/J,CAAC,CAAC2D,CAAC,CAAC0F,MAAH,CAAD,CAAYC,OAAZ,CAAoB/I,CAAS,CAACmB,gBAA9B,CAD4C,CAE3DkI,CAAQ,CAAGG,CAAY,CAACF,IAAb,EAFgD,CAG/DD,CAAQ,CAACJ,KAAT,GAEAtC,CAAI,CAACuC,aAAL,CAAmBC,cAAnB,GACAxC,CAAI,CAACuC,aAAL,CAAmBE,eAAnB,EACH,CAPD,CAYA/H,CAAQ,CAACG,SAAT,CAAmBmD,aAAnB,CAAmC,UAAW,CAC1ClF,CAAC,CAACO,CAAS,CAACe,cAAX,CAAD,CAA4BmE,QAA5B,CAAqC,WAArC,CACH,CAFD,CAOA7D,CAAQ,CAACG,SAAT,CAAmBoD,eAAnB,CAAqC,UAAW,CAC5CnF,CAAC,CAACO,CAAS,CAACe,cAAX,CAAD,CAA4BoE,WAA5B,CAAwC,WAAxC,CACH,CAFD,CAOA9D,CAAQ,CAACG,SAAT,CAAmB4C,kBAAnB,CAAwC,UAAW,CAC/C,KAAK9C,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACW,aAAhC,EACKwE,WADL,CACiB,eADjB,EAEKD,QAFL,CAEc,eAFd,CAGH,CAJD,CASA7D,CAAQ,CAACG,SAAT,CAAmBsG,kBAAnB,CAAwC,UAAW,CAC/C,KAAKxG,WAAL,CAAiBuD,IAAjB,CAAsB7E,CAAS,CAACW,aAAhC,EACKwE,WADL,CACiB,eADjB,EAEKD,QAFL,CAEc,eAFd,CAGH,CAJD,CAMA,MAAO7D,CAAAA,CACV,CA9qBC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles the contacts area of the messaging area.\n *\n * @module     core_message/message_area_contacts\n * @package    core_message\n * @copyright  2016 Mark Nelson <markn@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/custom_interaction_events', 'core/str',\n        'core_message/message_area_events'],\n    function($, Ajax, Templates, Notification, CustomEvents, Str, Events) {\n\n        /** @type {Object} The list of selectors for the message area. */\n        var SELECTORS = {\n            CONTACT: \"[data-region='contact']\",\n            CONTACTICONBLOCKED: \"[data-region='contact-icon-blocked']\",\n            CONTACTS: \"[data-region='contacts'][data-region-content='contacts']\",\n            CONTACTSAREA: \"[data-region='contacts-area']\",\n            CONVERSATIONS: \"[data-region='contacts'][data-region-content='conversations']\",\n            COURSE: \"[data-region='course']\",\n            LASTMESSAGETEXT: \"[data-region='last-message-text']\",\n            LASTMESSAGEUSER: \"[data-region='last-message-user']\",\n            LOADINGICON: '.loading-icon',\n            MESSAGETEXT: \"[data-region='message-text']\",\n            MESSAGINGAREA: \"[data-region='messaging-area']\",\n            NOCONTACTS: \"[data-region=no-contacts]\",\n            SEARCHBOX: \"[data-region='search-box']\",\n            SEARCHRESULTSAREA: \"[data-region='search-results-area']\",\n            SEARCHTEXTAREA: \"[data-region='search-text-area']\",\n            SELECTEDVIEWCONVERSATION: \"[data-action='view-contact-msg'].selected\",\n            SELECTEDVIEWPROFILE: \"[data-action='view-contact-profile'].selected\",\n            SHOWMESSAGES: \"[data-action='show-messages']\",\n            VIEWCONVERSATION: \"[data-action='view-contact-msg']\",\n            VIEWPROFILE: \"[data-action='view-contact-profile']\"\n        };\n\n        /**\n         * Contacts class.\n         *\n         * @param {Messagearea} messageArea The messaging area object.\n         */\n        function Contacts(messageArea) {\n            this.messageArea = messageArea;\n            this._init();\n        }\n\n        /** @type {Boolean} checks if we are currently loading conversations */\n        Contacts.prototype._isLoadingConversations = false;\n\n        /** @type {Boolean} checks if we are currently loading contacts */\n        Contacts.prototype._isLoadingContacts = false;\n\n        /** @type {int} the number of contacts displayed */\n        Contacts.prototype._numContactsDisplayed = 0;\n\n        /** @type {int} the number of contacts to retrieve */\n        Contacts.prototype._numContactsToRetrieve = 20;\n\n        /** @type {int} the number of conversations displayed */\n        Contacts.prototype._numConversationsDisplayed = 0;\n\n        /** @type {int} the number of conversations to retrieve */\n        Contacts.prototype._numConversationsToRetrieve = 20;\n\n        /** @type {int} the number of chars of the message to show */\n        Contacts.prototype._messageLength = 60;\n\n        /** @type {Messagearea} The messaging area object. */\n        Contacts.prototype.messageArea = null;\n\n        /**\n         * Initialise the event listeners.\n         *\n         * @private\n         */\n        Contacts.prototype._init = function() {\n            CustomEvents.define(this.messageArea.node, [\n                CustomEvents.events.activate,\n                CustomEvents.events.down,\n                CustomEvents.events.up,\n            ]);\n\n            this.messageArea.onCustomEvent(Events.MESSAGESEARCHCANCELED, this._viewConversations.bind(this));\n            this.messageArea.onCustomEvent(Events.USERSSEARCHCANCELED, this._viewContacts.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTSSELECTED, this._viewContacts.bind(this));\n            this.messageArea.onCustomEvent(Events.CONVERSATIONDELETED, this._deleteConversation.bind(this));\n            this.messageArea.onCustomEvent(Events.CONVERSATIONSSELECTED, this._viewConversations.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTSSELECTED, this._viewContacts.bind(this));\n            this.messageArea.onCustomEvent(Events.MESSAGESDELETED, this._updateLastMessage.bind(this));\n            this.messageArea.onCustomEvent(Events.MESSAGESENT, this._handleMessageSent.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTREMOVED, function(e, userid) {\n                this._removeContact(SELECTORS.CONTACTS, userid);\n            }.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTADDED, function(e, userid) {\n                this._addContact(userid);\n            }.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTBLOCKED, function(e, userid) {\n                this._blockContact(userid);\n            }.bind(this));\n            this.messageArea.onCustomEvent(Events.CONTACTUNBLOCKED, function(e, userid) {\n                this._unblockContact(userid);\n            }.bind(this));\n            this.messageArea.onCustomEvent(Events.CHOOSEMESSAGESTODELETE,\n                this._startDeleting.bind(this));\n            this.messageArea.onCustomEvent(Events.CANCELDELETEMESSAGES,\n                this._stopDeleting.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.VIEWCONVERSATION,\n                this._viewConversation.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.VIEWPROFILE,\n                this._viewContact.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.SHOWMESSAGES,\n                this._showMessagingArea.bind(this));\n\n            this.messageArea.onDelegateEvent(CustomEvents.events.up, SELECTORS.CONTACT,\n                this._selectPreviousContact.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.down, SELECTORS.CONTACT,\n                this._selectNextContact.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.up, SELECTORS.VIEWCONVERSATION,\n                this._selectPreviousConversation.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.down, SELECTORS.VIEWCONVERSATION,\n                this._selectNextConversation.bind(this));\n\n            this.messageArea.onDelegateEvent(CustomEvents.events.up, SELECTORS.COURSE, this._selectPreviousCourse.bind());\n            this.messageArea.onDelegateEvent(CustomEvents.events.down, SELECTORS.COURSE, this._selectNextCourse.bind());\n\n            this.messageArea.onDelegateEvent('focus', SELECTORS.SEARCHBOX, this._setSearching.bind(this));\n            this.messageArea.onDelegateEvent('blur', SELECTORS.SEARCHBOX, this._clearSearching.bind(this));\n\n            // Now enable the ability to infinitely scroll through conversations and contacts.\n            CustomEvents.define(this.messageArea.find(SELECTORS.CONVERSATIONS), [\n                CustomEvents.events.scrollBottom\n            ]);\n            CustomEvents.define(this.messageArea.find(SELECTORS.CONTACTS), [\n                CustomEvents.events.scrollBottom\n            ]);\n            this.messageArea.onDelegateEvent(CustomEvents.events.scrollBottom, SELECTORS.CONVERSATIONS,\n                this._loadConversations.bind(this));\n            this.messageArea.onDelegateEvent(CustomEvents.events.scrollBottom, SELECTORS.CONTACTS,\n                this._loadContacts.bind(this));\n\n            if (!this.messageArea.showContactsFirst()) {\n                // Set the initial number of conversations to retrieve. Otherwise it will display no conversations.\n                this._numConversationsDisplayed = 20;\n            }\n        };\n\n        /**\n         * Turn on deleting.\n         *\n         * @private\n         */\n        Contacts.prototype._startDeleting = function() {\n            this.messageArea.find(SELECTORS.CONTACTSAREA).addClass('editing');\n        };\n\n        /**\n         * Turn off deleting.\n         *\n         * @private\n         */\n        Contacts.prototype._stopDeleting = function() {\n            this.messageArea.find(SELECTORS.CONTACTSAREA).removeClass('editing');\n        };\n\n        /**\n         * Handles viewing the list of conversations.\n         *\n         * @private\n         */\n        Contacts.prototype._viewConversations = function() {\n            // If conversations is empty then try load some.\n            if (this._numConversationsDisplayed === 0) {\n                this._loadConversations();\n            }\n\n            this.messageArea.find(SELECTORS.CONTACTS).hide();\n            this.messageArea.find(SELECTORS.CONVERSATIONS).show();\n        };\n\n        /**\n         * Handles viewing the list of contacts.\n         *\n         * @private\n         */\n        Contacts.prototype._viewContacts = function() {\n            // If contacts is empty then try load some.\n            if (this._numContactsDisplayed === 0) {\n                this._loadContacts();\n            }\n\n            this.messageArea.find(SELECTORS.CONVERSATIONS).hide();\n            this.messageArea.find(SELECTORS.CONTACTS).show();\n        };\n\n        /**\n         * Handles when a message is sent.\n         *\n         * @param {Event} event The message sent event\n         * @param {int} userid The id of the user who the message was sent to\n         * @param {String} text The message text\n         * @private\n         */\n        Contacts.prototype._handleMessageSent = function(event, userid, text) {\n            // Switch to viewing the conversations.\n            this._viewConversations();\n            // Get the user node.\n            var user = this._getUserNode(SELECTORS.CONVERSATIONS, userid);\n            // If the user has not been loaded yet, let's copy the element from contact or search panel to the conversation panel.\n            if (user.length === 0) {\n                // Let's clone the data on the contact page.\n                var usercontact = this._getUserNode(SELECTORS.CONTACTS, userid);\n                if (usercontact.length === 0) {\n                    // No luck, maybe we sent the message to a user we searched for - check search page.\n                    usercontact = this._getUserNode(SELECTORS.SEARCHRESULTSAREA, userid);\n                }\n                if (usercontact.length == 0) {\n                    // Can't do much.\n                    return;\n                }\n                user = usercontact.clone();\n                // Change the data action attribute.\n                user.attr('data-action', 'view-contact-msg');\n                // Remove the 'no conversations' message.\n                this.messageArea.find(SELECTORS.CONVERSATIONS + \" \" +\n                    SELECTORS.NOCONTACTS).remove();\n                // Increment the number of conversations displayed.\n                this._numConversationsDisplayed++;\n            }\n            // Move the contact to the top of the list.\n            user.prependTo(this.messageArea.find(SELECTORS.CONVERSATIONS));\n            // Scroll to the top.\n            this.messageArea.find(SELECTORS.CONVERSATIONS).scrollTop(0);\n            // Get the new text to show.\n            this._updateContactText(user, text, true);\n            // Ensure user is selected.\n            this._setSelectedUser(\"[data-userid='\" + userid + \"']\");\n        };\n\n        /**\n         * Handles loading conversations.\n         *\n         * @return {Promise|boolean} The promise resolved when the contact area has been rendered,\n         * @private\n         */\n        Contacts.prototype._loadConversations = function() {\n            if (this._isLoadingConversations) {\n                return false;\n            }\n\n            // Tell the user we are loading items.\n            this._isLoadingConversations = true;\n\n            // Keep track of the number of contacts\n            var numberreceived = 0;\n            // Add loading icon to the end of the list.\n            return Templates.render('core/loading', {}).then(function(html, js) {\n                if (this._numConversationsDisplayed) {\n                    Templates.appendNodeContents(this.messageArea.find(SELECTORS.CONVERSATIONS),\n                        \"<div style='text-align:center'>\" + html + \"</div>\", js);\n                } else { // No conversations, just replace contents.\n                    Templates.replaceNodeContents(this.messageArea.find(SELECTORS.CONVERSATIONS),\n                        \"<div style='text-align:center'>\" + html + \"</div>\", js);\n                }\n                return this._getItems('core_message_data_for_messagearea_conversations',\n                    this._numConversationsDisplayed, this._numConversationsToRetrieve);\n            }.bind(this)).then(function(data) {\n                numberreceived = data.contacts.length;\n                data.isconversation = true;\n                return Templates.render('core_message/message_area_contacts', data);\n            }).then(function(html, js) {\n                // Remove the loading icon.\n                this.messageArea.find(SELECTORS.CONVERSATIONS + \" \" +\n                    SELECTORS.LOADINGICON).remove();\n                // Only append data if we got data back.\n                if (numberreceived > 0) {\n                    // Show the new content.\n                    Templates.appendNodeContents(this.messageArea.find(SELECTORS.CONVERSATIONS), html, js);\n                    // Increment the number of conversations displayed. We increment by the number of conversations we\n                    // asked to retrieve not by the number that was actually retrieved, see MDL-55870.\n                    this._numConversationsDisplayed += this._numConversationsToRetrieve;\n                } else if (!this._numConversationsDisplayed) {\n                    // If we didn't receive any contacts and there are currently none, then we want to show a message.\n                    Templates.replaceNodeContents(this.messageArea.find(SELECTORS.CONVERSATIONS), html, js);\n                }\n                // Mark that we are no longer busy loading data.\n                this._isLoadingConversations = false;\n            }.bind(this)).fail(Notification.exception);\n        };\n\n        /**\n         * Handles loading contacts.\n         *\n         * @return {Promise|boolean} The promise resolved when the contact area has been rendered\n         * @private\n         */\n        Contacts.prototype._loadContacts = function() {\n            if (this._isLoadingContacts) {\n                return false;\n            }\n\n            // Tell the user we are loading items.\n            this._isLoadingContacts = true;\n\n            // Keep track of the number of contacts\n            var numberreceived = 0;\n            // Add loading icon to the end of the list.\n            return Templates.render('core/loading', {}).then(function(html, js) {\n                if (this._numContactsDisplayed) {\n                    Templates.appendNodeContents(this.messageArea.find(SELECTORS.CONTACTS),\n                        \"<div style='text-align:center'>\" + html + \"</div>\", js);\n                } else { // No contacts, just replace contents.\n                    Templates.replaceNodeContents(this.messageArea.find(SELECTORS.CONTACTS),\n                        \"<div style='text-align:center'>\" + html + \"</div>\", js);\n                }\n                return this._getItems('core_message_data_for_messagearea_contacts',\n                    this._numContactsDisplayed, this._numContactsToRetrieve);\n            }.bind(this)).then(function(data) {\n                numberreceived = data.contacts.length;\n                data.isconversation = false;\n                return Templates.render('core_message/message_area_contacts', data);\n            }).then(function(html, js) {\n                // Remove the loading icon.\n                this.messageArea.find(SELECTORS.CONTACTS + \" \" +\n                    SELECTORS.LOADINGICON).remove();\n                // Only append data if we got data back.\n                if (numberreceived > 0) {\n                    // Show the new content.\n                    Templates.appendNodeContents(this.messageArea.find(SELECTORS.CONTACTS), html, js);\n                    // Increment the number of contacts displayed.\n                    this._numContactsDisplayed += numberreceived;\n                } else if (!this._numContactsDisplayed) {\n                    // If we didn't receive any contacts and there are currently none, then we want to show a message.\n                    Templates.replaceNodeContents(this.messageArea.find(SELECTORS.CONTACTS), html, js);\n                }\n                // Mark that we are no longer busy loading data.\n                this._isLoadingContacts = false;\n            }.bind(this)).fail(Notification.exception);\n        };\n\n        /**\n         * Handles viewing a particular conversation.\n         *\n         * @param {Event} event\n         * @private\n         */\n        Contacts.prototype._viewConversation = function(event) {\n            // Cancel any deletion of messages we may have.\n            this.messageArea.trigger(Events.CANCELDELETEMESSAGES);\n\n            var userid = $(event.currentTarget).data('userid');\n            var messageid = $(event.currentTarget).data('messageid');\n            var selector = \"[data-userid='\" + userid + \"']\";\n            // If we have a specific message id then we did a search and the contact may appear in multiple\n            // places - we don't want to highlight them all.\n            if (messageid) {\n                selector = \"[data-messageid='\" + messageid + \"']\";\n            }\n\n            this._setSelectedUser(selector);\n            this.messageArea.trigger(Events.CONVERSATIONSELECTED, userid);\n            // Don't highlight the contact because the message region has changed.\n            this.messageArea.find(SELECTORS.SELECTEDVIEWPROFILE).removeClass('selected');\n            this._showMessagingArea();\n        };\n\n        /**\n         * Handles viewing a particular contact.\n         *\n         * @param {Event} event\n         * @private\n         */\n        Contacts.prototype._viewContact = function(event) {\n            // Cancel any deletion of messages we may have.\n            this.messageArea.trigger(Events.CANCELDELETEMESSAGES);\n\n            var userid = $(event.currentTarget).data('userid');\n            this._setSelectedUser(\"[data-userid='\" + userid + \"']\");\n            this.messageArea.trigger(Events.CONTACTSELECTED, userid);\n            // Don't highlight the conversation because the message region has changed.\n            this.messageArea.find(SELECTORS.SELECTEDVIEWCONVERSATION).removeClass('selected');\n            this._showMessagingArea();\n        };\n\n        /**\n         * Handles returning a list of items to display.\n         *\n         * @param {String} webservice The web service to call\n         * @param {int} limitfrom\n         * @param {int} limitnum\n         * @return {Promise} The promise resolved when the contact area has been rendered\n         * @private\n         */\n        Contacts.prototype._getItems = function(webservice, limitfrom, limitnum) {\n            // Call the web service to return the data we want to view.\n            var promises = Ajax.call([{\n                methodname: webservice,\n                args: {\n                    userid: this.messageArea.getCurrentUserId(),\n                    limitfrom: limitfrom,\n                    limitnum: limitnum\n                }\n            }]);\n\n            return promises[0];\n        };\n\n        /**\n         * Handles deleting a conversation.\n         *\n         * @param {Event} event\n         * @param {int} userid The user id belonging to the messages we are deleting.\n         * @private\n         */\n        Contacts.prototype._deleteConversation = function(event, userid) {\n            // Remove the conversation.\n            this._removeContact(SELECTORS.CONVERSATIONS, userid);\n            this._numConversationsDisplayed--;\n            this._hideMessagingArea();\n            // Now we have done all the deletion we can set the flag back to false.\n            this._stopDeleting();\n        };\n\n        /**\n         * Handles updating the last message in the contact.\n         *\n         * @param {Event} event\n         * @param {int} userid The user id belonging to the messages we are deleting\n         * @param {jQuery|null} updatemessage The message we need to update the contact panel with\n         * @private\n         */\n        Contacts.prototype._updateLastMessage = function(event, userid, updatemessage) {\n            // Check if the last message needs updating.\n            if (updatemessage) {\n                var user = this._getUserNode(SELECTORS.CONVERSATIONS, userid);\n                var updatemessagetext = updatemessage.find(SELECTORS.MESSAGETEXT).text().trim();\n                var sentbyuser = false;\n                if (updatemessage.data('useridto') == userid) {\n                    // Must have been sent by the currently logged in user.\n                    sentbyuser = true;\n                }\n\n                this._updateContactText(user, updatemessagetext, sentbyuser);\n            }\n\n            // Now we have done all the deletion we can set the flag back to false.\n            this._stopDeleting();\n        };\n\n        /**\n         * Handles adding a contact to the list.\n         *\n         * @private\n         */\n        Contacts.prototype._addContact = function() {\n            this.messageArea.find(SELECTORS.CONTACTS).empty();\n            this._numContactsDisplayed = 0;\n            this._loadContacts();\n        };\n\n        /**\n         * Handles removing a contact from the list.\n         *\n         * @param {String} selector\n         * @param {int} userid\n         * @private\n         */\n        Contacts.prototype._removeContact = function(selector, userid) {\n            this._getUserNode(selector, userid).remove();\n            this._numContactsDisplayed--;\n        };\n\n        /**\n         * Handles marking a contact as blocked on the list.\n         *\n         * @param {int} userid\n         * @private\n         */\n        Contacts.prototype._blockContact = function(userid) {\n            var user = this._getUserNode(SELECTORS.CONTACTS, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).removeClass('hidden');\n\n            user = this._getUserNode(SELECTORS.CONVERSATIONS, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).removeClass('hidden');\n\n            user = this._getUserNode(SELECTORS.SEARCHRESULTSAREA, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).removeClass('hidden');\n        };\n\n        /**\n         * Handles marking a contact as unblocked on the list.\n         *\n         * @param {int} userid\n         * @private\n         */\n        Contacts.prototype._unblockContact = function(userid) {\n            var user = this._getUserNode(SELECTORS.CONTACTS, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).addClass('hidden');\n\n            user = this._getUserNode(SELECTORS.CONVERSATIONS, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).addClass('hidden');\n\n            user = this._getUserNode(SELECTORS.SEARCHRESULTSAREA, userid);\n            user.find(SELECTORS.CONTACTICONBLOCKED).addClass('hidden');\n        };\n\n        /**\n         * Handles retrieving a user node from a list.\n         *\n         * @param {String} selector\n         * @param {int} userid\n         * @return {jQuery} The user node\n         * @private\n         */\n        Contacts.prototype._getUserNode = function(selector, userid) {\n            return this.messageArea.find(selector + \" \" + SELECTORS.CONTACT +\n                \"[data-userid='\" + userid + \"']\");\n        };\n\n        /**\n         * Handles selecting a contact in the list.\n         *\n         * @param {String} selector\n         * @private\n         */\n        Contacts.prototype._setSelectedUser = function(selector) {\n            // Remove the 'selected' class from any other contact.\n            this.messageArea.find(SELECTORS.CONTACT).removeClass('selected');\n            this.messageArea.find(SELECTORS.CONTACT).attr('aria-pressed', false);\n            // Set the tab for the user to selected.\n            this.messageArea.find(SELECTORS.CONTACT + selector).addClass('selected');\n            this.messageArea.find(SELECTORS.CONTACT + selector).attr('aria-pressed', true);\n        };\n\n        /**\n         * Converts a text message into the text that should be stored in the contact list\n         *\n         * @param {String} text\n         * @return {String} The altered text\n         */\n        Contacts.prototype._getContactText = function(text) {\n            if (text.length > this._messageLength) {\n                text = text.substr(0, this._messageLength - 3);\n                text += '...';\n            }\n\n            // Text node prevents script injection through HTML entities.\n            return document.createTextNode(text);\n        };\n\n        /**\n         * Handles updating the contact text.\n         *\n         * @param {jQuery} user The user to update\n         * @param {String} text The text to update the contact with\n         * @param {Boolean} sentbyuser Was it sent by the currently logged in user?\n         * @private\n         */\n        Contacts.prototype._updateContactText = function(user, text, sentbyuser) {\n            // Get the text we will display on the contact panel.\n            text = this._getContactText(text);\n            if (sentbyuser) {\n                Str.get_string('you', 'message').done(function(string) {\n                    // Ensure we display that the message is from this user.\n                    user.find(SELECTORS.LASTMESSAGEUSER).empty().append(string);\n                }).always(function() {\n                    user.find(SELECTORS.LASTMESSAGETEXT).empty().append(text);\n                });\n            } else {\n                user.find(SELECTORS.LASTMESSAGEUSER).empty();\n                user.find(SELECTORS.LASTMESSAGETEXT).empty().append(text);\n            }\n        };\n\n        /**\n         * Shifts focus to the next contact in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectNextContact = function(e, data) {\n            var contact = $(e.target).closest(SELECTORS.CONTACT);\n            var next = contact.next();\n            next.focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Shifts focus to the previous contact in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectPreviousContact = function(e, data) {\n            var contact = $(e.target).closest(SELECTORS.CONTACT);\n            var previous = contact.prev();\n            previous.focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Shifts focus to the next course in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectNextCourse = function(e, data) {\n            var course = $(e.target).closest(SELECTORS.COURSE);\n            course.next().focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Shifts focus to the previous course in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectPreviousCourse = function(e, data) {\n            var course = $(e.target).closest(SELECTORS.COURSE);\n            course.prev().focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Shifts focus to the next conversation in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectNextConversation = function(e, data) {\n            var conversation = $(e.target).closest(SELECTORS.VIEWCONVERSATION);\n            var next = conversation.next();\n            next.focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Shifts focus to the previous conversation in the list.\n         *\n         * @param {event} e The jquery event\n         * @param {object} data Additional event data\n         */\n        Contacts.prototype._selectPreviousConversation = function(e, data) {\n            var conversation = $(e.target).closest(SELECTORS.VIEWCONVERSATION);\n            var previous = conversation.prev();\n            previous.focus();\n\n            data.originalEvent.preventDefault();\n            data.originalEvent.stopPropagation();\n        };\n\n        /**\n         * Flags the search area as seaching.\n         */\n        Contacts.prototype._setSearching = function() {\n            $(SELECTORS.SEARCHTEXTAREA).addClass('searching');\n        };\n\n        /**\n         * Flags the search area as seaching.\n         */\n        Contacts.prototype._clearSearching = function() {\n            $(SELECTORS.SEARCHTEXTAREA).removeClass('searching');\n        };\n\n        /**\n         * Make the messaging area visible.\n         */\n        Contacts.prototype._showMessagingArea = function() {\n            this.messageArea.find(SELECTORS.MESSAGINGAREA)\n                .removeClass('hide-messages')\n                .addClass('show-messages');\n        };\n\n        /**\n         * Hide the messaging area.\n         */\n        Contacts.prototype._hideMessagingArea = function() {\n            this.messageArea.find(SELECTORS.MESSAGINGAREA)\n                .removeClass('show-messages')\n                .addClass('hide-messages');\n        };\n\n        return Contacts;\n    }\n);\n"],"file":"message_area_contacts.min.js"}