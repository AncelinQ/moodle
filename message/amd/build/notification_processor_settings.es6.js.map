{"version":3,"sources":["../src/notification_processor_settings.js"],"names":["define","$","Ajax","Notification","Fragment","Templates","Str","Dialogue","SELECTORS","PROCESSOR","PREFERENCE_ROW","NotificationProcessorSettings","element","root","name","attr","userId","contextId","prototype","show","loadFragment","userid","type","done","html","js","get_string","string","dialogue","runTemplateJS","close","document","on","updateConfiguredStatus","bind","processorHeader","closest","hasClass","processorName","request","methodname","args","call","fail","exception","result","userconfigured","notifications","removeClass"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Load the settings for a message processor.\n *\n * @module     core_message/notification_processor_settings\n * @class      notification_processor_settings\n * @package    message\n * @copyright  2016 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/fragment', 'core/templates', 'core/str', 'tool_lp/dialogue'],\n        function($, Ajax, Notification, Fragment, Templates, Str, Dialogue) {\n\n    var SELECTORS = {\n        PROCESSOR: '[data-processor-name]',\n        PREFERENCE_ROW: '[data-region=\"preference-row\"]',\n    };\n\n    /**\n     * Constructor for the notification processor settings.\n     *\n     * @param {object} element jQuery object root element of the processor\n     */\n    var NotificationProcessorSettings = function(element) {\n        this.root = $(element);\n        this.name = this.root.attr('data-name');\n        this.userId = this.root.attr('data-user-id');\n        this.contextId = this.root.attr('data-context-id');\n    };\n\n    /**\n     * Show the notification processor settings dialogue.\n     *\n     * @method show\n     */\n    NotificationProcessorSettings.prototype.show = function() {\n        Fragment.loadFragment('message', 'processor_settings', this.contextId, {\n            userid: this.userId,\n            type: this.name,\n        })\n        .done(function(html, js) {\n            Str.get_string('processorsettings', 'message').done(function(string) {\n                var dialogue = new Dialogue(\n                    string,\n                    html,\n                    function() {\n                        Templates.runTemplateJS(js);\n                    },\n                    function() {\n                        // Removed dialogue from the DOM after close.\n                        dialogue.close();\n                    }\n                );\n\n                $(document).on('mpp:formsubmitted', function() {\n                    dialogue.close();\n                    this.updateConfiguredStatus();\n                }.bind(this));\n\n                $(document).on('mpp:formcancelled', function() {\n                    dialogue.close();\n                });\n            }.bind(this));\n        }.bind(this));\n    };\n\n    /**\n     * Checks if the processor has been configured. If so then remove the unconfigured\n     * status from the interface.\n     *\n     * @method updateConfiguredStatus\n     * @return {Promise|boolean}\n     */\n    NotificationProcessorSettings.prototype.updateConfiguredStatus = function() {\n        var processorHeader = this.root.closest(SELECTORS.PROCESSOR);\n\n        if (!processorHeader.hasClass('unconfigured')) {\n            return false;\n        }\n\n        var processorName = processorHeader.attr('data-processor-name');\n        var request = {\n            methodname: 'core_message_get_message_processor',\n            args: {\n                name: processorName,\n                userid: this.userId,\n            },\n        };\n\n        return Ajax.call([request])[0]\n            .fail(Notification.exception)\n            .done(function(result) {\n                // Check if the user has figured configuring the processor.\n                if (result.userconfigured) {\n                    // If they have then we can enable the settings.\n                    var notifications = $(SELECTORS.PREFERENCE_ROW + ' [data-processor-name=\"' + processorName + '\"]');\n                    processorHeader.removeClass('unconfigured');\n                    notifications.removeClass('disabled');\n                }\n            });\n    };\n\n    return NotificationProcessorSettings;\n});\n"],"file":"notification_processor_settings.es6.js"}