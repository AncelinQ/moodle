{"version":3,"sources":["../src/message_area_search.js"],"names":["define","$","Ajax","Templates","Notification","Str","CustomEvents","Events","SELECTORS","CONTACTS","CONTACTSAREA","CONVERSATIONS","DELETESEARCHFILTER","LOADINGICON","SEARCHBOX","SEARCHFILTER","SEARCHFILTERAREA","SEARCHRESULTSAREA","SEARCHTEXTAREA","SEARCHUSERSINCOURSE","Search","messageArea","_init","prototype","_searchArea","_courseid","_isLoading","_numMessagesDisplayed","_numMessagesToRetrieve","_numUsersDisplayed","_numUsersToRetrieve","_searchAreas","MESSAGES","USERS","USERSINCOURSE","_requestTimeout","find","on","_searchRequest","bind","onDelegateEvent","events","activate","e","_setFilter","currentTarget","html","_setPlaceholderText","_clearSearchArea","data","_searchUsersInCourse","focus","_hideSearchResults","trigger","USERSSEARCHCANCELED","onCustomEvent","CONVERSATIONSSELECTED","CONTACTSSELECTED","MESSAGESENT","scrollBottom","_searchMessages","showContactsFirst","str","val","clearTimeout","trim","MESSAGESEARCHCANCELED","hide","show","setTimeout","_searchUsers","promises","call","methodname","args","userid","getCurrentUserId","search","limitfrom","limitnum","numberreceived","render","then","js","appendNodeContents","contacts","length","remove","replaceNodeContents","fail","exception","hascontacts","courses","hascourses","noncontacts","hasnoncontacts","courseid","text","get_string","s","attr","addClass","languagestring","catch","_clearFilters","removeClass","empty","removeAttr"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * The module handles searching contacts.\n *\n * @module     core_message/message_area_search\n * @package    core_message\n * @copyright  2016 Mark Nelson <markn@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/str', 'core/custom_interaction_events',\n        'core_message/message_area_events'],\n    function($, Ajax, Templates, Notification, Str, CustomEvents, Events) {\n\n    /** @type {Object} The list of selectors for the message area. */\n    var SELECTORS = {\n        CONTACTS: \"[data-region='contacts'][data-region-content='contacts']\",\n        CONTACTSAREA: \"[data-region='contacts-area']\",\n        CONVERSATIONS: \"[data-region='contacts'][data-region-content='conversations']\",\n        DELETESEARCHFILTER: \"[data-region='search-filter-area']\",\n        LOADINGICON: '.loading-icon',\n        SEARCHBOX: \"[data-region='search-box']\",\n        SEARCHFILTER: \"[data-region='search-filter']\",\n        SEARCHFILTERAREA: \"[data-region='search-filter-area']\",\n        SEARCHRESULTSAREA: \"[data-region='search-results-area']\",\n        SEARCHTEXTAREA: \"[data-region='search-text-area']\",\n        SEARCHUSERSINCOURSE: \"[data-action='search-users-in-course']\",\n    };\n\n    /**\n     * Search class.\n     *\n     * @param {Messagearea} messageArea The messaging area object.\n     */\n    function Search(messageArea) {\n        this.messageArea = messageArea;\n        this._init();\n    }\n\n    /** @type {Messagearea} The messaging area object. */\n    Search.prototype.messageArea = null;\n\n    /** @type {String} The area we are searching in. */\n    Search.prototype._searchArea = null;\n\n    /** @type {String} The id of the course we are searching in (if any). */\n    Search.prototype._courseid = null;\n\n    /** @type {Boolean} checks if we are currently loading  */\n    Search.prototype._isLoading = false;\n\n    /** @type {String} The number of messages displayed. */\n    Search.prototype._numMessagesDisplayed = 0;\n\n    /** @type {String} The number of messages to retrieve. */\n    Search.prototype._numMessagesToRetrieve = 20;\n\n    /** @type {String} The number of users displayed. */\n    Search.prototype._numUsersDisplayed = 0;\n\n    /** @type {String} The number of users to retrieve. */\n    Search.prototype._numUsersToRetrieve = 20;\n\n    /** @type {Array} The type of available search areas. **/\n    Search.prototype._searchAreas = {\n        MESSAGES: 'messages',\n        USERS: 'users',\n        USERSINCOURSE: 'usersincourse'\n    };\n\n    /** @type {int} The timeout before performing an ajax search */\n    Search.prototype._requestTimeout = null;\n\n    /**\n     * Initialise the event listeners.\n     *\n     * @private\n     */\n    Search.prototype._init = function() {\n        // Handle searching for text.\n        this.messageArea.find(SELECTORS.SEARCHTEXTAREA).on('input', this._searchRequest.bind(this));\n\n        // Handle clicking on a course in the list of users.\n        this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.SEARCHUSERSINCOURSE, function(e) {\n            this._setFilter($(e.currentTarget).html());\n            this._setPlaceholderText('searchforuser');\n            this._clearSearchArea();\n            this._searchArea = this._searchAreas.USERSINCOURSE;\n            this._courseid = $(e.currentTarget).data('courseid');\n            this._searchUsersInCourse();\n            this.messageArea.find(SELECTORS.SEARCHBOX).focus();\n        }.bind(this));\n\n        // Handle deleting the search filter.\n        this.messageArea.onDelegateEvent(CustomEvents.events.activate, SELECTORS.DELETESEARCHFILTER, function() {\n            this._hideSearchResults();\n            // Filter has been removed, so we don't want to be searching in a course anymore.\n            this._searchArea = this._searchAreas.USERS;\n            this._setPlaceholderText('searchforuserorcourse');\n            // Go back the contacts.\n            this.messageArea.trigger(Events.USERSSEARCHCANCELED);\n            this.messageArea.find(SELECTORS.SEARCHBOX).focus();\n        }.bind(this));\n\n        // Handle events that occur outside this module.\n        this.messageArea.onCustomEvent(Events.CONVERSATIONSSELECTED, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.MESSAGES;\n            this._setPlaceholderText('searchmessages');\n        }.bind(this));\n        this.messageArea.onCustomEvent(Events.CONTACTSSELECTED, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.USERS;\n            this._setPlaceholderText('searchforuserorcourse');\n        }.bind(this));\n        this.messageArea.onCustomEvent(Events.MESSAGESENT, function() {\n            this._hideSearchResults();\n            this._searchArea = this._searchAreas.MESSAGES;\n            this._setPlaceholderText('searchmessages');\n        }.bind(this));\n\n        // Event listeners for scrolling through messages and users in courses.\n        CustomEvents.define(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), [\n            CustomEvents.events.scrollBottom\n        ]);\n        this.messageArea.onDelegateEvent(CustomEvents.events.scrollBottom, SELECTORS.SEARCHRESULTSAREA,\n            function() {\n                if (this._searchArea == this._searchAreas.MESSAGES) {\n                    this._searchMessages();\n                } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n                    this._searchUsersInCourse();\n                }\n            }.bind(this)\n        );\n\n        // Set the initial search area.\n        this._searchArea = (this.messageArea.showContactsFirst()) ? this._searchAreas.USERS : this._searchAreas.MESSAGES;\n    };\n\n    /**\n     * Handles when search requests are sent.\n     *\n     * @private\n     */\n    Search.prototype._searchRequest = function() {\n        var str = this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').val();\n\n        if (this._requestTimeout) {\n            clearTimeout(this._requestTimeout);\n        }\n\n        if (str.trim() === '') {\n            // If nothing we being searched then we need to display the usual data.\n            if (this._searchArea == this._searchAreas.MESSAGES) {\n                this._hideSearchResults();\n                this.messageArea.trigger(Events.MESSAGESEARCHCANCELED);\n            } else if (this._searchArea == this._searchAreas.USERS) {\n                this._hideSearchResults();\n                this.messageArea.trigger(Events.USERSSEARCHCANCELED);\n            } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n                // We are still searching in a course, so need to list all the users again.\n                this._clearSearchArea();\n                this._searchUsersInCourse();\n            }\n            return;\n        }\n\n        this.messageArea.find(SELECTORS.CONVERSATIONS).hide();\n        this.messageArea.find(SELECTORS.CONTACTS).hide();\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).show();\n\n        if (this._searchArea == this._searchAreas.MESSAGES) {\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numMessagesDisplayed = 0;\n                this._searchMessages();\n            }.bind(this), 300);\n        } else if (this._searchArea == this._searchAreas.USERSINCOURSE) {\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numUsersDisplayed = 0;\n                this._searchUsersInCourse();\n            }.bind(this), 300);\n        } else { // Must be searching for users and courses\n            this._requestTimeout = setTimeout(function() {\n                this._clearSearchArea();\n                this._numUsersDisplayed = 0;\n                this._searchUsers();\n            }.bind(this), 300);\n        }\n    };\n\n    /**\n     * Handles searching for messages.\n     *\n     * @private\n     * @return {Promise|boolean} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchMessages = function() {\n        if (this._isLoading) {\n            return false;\n        }\n\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Tell the user we are loading items.\n        this._isLoading = true;\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_messages',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                search: str,\n                limitfrom: this._numMessagesDisplayed,\n                limitnum: this._numMessagesToRetrieve\n            }\n        }]);\n\n        // Keep track of the number of messages\n        var numberreceived = 0;\n        // Add loading icon to the end of the list.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            numberreceived = data.contacts.length;\n            return Templates.render('core_message/message_area_message_search_results', data);\n        }).then(function(html, js) {\n            // Remove the loading icon.\n            this.messageArea.find(SELECTORS.SEARCHRESULTSAREA + \" \" +\n                SELECTORS.LOADINGICON).remove();\n            // Only append data if we got data back.\n            if (numberreceived > 0) {\n                // Show the new content.\n                Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n                // Increment the number of contacts displayed.\n                this._numMessagesDisplayed += numberreceived;\n            } else if (this._numMessagesDisplayed == 0) { // Must have nothing to begin with.\n                // Replace the new content.\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n            }\n            // Mark that we are no longer busy loading data.\n            this._isLoading = false;\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Handles searching for users.\n     *\n     * @private\n     * @return {Promise} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchUsers = function() {\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_users',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                search: str,\n                limitnum: this._numUsersToRetrieve\n            }\n        }]);\n\n        // Perform the search and replace the content.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            if (data.contacts.length > 0) {\n                data.hascontacts = true;\n            }\n            if (data.courses.length > 0) {\n                data.hascourses = true;\n            }\n            if (data.noncontacts.length > 0) {\n                data.hasnoncontacts = true;\n            }\n            return Templates.render('core_message/message_area_user_search_results', data);\n        }).then(function(html, js) {\n            Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Handles searching for users in a course.\n     *\n     * @private\n     * @return {Promise|boolean} The promise resolved when the search area has been rendered\n     */\n    Search.prototype._searchUsersInCourse = function() {\n        if (this._isLoading) {\n            return false;\n        }\n\n        var str = this.messageArea.find(SELECTORS.SEARCHBOX).val();\n\n        // Tell the user we are loading items.\n        this._isLoading = true;\n\n        // Call the web service to get our data.\n        var promises = Ajax.call([{\n            methodname: 'core_message_data_for_messagearea_search_users_in_course',\n            args: {\n                userid: this.messageArea.getCurrentUserId(),\n                courseid: this._courseid,\n                search: str,\n                limitfrom: this._numUsersDisplayed,\n                limitnum: this._numUsersToRetrieve\n            }\n        }]);\n\n        // Keep track of the number of contacts\n        var numberreceived = 0;\n        // Add loading icon to the end of the list.\n        return Templates.render('core/loading', {}).then(function(html, js) {\n            Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA),\n                \"<div style='text-align:center'>\" + html + \"</div>\", js);\n            return promises[0];\n        }.bind(this)).then(function(data) {\n            numberreceived = data.contacts.length;\n            if (numberreceived > 0) {\n                data.hascontacts = true;\n            }\n            return Templates.render('core_message/message_area_user_search_results', data);\n        }).then(function(html, js) {\n            // Remove the loading icon.\n            this.messageArea.find(SELECTORS.SEARCHRESULTSAREA + \" \" +\n                SELECTORS.LOADINGICON).remove();\n            // Only append data if we got data back.\n            if (numberreceived > 0) {\n                // Show the new content.\n                Templates.appendNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n                // Increment the number of contacts displayed.\n                this._numUsersDisplayed += numberreceived;\n            } else if (this._numUsersDisplayed == 0) { // Must have nothing to begin with.\n                // Replace the new content.\n                Templates.replaceNodeContents(this.messageArea.find(SELECTORS.SEARCHRESULTSAREA), html, js);\n            }\n            // Mark that we are no longer busy loading data.\n            this._isLoading = false;\n        }.bind(this)).fail(Notification.exception);\n    };\n\n    /**\n     * Sets placeholder text for search input.\n     *\n     * @private\n     * @param {String} text The placeholder text\n     * @return {Promise} The promise resolved when the placeholder text has been set\n     */\n    Search.prototype._setPlaceholderText = function(text) {\n        return Str.get_string(text, 'message').then(function(s) {\n            this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').attr('placeholder', s);\n        }.bind(this));\n    };\n\n    /**\n     * Sets filter for search input.\n     *\n     * @private\n     * @param {String} text The filter text\n     */\n    Search.prototype._setFilter = function(text) {\n        this.messageArea.find(SELECTORS.SEARCHBOX).val('');\n        this.messageArea.find(SELECTORS.CONTACTSAREA).addClass('searchfilter');\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).show();\n        this.messageArea.find(SELECTORS.SEARCHFILTER).html(text);\n        Str.get_string('removecoursefilter', 'message', text).then(function(languagestring) {\n            this.messageArea.find(SELECTORS.SEARCHFILTERAREA).attr('aria-label', languagestring);\n        }.bind(this)).catch(Notification.exception);\n    };\n\n    /**\n     * Hides filter for search input.\n     *\n     * @private\n     */\n    Search.prototype._clearFilters = function() {\n        this.messageArea.find(SELECTORS.CONTACTSAREA).removeClass('searchfilter');\n        this.messageArea.find(SELECTORS.SEARCHFILTER).empty();\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).hide();\n        this.messageArea.find(SELECTORS.SEARCHFILTERAREA).removeAttr('aria-label');\n    };\n\n    /**\n     * Handles clearing the search area.\n     *\n     * @private\n     */\n    Search.prototype._clearSearchArea = function() {\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).empty();\n    };\n\n    /**\n     * Handles hiding the search area.\n     *\n     * @private\n     */\n    Search.prototype._hideSearchResults = function() {\n        this._clearFilters();\n        this.messageArea.find(SELECTORS.SEARCHTEXTAREA + ' input').val('');\n        this._clearSearchArea();\n        this.messageArea.find(SELECTORS.SEARCHRESULTSAREA).hide();\n    };\n\n    return Search;\n});\n"],"file":"message_area_search.es6.js"}