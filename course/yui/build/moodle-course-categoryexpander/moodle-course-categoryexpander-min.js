YUI.add("moodle-course-categoryexpander",function(e,t){var n={CATEGORYCONTENT:"content",LOADED:"loaded",NOTLOADED:"notloaded",SECTIONCOLLAPSED:"collapsed",HASCHILDREN:"with_children"},r={CATEGORYCONTENT:"div.content",CATEGORYTREE:"div.course_category_tree",LISTENLINK:"div.info .name",PARENTWITHCHILDREN:"div.category"},i=e.namespace("Moodle.course.categoryexpander"),s=M.cfg.wwwroot+"/course/category.ajax.php";i.init=function(){e.one(e.config.doc).delegate("click",this.toggle_expansion,r.LISTENLINK,this)},i.toggle_expansion=function(t){var i,o,u;if(t.target.test("a")||t.target.test("img"))return;i=t.target.ancestor(r.PARENTWITHCHILDREN,!0);if(!i.hasClass(n.HASCHILDREN))return;if(i.hasClass(n.LOADED)){this._toggle_expansion(i);return}o=i.getData("categoryid");if(typeof o=="undefined")return;u=M.util.add_spinner(e,i.one(r.LISTENLINK)).show(),e.io(s,{method:"POST",context:this,on:{complete:this.process_category_results},data:{categoryid:o,showcourses:i.getData("showcourses")},arguments:{categorynode:i,spinner:u}})},i._toggle_expansion=function(e){var t=e.one(r.CATEGORYCONTENT);this.add_animation(t),e.hasClass(n.SECTIONCOLLAPSED)?(t.setStyle("height","0"),e.removeClass(n.SECTIONCOLLAPSED),t.fx.set("reverse",!1)):(t.fx.set("reverse",!0),t.fx.once("end",function(e,t){t.addClass(n.SECTIONCOLLAPSED)},this,e)),t.fx.once("end",function(e,t){t.setStyles({height:"",opacity:""}),this.destroy()},t.fx,t),t.fx.run()},i.process_category_results=function(t,i,s){var o,u,a;try{a=e.JSON.parse(i.responseText);if(a.error)return new M.core.ajaxException(a)}catch(f){return new M.core.exception(f)}o=e.Node.create(a).one(r.CATEGORYTREE),s.categorynode.addClass(n.LOADED).removeClass(n.NOTLOADED),u=s.categorynode.one(r.CATEGORYCONTENT),u.appendChild(o),this._toggle_expansion(s.categorynode),s.spinner.hide().destroy()},i.add_animation=function(t){return typeof t.fx!="undefined"?t:(t.plug(e.Plugin.NodeFX,{from:{height:0,opacity:0},to:{height:function(e){return e.get("scrollHeight")},opacity:1},duration:.3}),t)}},"@VERSION@",{requires:["node","io-base","json-parse","moodle-core-notification","anim"]});
