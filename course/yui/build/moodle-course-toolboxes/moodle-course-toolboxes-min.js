YUI.add("moodle-course-toolboxes",function(e,t){WAITICON={pix:"i/loading_small",component:"moodle"};var n={ACTIVITYLI:"li.activity",COMMANDSPAN:"span.commands",SPINNERCOMMANDSPAN:"span.commands",CONTENTAFTERLINK:"div.contentafterlink",DELETE:"a.editing_delete",DIMCLASS:"dimmed",DIMMEDTEXT:"dimmed_text",EDITTITLE:"a.editing_title",EDITTITLECLASS:"edittitle",GENERICICONCLASS:"iconsmall",GROUPSNONE:"a.editing_groupsnone",GROUPSSEPARATE:"a.editing_groupsseparate",GROUPSVISIBLE:"a.editing_groupsvisible",HASLABEL:"label",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",LIGHTBOX:"lightbox",MODINDENTCOUNT:"mod-indent-",MODINDENTDIV:"div.mod-indent",MODINDENTHUGE:"mod-indent-huge",MODULEIDPREFIX:"module-",MOVELEFT:"a.editing_moveleft",MOVELEFTCLASS:"editing_moveleft",MOVERIGHT:"a.editing_moveright",PAGECONTENT:"div#page-content",RIGHTSIDE:".right",SECTIONHIDDENCLASS:"hidden",SECTIONIDPREFIX:"section-",SECTIONLI:"li.section",SHOW:"a.editing_show",SHOWHIDE:"a.editing_showhide",CONDITIONALHIDDEN:"conditionalhidden",AVAILABILITYINFODIV:"div.availabilityinfo",SHOWCLASS:"editing_show",ACCESSHIDECLASS:"accesshide"},r=function(){r.superclass.constructor.apply(this,arguments)};e.extend(r,e.Base,{toggle_hide_resource_ui:function(e){var t=e.ancestor(n.ACTIVITYLI),r=e.one("img"),i,s;this.is_label(t)?(s=n.DIMMEDTEXT,i=t.one(n.MODINDENTDIV+" div")):(s=n.DIMCLASS,i=t.one("a"));var o="",u;e.hasClass(n.SHOWCLASS)?(o="hide",u=1):(o="show",u=0);var a=M.util.get_string(o,"moodle");r.setAttrs({alt:a,src:M.util.image_url("t/"+o)}),e.set("title",a),e.set("className","editing_"+o),i.hasClass(n.CONDITIONALHIDDEN)||(i.toggleClass(s),t.all(n.CONTENTAFTERLINK).toggleClass(n.DIMMEDTEXT));var f=t.one(n.AVAILABILITYINFODIV);return f&&f.toggleClass(n.ACCESSHIDECLASS),u},send_request:function(t,n,r){t||(t={});var i=this.get("config").pageparams;for(varname in i)t[varname]=i[varname];t.sesskey=M.cfg.sesskey,t.courseId=this.get("courseid");var s=M.cfg.wwwroot+this.get("ajaxurl"),o=[],u={method:"POST",data:t,on:{success:function(t,r){try{o=e.JSON.parse(r.responseText),o.error&&new M.core.ajaxException(o)}catch(i){}n&&window.setTimeout(function(e){n.hide()},400)},failure:function(e,t){n&&n.hide(),new M.core.ajaxException(t)}},context:this,sync:!0};if(r)for(varname in r)u[varname]=r[varname];return n&&n.show(),e.io(s,u),o},is_label:function(e){return e.hasClass(n.HASLABEL)},get_element_id:function(e){return e.get("id").replace(n.MODULEIDPREFIX,"")},get_section_id:function(e){return e.get("id").replace(n.SECTIONIDPREFIX,"")}},{NAME:"course-toolbox",ATTRS:{courseid:{value:0},ajaxurl:{value:0},config:{value:0}}});var i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,r,{GROUPS_NONE:0,GROUPS_SEPARATE:1,GROUPS_VISIBLE:2,initializer:function(t){this.setup_for_resource(),M.course.coursebase.register_module(this);var r=n.ACTIVITYLI+" "+n.COMMANDSPAN+" ";e.delegate("click",this.edit_resource_title,n.PAGECONTENT,r+n.EDITTITLE,this),e.delegate("click",this.move_left,n.PAGECONTENT,r+n.MOVELEFT,this),e.delegate("click",this.move_right,n.PAGECONTENT,r+n.MOVERIGHT,this),e.delegate("click",this.delete_resource,n.PAGECONTENT,r+n.DELETE,this),e.delegate("click",this.toggle_hide_resource,n.PAGECONTENT,r+n.HIDE,this),e.delegate("click",this.toggle_hide_resource,n.PAGECONTENT,r+n.SHOW,this),e.delegate("click",this.toggle_groupmode,n.PAGECONTENT,r+n.GROUPSNONE,this),e.delegate("click",this.toggle_groupmode,n.PAGECONTENT,r+n.GROUPSSEPARATE,this),e.delegate("click",this.toggle_groupmode,n.PAGECONTENT,r+n.GROUPSVISIBLE,this)},setup_for_resource:function(t){if(!t)var t=n.PAGECONTENT+" "+n.ACTIVITYLI;e.all(t).each(this._setup_for_resource,this)},_setup_for_resource:function(t){t=e.one(t);var r=t.all(n.COMMANDSPAN+" "+n.HIDE);r.concat(t.all(n.COMMANDSPAN+" "+n.SHOW)),r.each(function(e){var t=e.ancestor(n.SECTIONLI);t&&t.hasClass(n.SECTIONHIDDENCLASS)&&e.setStyle("cursor","auto")});var i;i=t.all(n.COMMANDSPAN+" "+n.GROUPSNONE),i.setAttribute("groupmode",this.GROUPS_NONE),i=t.all(n.COMMANDSPAN+" "+n.GROUPSSEPARATE),i.setAttribute("groupmode",this.GROUPS_SEPARATE),i=t.all(n.COMMANDSPAN+" "+n.GROUPSVISIBLE),i.setAttribute("groupmode",this.GROUPS_VISIBLE)},move_left:function(e){this.move_leftright(e,-1)},move_right:function(e){this.move_leftright(e,1)},move_leftright:function(t,r){t.preventDefault();var i=t.target.ancestor(n.ACTIVITYLI),s=i.one(n.MODINDENTDIV),o=s.getAttribute("class").match(/mod-indent-(\d{1,})/);if(o){var u=parseInt(o[1]),a=Math.max(0,u+parseInt(r));s.removeClass(o[0])}else var u=0,a=1;s.addClass(n.MODINDENTCOUNT+a);var f={"class":"resource",field:"indent",value:a,id:this.get_element_id(i)},l=M.util.add_spinner(e,i.one(n.SPINNERCOMMANDSPAN));this.send_request(f,l),a==0?i.one(n.MOVELEFT).remove():a==1&&u==0&&this.add_moveleft(i);var c=s.hasClass(n.MODINDENTHUGE);a>15&&!c?s.addClass(n.MODINDENTHUGE):a<=15&&c&&s.removeClass(n.MODINDENTHUGE)},delete_resource:function(e){e.preventDefault();var t=e.target.ancestor(n.ACTIVITYLI),r="";if(this.is_label(t)){var i={type:M.util.get_string("pluginname","label")};r=M.util.get_string("deletechecktype","moodle",i)}else{var i={type:M.util.get_string("pluginname",t.getAttribute("class").match(/modtype_([^\s]*)/)[1]),name:t.one(n.INSTANCENAME).get("firstChild").get("data")};r=M.util.get_string("deletechecktypename","moodle",i)}if(!confirm(r))return!1;t.remove();var s={"class":"resource",action:"DELETE",id:this.get_element_id(t)};this.send_request(s)},toggle_hide_resource:function(t){t.preventDefault();var r=t.target.ancestor(M.course.format.get_section_selector(e));if(r&&r.hasClass(n.SECTIONHIDDENCLASS))return;var i=t.target.ancestor(n.ACTIVITYLI),s=t.target.ancestor("a",!0),o=this.toggle_hide_resource_ui(s),u={"class":"resource",field:"visible",value:o,id:this.get_element_id(i)},a=M.util.add_spinner(e,i.one(n.SPINNERCOMMANDSPAN));return this.send_request(u,a),!1},toggle_groupmode:function(t){t.preventDefault();var r=t.target.ancestor(n.ACTIVITYLI),i=t.target.ancestor("a",!0),s=i.one("img"),o=i.getAttribute("groupmode");o++,o>2&&(o=0),i.setAttribute("groupmode",o);var u="",a="";switch(o){case this.GROUPS_NONE:u="groupsnone",a=M.util.image_url("t/groupn");break;case this.GROUPS_SEPARATE:u="groupsseparate",a=M.util.image_url("t/groups");break;case this.GROUPS_VISIBLE:u="groupsvisible",a=M.util.image_url("t/groupv")}u=M.util.get_string("clicktochangeinbrackets","moodle",M.util.get_string(u,"moodle")),s.setAttrs({alt:u,src:a}),i.setAttribute("title",u);var f={"class":"resource",field:"groupmode",value:o,id:this.get_element_id(r)},l=M.util.add_spinner(e,r.one(n.SPINNERCOMMANDSPAN));return this.send_request(f,l),!1},add_moveleft:function(t){var r=M.util.get_string("moveleft","moodle"),i="t/left";e.one(document.body).hasClass("dir-rtl")?i="t/right":i="t/left";var s=e.Node.create("<img />").addClass(n.GENERICICONCLASS).setAttrs({src:M.util.image_url(i,"moodle"),alt:r}),o=t.one(n.MOVERIGHT),u=o.getAttribute("href").replace("indent=1","indent=-1"),a=(new e.Node.create("<a />")).setStyle("cursor","pointer").addClass(n.MOVELEFTCLASS).setAttribute("href",u).setAttribute("title",r);a.appendChild(s),o.insert(a,"before")},edit_resource_title:function(t){var r=t.target.ancestor(n.ACTIVITYLI),i=r.one("div"),s=r.one(n.INSTANCENAME),o=s.get("firstChild"),u=o.get("data"),a=u,f=r.one("a."+n.EDITTITLECLASS+" img"),l=[],c,h=s.ancestor("a"),p={"class":"resource",field:"gettitle",id:this.get_element_id(r)},d=this.send_request(p,f);d.instancename&&(a=d.instancename);var v=e.Node.create("<input />").setAttrs({name:"title",value:a,autocomplete:"off"}).addClass("titleeditor"),m=e.Node.create("<form />").addClass("activityinstance").setAttribute("action","#"),g=e.Node.create("<span />").addClass("editinstructions").set("innerHTML",M.util.get_string("edittitleinstructions","moodle")),y=r.one("img.activityicon").cloneNode();o.set("data",""),m.appendChild(y),m.appendChild(v),h.replace(m),i.appendChild(g),t.preventDefault(),v.focus().select();var b=function(){var e;while(e=l.shift())e.detach();g&&(m.replace(h),g.remove(),g=null)},w=function(e){b(),o.set("data",u)};c=v.on("blur",w),l.push(c),c=e.one("document").on("keyup",function(e){e.keyCode==27&&w(e)}),l.push(c),c=m.on("submit",function(t){t.preventDefault(),b();var n=e.Lang.trim(v.get("value"));if(n!=null&&n!=""&&n!=a){var i={"class":"resource",field:"updatetitle",title:n,id:this.get_element_id(r)},s=this.send_request(i,f);s.instancename&&o.set("data",s.instancename)}else o.set("data",u)},this),l.push(c)}},{NAME:"course-resource-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"}}});var s=function(){s.superclass.constructor.apply(this,arguments)};e.extend(s,r,{initializer:function(t){this.setup_for_section(),M.course.coursebase.register_module(this),e.delegate("click",this.toggle_highlight,n.PAGECONTENT,n.SECTIONLI+" "+n.HIGHLIGHT,this),e.delegate("click",this.toggle_hide_section,n.PAGECONTENT,n.SECTIONLI+" "+n.SHOWHIDE,this)},setup_for_section:function(e){},_setup_for_section:function(e){},toggle_hide_section:function(t){t.preventDefault();var r=t.target.ancestor(M.course.format.get_section_selector(e)),i=t.target.ancestor("a",!0),s=i.one("img"),o,u;r.hasClass(n.SECTIONHIDDENCLASS)?(r.removeClass(n.SECTIONHIDDENCLASS),o=1,u="hide"):(r.addClass(n.SECTIONHIDDENCLASS),o=0,u="show");var a=M.util.get_string(u+"fromothers","format_"+this.get("format"));s.setAttrs({alt:a,src:M.util.image_url("i/"+u)}),i.set("title",a);var f={"class":"section",field:"visible",id:this.get_section_id(r.ancestor(M.course.format.get_section_wrapper(e),!0)),value:o},l=M.util.add_lightbox(e,r);l.show();var c=this.send_request(f,l),h=r.all(n.ACTIVITYLI);h.each(function(t){if(t.one(n.SHOW))var r=t.one(n.SHOW);else var r=t.one(n.HIDE);var i=this.get_element_id(t);e.Array.indexOf(c.resourcestotoggle,i)!=-1&&this.toggle_hide_resource_ui(r),o==0?r.setStyle("cursor","auto"):r.setStyle("cursor","pointer")},this)},toggle_highlight:function(t){t.preventDefault();var r=t.target.ancestor(M.course.format.get_section_selector(e)),i=t.target.ancestor("a",!0),s=i.one("img"),o=r.hasClass("current"),u=0,a=M.util.get_string("markthistopic","moodle");e.one(n.PAGECONTENT).all(M.course.format.get_section_selector(e)+".current "+n.HIGHLIGHT).set("title",a),e.one(n.PAGECONTENT).all(M.course.format.get_section_selector(e)+".current "+n.HIGHLIGHT+" img").set("alt",a).set("src",M.util.image_url("i/marker"));var f=e.one(n.PAGECONTENT).all(M.course.format.get_section_selector(e)).removeClass("current");if(!o){r.addClass("current"),u=this.get_section_id(r.ancestor(M.course.format.get_section_wrapper(e),!0));var l=M.util.get_string("markedthistopic","moodle");i.set("title",l),s.set("alt",l).set("src",M.util.image_url("i/marked"))}var c={"class":"course",field:"marker",value:u},h=M.util.add_lightbox(e,r);h.show(),this.send_request(c,h)}},{NAME:"course-section-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"}}}),M.course=M.course||{},M.course.init_resource_toolbox=function(e){return new i(e)},M.course.init_section_toolbox=function(e){return new s(e)}},"@VERSION@",{requires:["base","node","io","moodle-course-coursebase"]});
