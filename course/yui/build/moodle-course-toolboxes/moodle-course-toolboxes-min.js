YUI.add("moodle-course-toolboxes",function(e,t){var n={ACTIVITYINSTANCE:"activityinstance",AVAILABILITYINFODIV:"div.availabilityinfo",CONDITIONALHIDDEN:"conditionalhidden",DIMCLASS:"dimmed",DIMMEDTEXT:"dimmed_text",EDITINSTRUCTIONS:"editinstructions",HIDE:"hide",MODINDENTCOUNT:"mod-indent-",MODINDENTHUGE:"mod-indent-huge",MODULEIDPREFIX:"module-",SECTIONHIDDENCLASS:"hidden",SECTIONIDPREFIX:"section-",SHOW:"editing_show",TITLEEDITOR:"titleeditor"},r={ACTIONLINKTEXT:".actionlinktext",ACTIVITYACTION:"a.cm-edit-action[data-action]",ACTIVITYFORM:"form."+n.ACTIVITYINSTANCE,ACTIVITYICON:"img.activityicon",ACTIVITYLI:"li.activity",ACTIVITYTITLE:"input[name=title]",COMMANDSPAN:".commands",CONTENTAFTERLINK:"div.contentafterlink",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",MODINDENTDIV:"div.mod-indent",PAGECONTENT:"div#page-content",SECTIONLI:"li.section",SHOW:"a."+n.SHOW,SHOWHIDE:"a.editing_showhide"},i=e.one(document.body);M.course=M.course||{};var s=function(){s.superclass.constructor.apply(this,arguments)};e.extend(s,e.Base,{send_request:function(t,n,r){t||(t={});var i=this.get("config").pageparams,s;for(s in i)t[s]=i[s];t.sesskey=M.cfg.sesskey,t.courseId=this.get("courseid");var o=M.cfg.wwwroot+this.get("ajaxurl"),u=[],a={method:"POST",data:t,on:{success:function(t,r){try{u=e.JSON.parse(r.responseText),u.error&&new M.core.ajaxException(u)}catch(i){}n&&window.setTimeout(function(){n.hide()},400)},failure:function(e,t){n&&n.hide(),new M.core.ajaxException(t)}},context:this,sync:!0};if(r)for(s in r)a[s]=r[s];return n&&n.show(),e.io(o,a),u}},{NAME:"course-toolbox",ATTRS:{courseid:{value:0},ajaxurl:{value:0},config:{value:0}}});var o=function(){o.superclass.constructor.apply(this,arguments)};e.extend(o,s,{GROUPS_NONE:0,GROUPS_SEPARATE:1,GROUPS_VISIBLE:2,edittitleevents:[],initializer:function(){M.course.coursebase.register_module(this),e.delegate("click",this.handle_data_action,i,r.ACTIVITYACTION,this)},setup_for_resource:function(t){t=e.one(t)},handle_data_action:function(e){var t=e.target;t.test("a")||(t=t.ancestor(r.ACTIVITYACTION));var n=t.getData("action"),i=t.ancestor(r.ACTIVITYLI);if(!t.test("a")||!n||!i)return;switch(n){case"edittitle":this.edit_title(e,t,i,n);break;case"moveleft":case"moveright":this.change_indent(e,t,i,n);break;case"delete":this.delete_with_confirmation(e,t,i,n);break;case"hide":case"show":this.change_visibility(e,t,i,n);break;case"groupsseparate":case"groupsvisible":case"groupsnone":callback="change_groupmode",this.change_groupmode(e,t,i,n);break;default:}},change_indent:function(t,s,o,u){t.preventDefault();var a=u==="moveleft"?-1:1,f=o.one(r.MODINDENTDIV),l=f.getAttribute("class").match(/mod-indent-(\d{1,})/),c,h;l?(c=parseInt(l[1],10),h=Math.max(0,c+parseInt(a,10)),f.removeClass(l[0])):(c=0,h=1),f.addClass(n.MODINDENTCOUNT+h);var p={"class":"resource",field:"indent",value:h,id:e.Moodle.core_course.util.cm.getId(o)},d=o.one(r.COMMANDSPAN),v=M.util.add_spinner(e,d).setStyles({position:"absolute",top:0});i.hasClass("dir-ltr")?v.setStyle("left","100%"):v.setStyle("right","100%"),this.send_request(p,v),h===0?s.addClass("hidden"):h===1&&c===0&&s.ancestor(".menu").one("[data-action=moveleft]").removeClass("hidden");var m=f.hasClass(n.MODINDENTHUGE);h>15&&!m?f.addClass(n.MODINDENTHUGE):h<=15&&m&&f.removeClass(n.MODINDENTHUGE)},delete_with_confirmation:function(t,n,r){t.preventDefault();var i=r,s="",o={type:M.util.get_string("pluginname",i.getAttribute("class").match(/modtype_([^\s]*)/)[1])};e.Moodle.core_course.util.cm.getName(i)!==null?(o.name=e.Moodle.core_course.util.cm.getName(i),s=M.util.get_string("deletechecktypename","moodle",o)):s=M.util.get_string("deletechecktype","moodle",o);if(!confirm(s))return!1;i.remove();var u={"class":"resource",action:"DELETE",id:e.Moodle.core_course.util.cm.getId(i)};this.send_request(u),M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu()},change_visibility:function(t,i,s,o){t.preventDefault();var u=s.ancestor(M.course.format.get_section_selector(e));if(u&&u.hasClass(n.SECTIONHIDDENCLASS))return;var a=s,f=this.handle_resource_dim(i,s,o),l={"class":"resource",field:"visible",value:f,id:e.Moodle.core_course.util.cm.getId(a)},c=M.util.add_spinner(e,a.one(r.COMMANDSPAN));return this.send_request(l,c),!1},handle_resource_dim:function(t,i,s){var o=n.DIMCLASS,u=i.one("a"),a=i.one(n.AVAILABILITYINFODIV),f=s==="hide"?"show":"hide";return newstring=M.util.get_string(f,"moodle"),t.one("img").setAttrs({alt:newstring,src:M.util.image_url("t/"+f)}),t.set("title",newstring),t.replaceClass("editing_"+s,"editing_"+f),t.setData("action",f),e.Moodle.core_course.util.cm.getName(i)===null&&(o=n.DIMMEDTEXT,u=i.all(r.MODINDENTDIV+" > div").item(1)),u.hasClass(n.CONDITIONALHIDDEN)||(u.toggleClass(o),i.all(r.CONTENTAFTERLINK).toggleClass(n.DIMMEDTEXT)),a&&a.toggleClass(n.HIDE),s==="hide"?0:1},change_groupmode:function(t,n,i){t.preventDefault();var s=parseInt(n.getData("nextgroupmode"),10),o="",u="",a,f,l,c=s+1;return c>2&&(c=0),s===this.GROUPS_NONE?(o="groupsnone",u=M.util.image_url("t/groupn","moodle")):s===this.GROUPS_SEPARATE?(o="groupsseparate",u=M.util.image_url("t/groups","moodle")):s===this.GROUPS_VISIBLE&&(o="groupsvisible",u=M.util.image_url("t/groupv","moodle")),a=M.util.get_string(o,"moodle"),a=M.util.get_string("clicktochangeinbrackets","moodle",a),n.one("img").setAttrs({alt:a,src:u}),n.setAttribute("title",a).setData("action",o).setData("nextgroupmode",c),f={"class":"resource",field:"groupmode",value:s,id:e.Moodle.core_course.util.cm.getId(i)},l=M.util.add_spinner(e,i.one(r.COMMANDSPAN)),this.send_request(f,l),!1},edit_title:function(t,i,s){var o=e.Moodle.core_course.util.cm.getId(s),u=s.one(r.INSTANCENAME),a=u.get("firstChild"),f=a.get("data"),l=f,c,h=u.ancestor("a"),p={"class":"resource",field:"gettitle",id:o},d=this.send_request(p);M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu(),d.instancename&&(l=d.instancename);var v=e.Node.create('<form class="'+
n.ACTIVITYINSTANCE+'" action="#" />'),m=e.Node.create('<span class="'+n.EDITINSTRUCTIONS+'" id="id_editinstructions" />').set("innerHTML",M.util.get_string("edittitleinstructions","moodle")),g=e.Node.create('<input name="title" type="text" class="'+n.TITLEEDITOR+'" />').setAttrs({value:l,autocomplete:"off","aria-describedby":"id_editinstructions",maxLength:"255"});v.appendChild(s.one(r.ACTIVITYICON).cloneNode()),v.appendChild(g),v.setData("anchor",h),h.replace(v),s.one("div").appendChild(m),t.preventDefault(),g.focus().select(),c=g.on("blur",this.edit_title_cancel,this,s,!1),this.edittitleevents.push(c),c=g.on("key",this.edit_title_cancel,"esc",this,s,!0),this.edittitleevents.push(c),c=v.on("submit",this.edit_title_submit,this,s,f),this.edittitleevents.push(c)},edit_title_submit:function(t,n,i){t.preventDefault();var s=e.Lang.trim(n.one(r.ACTIVITYFORM+" "+r.ACTIVITYTITLE).get("value"));this.edit_title_clear(n);var o=M.util.add_spinner(e,n.one(r.INSTANCENAME));if(s!==null&&s!==""&&s!==i){var u={"class":"resource",field:"updatetitle",title:s,id:e.Moodle.core_course.util.cm.getId(n)},a=this.send_request(u,o);a.instancename&&n.one(r.INSTANCENAME).setContent(a.instancename)}},edit_title_cancel:function(e,t,n){n&&e.preventDefault(),this.edit_title_clear(t)},edit_title_clear:function(e){var t;while(this.edittitleevents.length>0)t=this.edittitleevents.shift(),t.detach();var n=e.one(r.ACTIVITYFORM),i=e.one("#id_editinstructions");n&&n.replace(n.getData("anchor")),i&&i.remove()},set_visibility_resource_ui:function(e){var t=e.element,n=e.visible,i=t.one(r.SHOW),s=i===null,o="show";s&&(i=t.one(r.HIDE),o="hide"),s!==n&&this.handle_resource_dim(i,t,o)}},{NAME:"course-resource-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"}}}),M.course.resource_toolbox=null,M.course.init_resource_toolbox=function(e){return M.course.resource_toolbox=new o(e),M.course.resource_toolbox};var u=function(){u.superclass.constructor.apply(this,arguments)};e.extend(u,s,{initializer:function(){M.course.coursebase.register_module(this),e.delegate("click",this.toggle_highlight,r.PAGECONTENT,r.SECTIONLI+" "+r.HIGHLIGHT,this),e.delegate("click",this.toggle_hide_section,r.PAGECONTENT,r.SECTIONLI+" "+r.SHOWHIDE,this)},toggle_hide_section:function(t){t.preventDefault();var i=t.target.ancestor(M.course.format.get_section_selector(e)),s=t.target.ancestor("a",!0),o=s.one("img"),u,a,f;i.hasClass(n.SECTIONHIDDENCLASS)?(i.removeClass(n.SECTIONHIDDENCLASS),u=1,a="show",f="hide"):(i.addClass(n.SECTIONHIDDENCLASS),u=0,a="hide",f="show");var l=M.util.get_string(f+"fromothers","format_"+this.get("format"));o.setAttrs({alt:l,src:M.util.image_url("i/"+f)}),s.set("title",l);var c={"class":"section",field:"visible",id:e.Moodle.core_course.util.section.getId(i.ancestor(M.course.format.get_section_wrapper(e),!0)),value:u},h=M.util.add_lightbox(e,i);h.show();var p=this.send_request(c,h),d=i.all(r.ACTIVITYLI);d.each(function(t){var n;t.one(r.SHOW)?n=t.one(r.SHOW):n=t.one(r.HIDE);var i=e.Moodle.core_course.util.cm.getId(t);e.Array.indexOf(p.resourcestotoggle,""+i)!==-1&&M.course.resource_toolbox.handle_resource_dim(n,t,a)},this)},toggle_highlight:function(t){t.preventDefault();var n=t.target.ancestor(M.course.format.get_section_selector(e)),i=t.target.ancestor("a",!0),s=i.one("img"),o=n.hasClass("current"),u=0,a=M.util.get_string("markthistopic","moodle");e.one(r.PAGECONTENT).all(M.course.format.get_section_selector(e)+".current "+r.HIGHLIGHT).set("title",a),e.one(r.PAGECONTENT).all(M.course.format.get_section_selector(e)+".current "+r.HIGHLIGHT+" img").set("alt",a).set("src",M.util.image_url("i/marker")),e.one(r.PAGECONTENT).all(M.course.format.get_section_selector(e)).removeClass("current");if(!o){n.addClass("current"),u=e.Moodle.core_course.util.section.getId(n.ancestor(M.course.format.get_section_wrapper(e),!0));var f=M.util.get_string("markedthistopic","moodle");i.set("title",f),s.set("alt",f).set("src",M.util.image_url("i/marked"))}var l={"class":"course",field:"marker",value:u},c=M.util.add_lightbox(e,n);c.show(),this.send_request(l,c)}},{NAME:"course-section-toolbox",ATTRS:{courseid:{value:0},format:{value:"topics"}}}),M.course.init_section_toolbox=function(e){return new u(e)}},"@VERSION@",{requires:["base","node","io","moodle-course-coursebase"]});
