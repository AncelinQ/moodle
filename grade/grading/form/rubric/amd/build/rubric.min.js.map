{"version":3,"sources":["../src/rubric.js"],"names":["init","root","domElement","document","getElementById","registerActionListeners","setInitialFocus","querySelectorAll","forEach","criterion","querySelector","setAttribute","addEventListener","e","button","target","closest","levelClick","matches","targetLevel","allLevels","currentIndex","Array","from","indexOf","maxIndex","length","newIndex","keyCode","preventDefault","clickedLevel","level","radio","isEqualNode","classList","add","focus","remove","removeAttribute"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module will tie together all of the different calls the gradable module will make.\n *\n * @module     gradingform_rubric/rubric\n * @package    core_grades\n * @copyright  2019 Mathew May <mathew.solutions>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const init = (root) => {\n    const domElement = document.getElementById(root);\n    registerActionListeners(domElement);\n    setInitialFocus(domElement);\n};\n\nconst setInitialFocus = domElement => {\n    domElement.querySelectorAll('.criterion').forEach(criterion => {\n        if (!criterion.querySelector('[tabindex=\"0\"]')) {\n            criterion.querySelector('.level').setAttribute('tabindex', 0);\n        }\n    });\n};\n\nconst registerActionListeners = (domElement) => {\n    domElement.addEventListener('click', (e) => {\n        const button = e.target.closest('.level');\n        if (button) {\n            levelClick(button);\n        }\n    });\n\n    domElement.addEventListener('keydown', e => {\n        const target = e.target;\n        if (!target.matches('.level')) {\n            return;\n        }\n\n        const targetLevel = target.closest('.level');\n        const allLevels = target.closest('.criterion').querySelectorAll('.level');\n        const currentIndex = Array.from(allLevels).indexOf(targetLevel);\n        const maxIndex = allLevels.length - 1;\n        let newIndex = currentIndex;\n        if (e.keyCode === 38) {\n            // Go to previous.\n            newIndex--;\n            e.preventDefault();\n        } else if (e.keyCode === 40) {\n            // Go to next.\n            newIndex++;\n            e.preventDefault();\n        }\n\n        if (newIndex < 0) {\n            newIndex = maxIndex;\n        } else if (newIndex > maxIndex) {\n            newIndex = 0;\n        }\n\n        levelClick(allLevels[newIndex]);\n    });\n};\n\nconst levelClick = (target) => {\n    const clickedLevel = target.closest('.level');\n    target.closest('.criterion').querySelectorAll('.level').forEach(level => {\n        const radio = level.querySelector('input[type=radio]');\n        if (level.isEqualNode(clickedLevel)) {\n            level.classList.add('checked');\n            level.setAttribute('aria-checked', 'true');\n            level.setAttribute('tabindex', 0);\n            radio.setAttribute('checked', 'true');\n            level.focus();\n        } else {\n            level.classList.remove('checked');\n            level.setAttribute('aria-checked', 'false');\n            level.setAttribute('tabindex', -1);\n            radio.removeAttribute(\"checked\");\n        }\n    });\n};\n"],"file":"rubric.min.js"}