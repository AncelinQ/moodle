define(["jquery","core_calendar/selectors","core_calendar/events","core/templates","core_calendar/view_manager"],function(a,b,c,d,e){var f=function(d){var f=a("body");f.on(c.monthChanged,function(a,b,c){d.queue(function(d){return g(a,b,c).then(function(){return d()})})});var g=function(c,f,g){var h=d.find('[data-current-time="'+f+'"]'),i=h.closest(b.calendarPeriods.month),j=d.find(b.calendarPeriods.month),k=a(j[0]),l=a(j[2]),m=a("<span>");m.attr("data-template","core_calendar/threemonth_month"),m.attr("data-includenavigation",!1);var n=a("<div>");n.hide(),n.append(m);var o,p;return i.is(k)?(n.insertBefore(k),o=k.data("previous"),p=l):i.is(l)&&(n.insertAfter(l),o=l.data("next"),p=k),e.refreshMonthContent(m,o,g,m).then(function(){var b=a.Deferred(),c=a.Deferred();return p.slideUp("fast",function(){a(this).remove(),b.resolve()}),n.slideDown("fast",function(){c.resolve()}),a.when(b,c)})}};return{init:function(b){b=a(b),f(b)}}});