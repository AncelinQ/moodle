YUI.add("moodle-form-changechecker",function(e,t){var n="core-formchangechecker",r=function(){r.superclass.constructor.apply(this,arguments)},i=e.namespace("M.form_changechecker");e.extend(r,e.Base,{initialvaluelisteners:[],initializer:function(){var t="form#"+this.get("formid"),n=e.one(t);if(!n)return;return n.delegate("change",e.M.form_changechecker.set_form_changed,"input",this),n.delegate("change",e.M.form_changechecker.set_form_changed,"textarea",this),n.delegate("change",e.M.form_changechecker.set_form_changed,"select",this),this.initialvaluelisteners.push(n.delegate("focus",this.store_initial_value,"input",this)),this.initialvaluelisteners.push(n.delegate("focus",this.store_initial_value,"textarea",this)),this.initialvaluelisteners.push(n.delegate("focus",this.store_initial_value,"select",this)),e.one(t).on("submit",e.M.form_changechecker.set_form_submitted,this),window.onbeforeunload=e.M.form_changechecker.report_form_dirty_state,this},store_initial_value:function(t){var n;if(t.target.hasClass("ignoredirty"))return this;if(e.M.form_changechecker.get_form_dirty_state()){while(this.initialvaluelisteners.length)n=this.initialvaluelisteners.shift(),n.detach();return this}e.M.form_changechecker.stateinformation.focused_element={element:t.target,initial_value:t.target.get("value")}}},{NAME:n,ATTRS:{formid:{value:""}}}),M.form_changechecker=M.form_changechecker||{},M.form_changechecker.instances=M.form_changechecker.instances||[],i.init=function(e){var t=new r(e);return M.form_changechecker.instances.push(t),t},i.stateinformation=[],i.set_form_changed=function(e){if(e&&e.target&&e.target.hasClass("ignoredirty"))return;i.stateinformation.formchanged=1,delete i.stateinformation.focused_element},i.set_form_submitted=function(){i.stateinformation.formsubmitted=1},i.get_form_dirty_state=function(){var e=i.stateinformation,t;if(e.formsubmitted)return 0;if(e.formchanged)return 1;if(e.focused_element&&e.focused_element.element.get("value")!==e.focused_element.initial_value)return 1;if(typeof tinyMCE!="undefined")for(t in tinyMCE.editors)if(tinyMCE.editors[t].isDirty())return 1;return 0},i.report_form_dirty_state=function(t){if(!i.get_form_dirty_state())return;var n=e.M.util.get_string("changesmadereallygoaway","moodle");return t&&(t.returnValue=n),n},M.core_formchangechecker=M.core_formchangechecker||{},M.core_formchangechecker.deprecated=function(){},M.core_formchangechecker.init=function(){M.core_formchangechecker.deprecated(),i.init.apply(this,arguments)},M.core_formchangechecker.set_form_changed=function(){M.core_formchangechecker.deprecated(),i.set_form_changed.apply(this,arguments)},e.mix(M.core_formchangechecker,i)},"@VERSION@",{requires:["base","event-focus"]});
