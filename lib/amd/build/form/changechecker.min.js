define ("core/form/changechecker",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.markFormSubmitted=a.markFormChangedFromNode=a.disableAllChecks=a.markAllFormsAsDirty=a.resetAllFormDirtyStates=a.unWatchForm=a.watchForm=void 0;var b=[],c=!1,d=function(a){a=a.closest("form");if(j(a)){return}b.push(a)};a.watchForm=d;var e=function(a){a=a.closest("form");b=b.filter(function(b){return!!b.contains(a)})};a.unWatchForm=e;var f=function(){b.map(function(a){a.dataset.formSubmitted=!1;a.dataset.formDirty=!1})};a.resetAllFormDirtyStates=f;var g=function(){b.map(function(a){a.dataset.formDirty=!0})};a.markAllFormsAsDirty=g;a.disableAllChecks=function disableAllChecks(){c=!0};var h=function(){if(c){return!1}var a=b.some(function(a){return!!a.dataset.formSubmitted});if(a){return!1}var d=b.some(function(a){if(a.dataset.formDirty){return!0}if(document.activeElement&&document.activeElement.dataset.propertyIsEnumerable("initialValue")){if(document.activeElement.dataset.initialValue!==document.activeElement.value){return!0}}});if(d){return!0}if("undefined"!=typeof window.tinyMCE){if(window.tinyMCE.editors.some(function(a){return a.isDirty()})){return!0}}return!1},i=function(a){return b.find(function(b){return b.contains(a)})},j=function(a){return b.some(function(b){return b.contains(a)})},k=function(a){return!!a.closest(".ignoredirty")},l=function(a){if(!j(a)){return}if(k(a)){return}var b=i(a);b.dataset.formDirty=!0};a.markFormChangedFromNode=l;var m=function(a){a=a.closest("form");a.dataset.formSubmitted=!0};a.markFormSubmitted=m;var n=function(a){var b=h()&&!M.cfg.behatsiterunning;if(b){a.preventDefault();a.returnValue=M.util.get_string("changesmadereallygoaway","moodle");return a.returnValue}window.removeEventListener("beforeunload",n)};(function startWatching(){document.addEventListener("change",function(a){if(!j(a.target)){return}l(a.target)});document.addEventListener("click",function(a){var b=a.target.closest("[data-formchangechecker-ignore-submit]");if(!b){return}var c=a.target.closest("form");if(c){c.dataset.ignoreSubmission=!0}});document.addEventListener("focusin",function(a){if(a.target.matches("input, textarea, select")){if(a.target.dataset.propertyIsEnumerable("initialValue")){return}a.target.dataset.initialValue=a.target.value}});document.addEventListener("submit",function(a){var b=a.closest("form");if(!b){return}if(b.dataset.ignoreSubmission){b.dataset.ignoreSubmission=!1;return}m(b)});window.addEventListener("beforeunload",n)})()});
//# sourceMappingURL=changechecker.min.js.map
