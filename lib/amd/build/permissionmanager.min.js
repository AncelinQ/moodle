define("core/permissionmanager",["jquery","core/config","core/notification","core/templates","core/yui"],function(a,b,c,d,f){var e={ADDROLE:"a.allowlink, a.prohibitlink",REMOVEROLE:"a.preventlink, a.unprohibitlink",UNPROHIBIT:"a.unprohibitlink"},g=a.Event("rolesloaded"),h,j,i,k,l=null,m=function e(){var d={contextid:h,getroles:1,sesskey:b.sesskey};a.post(i+"roles/ajax.php",d,null,"json").done(function(b){try{k=b;m=function b(){a("body").trigger(g)};m()}catch(a){c.exception(a)}}).fail(function(a,b,d){c.exception(d)})},n=function(b,e,f){var g={contextid:h,roleid:e,sesskey:M.cfg.sesskey,action:f,capability:b.data("name")};a.post(i+"roles/ajax.php",g,null,"json").done(function(f){var g=f;try{var h={rolename:k[e],roleid:e,adminurl:i,imageurl:M.util.image_url("t/delete","moodle")};switch(g){case"allow":h.spanclass="allowed";h.linkclass="preventlink";h.action="prevent";h.icon="t/delete";break;case"prohibit":h.spanclass="forbidden";h.linkclass="unprohibitlink";h.action="unprohibit";h.icon="t/delete";break;case"prevent":b.find("a[data-role-id=\""+e+"\"]").first().closest(".allowed").remove();return;case"unprohibit":b.find("a[data-role-id=\""+e+"\"]").first().closest(".forbidden").remove();return;default:return;}d.render("core/permissionmanager_role",h).done(function(c){if("allow"==g){a(c).insertBefore(b.find(".allowmore:first"))}else if("prohibit"==g){a(c).insertBefore(b.find(".prohibitmore:first"));var d=b.find(".allowedroles").first().find("a[data-role-id=\""+e+"\"]");if(d){d.first().closest(".allowed").remove()}}l.hide()}).fail(c.exception)}catch(a){c.exception(a)}}).fail(function(a,b,d){c.exception(d)})},o=function(b){b.preventDefault();f.use("moodle-core-notification-dialogue",function(){a("body").one("rolesloaded",function(){var f=a(b.currentTarget),g=f.data("action"),h=f.closest("tr.rolecap"),m={cap:h.data("humanname"),context:j},o=M.util.get_string("role"+g+"info","core_role",m);if(null===l){l=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,width:"450px"})}l.set("headerContent",M.util.get_string("role"+g+"header","core_role"));var p,q,r=[];switch(g){case"allow":q=h.find(e.REMOVEROLE);break;case"prohibit":q=h.find(e.UNPROHIBIT);break;}for(p in k){var s="",t=q.filter("[data-role-id='"+p+"']").length;if(t){s="disabled"}var u={roleid:p,rolename:k[p],disabled:s};r.push(u)}d.render("core/permissionmanager_panelcontent",{message:o,roles:r}).done(function(b){l.set("bodyContent",b);l.show();a("div.role_buttons").delegate("input","click",function(b){var c=a(b.currentTarget).data("role-id");n(h,c,g)})}).fail(c.exception)})});m()},p=function(b){b.preventDefault();a("body").one("rolesloaded",function(){var d=a(b.currentTarget),e=d.data("action"),f=d.data("role-id"),g=d.closest("tr.rolecap"),h={role:k[f],cap:g.data("humanname"),context:j};c.confirm(M.util.get_string("confirmunassigntitle","core_role"),M.util.get_string("confirmrole"+e,"core_role",h),M.util.get_string("confirmunassignyes","core_role"),M.util.get_string("confirmunassignno","core_role"),function(){n(g,f,e)})});m()};return{initialize:function d(b){h=b.contextid;j=b.contextname;i=b.adminurl;var c=a("body");c.delegate(e.ADDROLE,"click",o);c.delegate(e.REMOVEROLE,"click",p)}}});
//# sourceMappingURL=permissionmanager.min.js.map
