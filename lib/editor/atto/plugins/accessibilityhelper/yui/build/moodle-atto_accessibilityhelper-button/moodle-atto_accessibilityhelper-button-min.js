YUI.add("moodle-atto_accessibilityhelper-button",function(e,t){var n="atto_accessibilityhelper",r='<div><p id="{{CSS.STYLESLABEL}}">{{get_string "liststyles" component}}<br/><span id="{{CSS.LISTSTYLES}}" aria-labelledby="{{CSS.STYLESLABEL}}" /></p></div><span class="listStyles"></span><p id="{{CSS.LINKSLABEL}}">{{get_string "listlinks" component}}<br/><span id="{{CSS.LISTLINKS}}" aria-labelledby="{{CSS.LINKSLABEL}}"/></p><span class="listLinks"></span><p id="{{CSS.IMAGESLABEL}}">{{get_string "listimages" component}}<br/><span id="{{CSS.LISTIMAGES}}" aria-labelledby="{{CSS.IMAGESLABEL}}"/></p><span class="listImages"></span>',i={STYLESLABEL:"atto_accessibilityhelper_styleslabel",LISTSTYLES:"atto_accessibilityhelper_liststyles",LINKSLABEL:"atto_accessibilityhelper_linkslabel",LISTLINKS:"atto_accessibilityhelper_listlinks",IMAGESLABEL:"atto_accessibilityhelper_imageslabel",LISTIMAGES:"atto_accessibilityhelper_listimages"};e.namespace("M.atto_accessibilityhelper").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_displayedWarnings:{},initializer:function(){this.addButton({icon:"e/visual_aid",callback:this.displayDialogue})},displayDialogue:function(){var e=this.getDialogue({headerContent:M.util.get_string("pluginname",n),width:"800px",focusAfterHide:!0});e.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=e.Handlebars.compile(r),s=e.Node.create(t({CSS:i,component:n}));return s.one(".listStyles").empty().appendChild(this.listStyles()),s.one(".listLinks").empty().appendChild(this.listLinks()),s.one(".listImages").empty().appendChild(this.listImages()),s.delegate("click",function(e){e.preventDefault();var t=this.get("host"),n=e.target.getAttribute("data-index"),r=this._displayedWarnings[n],i=this.getDialogue();r&&(i.set("focusAfterHide",null),t.setSelection(t.getSelectionFromNode(r))),i.hide()},this),s},listStyles:function(){var t=[],n=this.get("host"),r=n.getSelectionParentNode(),i;r&&(r=e.one(r));while(r&&r!==this.editor)i=r.get("tagName"),typeof i!="undefined"&&t.push(e.Escape.html(i)),r=r.ancestor();return t.length===0&&t.push(M.util.get_string("nostyles","atto_accessibilityhelper")),t.reverse(),t.join(", ")},listLinks:function(){var t=e.Node.create("<ol />"),n,r;return this.editor.all("a").each(function(i){r=e.Node.create('<a href="#" title="'+M.util.get_string("selectlink","atto_accessibilityhelper")+'">'+e.Escape.html(i.get("text"))+"</a>"),r.setData("sourcelink",i),r.on("click",this._linkSelected,this),n=e.Node.create("<li></li>"),n.appendChild(r),t.appendChild(n)},this),t.hasChildNodes()||t.append("<li>"+M.util.get_string("nolinks","atto_accessibilityhelper")+"</li>"),t},listImages:function(){var t=e.Node.create("<ol/>"),n,r;return this.editor.all("img").each(function(i){var s=i.getAttribute("alt");s===""&&(s=i.getAttribute("title"),s===""&&(s=i.getAttribute("src"))),r=e.Node.create('<a href="#" title="'+M.util.get_string("selectimage","atto_accessibilityhelper")+'">'+e.Escape.html(s)+"</a>"),r.setData("sourceimage",i),r.on("click",this._imageSelected,this),n=e.Node.create("<li></li>"),n.append(r),t.append(n)},this),t.hasChildNodes()||t.append("<li>"+M.util.get_string("noimages","atto_accessibilityhelper")+"</li>"),t},_imageSelected:function(e){e.preventDefault(),this.getDialogue({focusAfterNode:null}).hide();var t=this.get("host"),n=e.target.getData("sourceimage");this.editor.focus(),t.setSelection(t.getSelectionFromNode(n))},_linkSelected:function(e){e.preventDefault(),this.getDialogue({focusAfterNode:null}).hide();var t=this.get("host"),n=e.target.getData("sourcelink");this.editor.focus(),t.setSelection(t.getSelectionFromNode(n))}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
