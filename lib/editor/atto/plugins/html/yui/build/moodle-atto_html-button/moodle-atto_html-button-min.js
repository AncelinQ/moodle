YUI.add("moodle-atto_html-button",function(e,t){e.namespace("M.atto_html").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_codeMirror:null,initializer:function(){this.addButton({icon:"e/source_code",callback:this._toggleHTML,title:"buttonname"})},_toggleHTML:function(){this.set("isHTML",!this.get("isHTML"));var t=this.get("host");if(!this.get("isHTML"))t.enablePlugins(),t.updateFromTextArea(),this._codeMirror&&(e.one(this._codeMirror.getWrapperElement()).hide(),this._codeMirror.toTextArea(),delete this._codeMirror,this._codeMirror=null),t.textarea.hide(),this.editor.show(),t.focus(),this.markUpdated();else{t.disablePlugins(),t.enablePlugins(this.name),t.updateOriginal();var n={width:this.editor.getComputedStyle("width"),height:this.editor.getComputedStyle("height")},r=new e.Promise(function(e){e()});r.then(function(){var n=e.M.atto_html.beautify.html_beautify(t.textarea.get("value"),{indent_size:4,indent_inner_html:!0});return t.textarea.set("value",n)}).then(function(){var n=e.M.atto_html.CodeMirror.fromTextArea(t.textarea.getDOMNode(),{lineNumbers:!0,mode:"htmlmixed",tabSize:2,lineWrapping:!0});return n.on("change",function(e){e.save()}),n}).then(function(e){return this.editor.hide(),e.setSize(n.width,n.height),t.textarea.focus(),e}.bind(this)).then(function(e){this._codeMirror=e}.bind(this)).catch(function(){return})}}},{ATTRS:{isHTML:{value:!1}}})},"@VERSION@",{requires:["promise","moodle-editor_atto-plugin","moodle-atto_html-beautify","moodle-atto_html-codemirror","event-valuechange"]});
