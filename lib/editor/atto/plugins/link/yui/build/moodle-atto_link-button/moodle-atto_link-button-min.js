YUI.add("moodle-atto_link-button",function(e,t){var n="atto_link",r="atto_link_openinnewwindow",i="#"+r,s='<form class="atto_form"><label for="atto_link_urlentry">{{get_string "enterurl" component}}</label><input class="fullwidth" type="url" id="atto_link_urlentry" size="32"/><br/>{{#if showFilepicker}}<button id="openlinkbrowser">{{get_string "browserepositories" component}}</button><br/>{{/if}}<input type="checkbox" id="{{CSS_NEWWINDOW}}"/><label class="sameline" for="{{CSS_NEWWINDOW}}">{{get_string "openinnewwindow" component}}</label><br/><div class="mdl-align"><br/><button type="submit" id="atto_link_urlentrysubmit">{{get_string "createlink" component}}</button></div></form>',o="openlinkbrowser";e.namespace("M.atto_link").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){this.addButton({icon:"e/insert_edit_link",callback:this.chooseLink,tags:"a"})},chooseLink:function(){this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1||this._currentSelection.collapsed)return;var e=this.getDialogue({headerContent:M.util.get_string("createlink",n),focusAfterHide:!0});e.set("bodyContent",this._getDialogueContent()),this.resolveAnchors(),e.show()},resolveAnchors:function(){var t=this.get("host").getSelectionParentNode(),n,r,s,o;if(!t)return;n=this.findSelectedAnchors(e.one(t)),n.length>0&&(r=n[0],this._currentSelection=this.get("host").getSelectionFromNode(r),s=r.getAttribute("href"),o=r.getAttribute("target"),s!==""&&e.one("#atto_link_urlentry").setAttribute("value",s),o==="_blank"?e.one(i).setAttribute("checked","checked"):e.one(i).removeAttribute("checked"))},_filepickerCallback:function(e){this.getDialogue().set("focusAfterHide",null).hide(),e.url!==""&&(this.get("host").setSelection(this._currentSelection),document.execCommand("unlink",!1,null),document.execCommand("createLink",!1,e.url))},setLink:function(t){var n,r,i,s,o,u=t.currentTarget.ancestor(".atto_form"),a=this.get("host");t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),n=u.one("input[type=url]"),o=n.get("value");if(o!==""){a.setSelection(this._currentSelection),document.execCommand("unlink",!1,null),document.execCommand("createLink",!1,o),i=a.getSelectionParentNode();if(!i)return;s=this.findSelectedAnchors(e.one(i)),e.Array.each(s,function(e){r=u.one("input[type=checkbox]"),r.get("checked")?e.setAttribute("target","_blank"):e.removeAttribute("target")}),this.markUpdated()}},findSelectedAnchors:function(e){var t=e.get("tagName"),n,r;return t&&t.toLowerCase()==="a"?[e]:(r=[],e.all("a").each(function(e){!n&&this.get("host").selectionContainsNode(e)&&r.push(e)}),r.length>0?r:(n=e.ancestor("a"),n?[n]:[]))},_getDialogueContent:function(){var t=this.get("host").canShowFilepicker("link"),i=e.Handlebars.compile(s),u=e.Node.create(i({showFilepicker:t,component:n,CSS_NEWWINDOW:r}));return u.one("#atto_link_urlentrysubmit").on("click",this.setLink,this),t&&u.one("#"+o).on("click",function(e){e.preventDefault(),this.get("host").showFilepicker("link",this._filepickerCallback,this)},this),u}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
