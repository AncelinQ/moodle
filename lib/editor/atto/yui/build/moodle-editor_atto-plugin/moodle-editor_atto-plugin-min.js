YUI.add("moodle-editor_atto-plugin",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}function f(){}var r=".atto_group.",i="_group",s="disabled",o="highlight",u="moodle-editor_atto-editor-plugin",a=".editor_atto_content";e.extend(n,e.Base,{buttons:null,_buttonHandlers:null,name:null,toolbar:null,editor:null,initializer:function(e){this.name=e.name,this.toolbar=e.toolbar,this.editor=e.editor,this.buttons={},this._buttonHandlers=[]},addButton:function(t){var n=this.get("group"),r=this.name,i="atto_"+r+"_button",s,o=this.get("host");t.exec&&(i=i+"_"+t.exec),t.buttonName?i=i+"_"+t.buttonName:t.buttonName=r,t.iconurl||(t.iconComponent||(t.iconComponent="core"),t.iconurl=M.util.image_url(t.icon,t.iconComponent)),t.title||(t.title="pluginname");var u=M.util.get_string(t.title,"atto_"+r);s=e.Node.create('<button class="'+i+'"'+'tabindex="-1">'+'<img class="icon" aria-hidden="true" role="presentation" width="16" height="16" src="'+t.iconurl+'"/>'+"</button>"),s.setAttribute("title",u),n.append(s);var a=this.toolbar.getAttribute("aria-activedescendant");a||(s.setAttribute("tabindex","0"),this.toolbar.setAttribute("aria-activedescendant",s.generateID())),typeof t.wrapCallback=="undefined"&&(t.wrapCallback=!0);var f;return t.wrapCallback?f=e.rbind(this._callbackWrapper,this,t.callback,t.callbackArgs):f=t.callback,this._buttonHandlers.push(this.toolbar.delegate("click",f,"."+i,this)),t.keys&&this.addKeyboardListener(f,t.keys,i),t.tags&&this._buttonHandlers.push(o.on("atto:selectionchanged",function(e){o.selectionFilterMatches(t.tags,e.selectedNodes)?this.highlightButton(t.buttonName):this.unHighlightButton(t.buttonName)},this)),this.buttons[t.buttonName]=s,s},addBasicButton:function(e){return e.exec?(e.icon||(e.icon="e/"+e.exec),e.callback=function(){document.execCommand(e.exec,!1,null),this.fire(e.exec+":complete")},this.addButton(e)):null},_callbackWrapper:function(e,t,n){e.preventDefault(),this.get("host").isActive()&&this.get("host").focus();var r=[e,n];t.apply(this,r),this.markUpdated()},addKeyboardListener:function(t,n,r){var i="key",s=a,o;if(e.Lang.isArray(n))return e.Array.each(n,function(e){this.addKeyboardListener(t,e)},this),this;typeof n=="object"?(n.eventtype&&(i=n.eventtype),n.container&&(s=n.container),o=n.keyCodes):o=this.getKeyEvent()+n+this.getDefaultMetaKey(),this._buttonHandlers.push(this.editor.delegate(i,t,o,s,this))},isEnabled:function(){var t=e.Object.some(this.buttons,function(){return!this.hasAttribute(s)||this.getAttribute(s)!=="true"});return t},disableButtons:function(){return this._setButtonState(!1,button)},enableButtons:function(e){return this._setButtonState(!0,e)},_setButtonState:function(t,n){var r="addAttribute";return t&&(r="removeAttribute"),n?this.buttons[n]&&this.buttons[n][r](s):e.Object.each(this.buttons,function(){this[r](s)}),this},highlightButton:function(e){this._changeButtonHighlight(!0,e)},unHighlightButton:function(e){this._changeButtonHighlight(!1,e)},_changeButtonHighlight:function(t,n){var r="addClass";t||(r="removeClass"),n?this.buttons[n]&&this.buttons[n][r](o):e.Object.each(this.buttons,function(){this[r](o)})},getDefaultMetaKey:function(){return e.UA.os==="macintosh"?"+meta":"+ctrl"},getKeyEvent:function(){return"down:"},markUpdated:function(){return this.get("host").updateOriginal()}},{NAME:"editorPlugin",ATTRS:{host:{writeOnce:!0},group:{writeOnce:!0,getter:function(t){var n=this.toolbar.one(r+t+i);return n||(n=e.Node.create('<div class="atto_group '+t+i+'"></div>'),this.toolbar.append(n)),n}}}}),e.namespace("M.editor_atto").EditorPlugin=n,f.ATTRS={},f.prototype={_dialogue:null,getDialogue:function(t){if(!this._dialogue){var n=e.merge({visible:!1,modal:!0,close:!0,draggable:!0},t);this._dialogue=new M.core.dialogue(n)}return this._dialogue}},e.Base.mix(e.M.editor_atto.EditorPlugin,[f])},"@VERSION@",{requires:["node","base","escape","event","moodle-core-handlebars"]});
