YUI.add("moodle-editor_atto-pluginmenu",function(e,t){function n(){}n.ATTRS={},n.prototype={add_toolbar_menu:function(t,n,r,i,s,o,u){var a=this.get_toolbar_node(t),f=a.one(".atto_group."+i+"_group"),l,c,h;typeof o=="undefined"&&(o="14"),typeof u=="undefined"&&(u="transparent"),f||(f=e.Node.create('<div class="atto_group '+i+'_group"></div>'),a.append(f)),h=M.util.image_url("t/expanded","moodle"),c=e.Node.create('<button class="atto_'+n+'_button atto_hasmenu" '+'data-editor="'+e.Escape.html(t)+'" '+'tabindex="-1" '+'type="button" '+'data-menu="'+n+"_"+t+'" '+'title="'+e.Escape.html(M.util.get_string("pluginname","atto_"+n))+'">'+'<img class="icon" aria-hidden="true" role="presentation" width="16" height="16" '+'style="background-color:'+u+';" src="'+r+'"/>'+'<img class="icon" aria-hidden="true" role="presentation" width="16" height="16" src="'+h+'"/>'+"</button>"),f.append(c),l=a.getAttribute("aria-activedescendant"),l||(c.setAttribute("tabindex","0"),a.setAttribute("aria-activedescendant",c.generateID())),this.widgets[n]=n;var p=e.Node.create('<div class="atto_'+n+"_menu"+' atto_menu" data-editor="'+e.Escape.html(t)+'"'+' style="min-width:'+(o-2)+'em"'+'"></div>'),d=0,v={};for(d=0;d<s.length;d++)v=s[d],p.append(e.Node.create('<div class="atto_menuentry"><a href="#" class="atto_'+n+"_action_"+d+'" '+'data-editor="'+e.Escape.html(t)+'" '+'data-plugin="'+e.Escape.html(n)+'" '+'data-handler="'+e.Escape.html(n+"_action_"+d)+'">'+v.text+"</a>"+"</div>")),this.buttonhandlers[n+"_action_"+d]||(e.one("body").delegate("click",this.buttonclicked_handler,".atto_"+n+"_action_"+d),e.one("body").delegate("key",this.buttonclicked_handler,"space,enter",".atto_"+n+"_action_"+d),this.buttonhandlers[n+"_action_"+d]=v.handler);this.buttonhandlers[n]||(e.one("body").delegate("click",this.showhide_menu_handler,".atto_"+n+"_button"),this.buttonhandlers[n]=!0);var m=new M.core.dialogue({bodyContent:p,visible:!1,width:o+"em",lightbox:!1,closeButton:!1,center:!1});this.menus[n+"_"+t]=m,m.align(c,[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),m.hide(),m.headerNode.hide(),m.render()},_addSubButtons:function(t,n){if(!n.entries||n.entries.length===0)return;var r=this.get("host"),i=n.entries||[],s=0,o,u;for(s=0;s<i.length;s++)o=i[s],u=".atto_"+name+"_action_"+s,menu.append(e.Node.create('<div class="atto_menuentry"><a href="#" class="'+u+'" '+o.text+"</a>"+"</div>")),this._buttonHandlers.push(this.toolbar.delegate("click",r.buttonclicked_handler,u),this.toolbar.delegate("key",r.buttonclicked_handler,"space,enter",u));this._buttonHandlers.push(this.toolbar.delegate("click",r.showhide_menu_handler,"."+buttonClass,this));var a=new M.core.dialogue({bodyContent:menu,visible:!1,width:overlaywidth+"em",lightbox:!1,closeButton:!1,center:!1});M.editor_atto.menus[plugin+"_"+elementid]=a,a.align(t,[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),a.hide(),a.headerNode.hide(),a.render()},showhide_menu_handler:function(t){t.preventDefault();var n=this.getAttribute("disabled"),r=this.getAttribute("data-menu"),i=this.menus[r],s=i.get("bodyContent");if(i.get("visible")||n)i.hide(),s.detach("clickoutside");else{s.on("clickoutside",function(e){e.target.ancestor()!==this&&e.target!==this&&i.get("visible")&&(s.detach("clickoutside"),i.hide())},this),i.align(e.one(e.config.doc.body),[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),i.show();var o=t.target.ancestor("button",!0).one("img");i.align(o,[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),i.get("boundingBox").one("a").focus()}},buttonclicked_handler:function(t){var n=this.getAttribute("data-editor"),r=this.getAttribute("data-plugin"),i=this.getAttribute("data-handler"),s=this.menus[r+"_"+n],o=this.get_toolbar_node(n),u=o.getAttribute("aria-activedescendant");u&&(current=e.one("#"+u),current.setAttribute("tabindex","-1")),this.setAttribute("tabindex",0),o.setAttribute("aria-activedescendant",this.generateID()),s&&s.hide();if(this.isEnabled(n,r))return i=this.buttonhandlers[i],i(t,n)}},e.namespace("M.editor_atto").EditorPluginMenu=n},"@VERSION@",{requires:["base-build"]});
