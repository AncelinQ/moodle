{"version":3,"sources":["../src/aria.js"],"names":["define","$","init","focusEnd","setFocusEnd","getFocusEnd","result","keydown","e","trigger","which","keyCode","expanded","target","attr","preventDefault","click","on","menu","find","menuItems","foundMenuItem","length","focus","keypress","String","fromCharCode","closest","i","item","itemText","toLowerCase","text","trim","indexOf","filter","currentIndex","index","sortedMenuItems","toArray","searchList","merge","slice","reverse","window","addEventListener","alerts","document","querySelectorAll","Array","prototype","forEach","call","autofocusElement","innerHTML","removeAttribute"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Enhancements to Bootstrap components for accessibility.\n *\n * @module     theme_boost/aria\n * @copyright  2018 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/pending'], function($) {\n    return {\n        init: function() {\n            // Drop downs from bootstrap don't support keyboard accessibility by default.\n            var focusEnd = false,\n                setFocusEnd = function() {\n                    focusEnd = true;\n                },\n                getFocusEnd = function() {\n                    var result = focusEnd;\n                    focusEnd = false;\n                    return result;\n                };\n\n            // Special handling for \"up\" keyboard control.\n            $('[data-toggle=\"dropdown\"]').keydown(function(e) {\n                var trigger = e.which || e.keyCode,\n                    expanded;\n\n                // Up key opens the menu at the end.\n                if (trigger == 38) {\n                    // Focus the end of the menu, not the beginning.\n                    setFocusEnd();\n                }\n\n                // Escape key only closes the menu, it doesn't open it.\n                if (trigger == 27) {\n                    expanded = $(e.target).attr('aria-expanded');\n                    e.preventDefault();\n                    if (expanded == \"false\") {\n                        $(e.target).click();\n                    }\n                }\n\n                // Space key or Enter key opens the menu.\n                if (trigger == 32 || trigger == 13) {\n                    // Cancel random scroll.\n                    e.preventDefault();\n                    // Open the menu instead.\n                    $(e.target).click();\n                }\n            });\n\n            $('.dropdown').on('shown.bs.dropdown', function(e) {\n                // We need to focus on the first menuitem.\n                var menu = $(e.target).find('[role=\"menu\"]'),\n                    menuItems = false,\n                    foundMenuItem = false;\n\n                if (menu) {\n                    menuItems = $(menu).find('[role=\"menuitem\"]');\n                }\n                if (menuItems && menuItems.length > 0) {\n                    if (getFocusEnd()) {\n                        foundMenuItem = menuItems[menuItems.length - 1];\n                    } else {\n                        // The first menu entry, pretty reasonable.\n                        foundMenuItem = menuItems[0];\n                    }\n                }\n                if (foundMenuItem) {\n                    foundMenuItem.focus();\n                }\n            });\n            // Search for menu items by finding the first item that has\n            // text starting with the typed character (case insensitive).\n            $('.dropdown [role=\"menu\"] [role=\"menuitem\"]').keypress(function(e) {\n                var trigger = String.fromCharCode(e.which || e.keyCode),\n                    menu = $(e.target).closest('[role=\"menu\"]'),\n                    i = 0,\n                    menuItems = false,\n                    item,\n                    itemText;\n\n                if (!menu) {\n                    return;\n                }\n                menuItems = $(menu).find('[role=\"menuitem\"]');\n                if (!menuItems) {\n                    return;\n                }\n\n                trigger = trigger.toLowerCase();\n                for (i = 0; i < menuItems.length; i++) {\n                    item = $(menuItems[i]);\n                    itemText = item.text().trim().toLowerCase();\n                    if (itemText.indexOf(trigger) == 0) {\n                        item.focus();\n                        break;\n                    }\n                }\n            });\n\n            // Keyboard navigation for arrow keys, home and end keys.\n            $('.dropdown [role=\"menu\"] [role=\"menuitem\"]').keydown(function(e) {\n                var trigger = e.which || e.keyCode,\n                    menu = $(e.target).closest('[role=\"menu\"]'),\n                    menuItems = false;\n                if (!menu) {\n                    return;\n                }\n                menuItems = $(menu).find('[role=\"menuitem\"]').filter(':visible');\n                if (!menuItems) {\n                    return;\n                }\n\n                var currentIndex = menuItems.index(e.target);\n                var sortedMenuItems = menuItems.toArray();\n                var searchList = $.merge(sortedMenuItems.slice(currentIndex + 1), sortedMenuItems.slice(0, currentIndex));\n\n                // Down key.\n                if (trigger == 40) {\n                    if (searchList.length > 1) {\n                        e.preventDefault();\n                        searchList[0].focus();\n                    }\n                } else if (trigger == 38) {\n                    // Up key.\n                    searchList = searchList.reverse();\n                    if (searchList.length > 1) {\n                        e.preventDefault();\n                        searchList[0].focus();\n                    }\n\n                } else if (trigger == 36) {\n                    // Home key.\n                    e.preventDefault();\n                    menuItems[0].focus();\n\n                } else if (trigger == 35) {\n                    // End key.\n                    e.preventDefault();\n                    menuItems[menuItems.length - 1].focus();\n                }\n                return;\n            });\n            $('.dropdown').on('hidden.bs.dropdown', function(e) {\n                // We need to focus on the menu trigger.\n                var trigger = $(e.target).find('[data-toggle=\"dropdown\"]');\n                if (trigger) {\n                    trigger.focus();\n                }\n            });\n\n            // After page load, focus on any element with special autofocus attribute.\n            window.addEventListener(\"load\", () => {\n                const alerts = document.querySelectorAll('[data-aria-autofocus=\"true\"][role=\"alert\"]');\n                Array.prototype.forEach.call(alerts, autofocusElement => {\n                    // According to the specification an role=\"alert\" region is only read out on change to the content\n                    // of that region.\n                    autofocusElement.innerHTML += ' ';\n                    autofocusElement.removeAttribute('data-aria-autofocus');\n                });\n            });\n        }\n    };\n});\n"],"file":"aria.min.js"}