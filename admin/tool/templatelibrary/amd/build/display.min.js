define(["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str"],function(a,b,c,d,e,f,g){var h=function(b,c,f){g.get_string("templateselected","tool_templatelibrary",b).done(function(b){a('[data-region="displaytemplateheader"]').text(b)}).fail(d.exception);var h,j,k=i(b,f);k.example&&(j=k.example),f===c?h=k:(h=i(b,c),j=h.example),a('[data-region="displaytemplatedocs"]').text(h.documentation),a('[data-region="displaytemplatesource"]').text(k.source),j?e.render(b,j).done(function(b,c){a('[data-region="displaytemplateexample"]').empty(),a('[data-region="displaytemplateexample"]').append(b),e.runTemplateJS(c)}).fail(d.exception):g.get_string("templatehasnoexample","tool_templatelibrary").done(function(b){a('[data-region="displaytemplateexample"]').text(b)}).fail(d.exception)},i=function(b,d){var e="@template "+b,f=d.match(/{{!([\s\S]*?)}}/g),g=0,h={documentation:"",example:null,source:""};if(null===f)h.source=d;else{var i,j;for(g=0;g<f.length;g++)if(i=f[g],j=i.indexOf(e),-1!==j){var k=j+e.length+1;i=i.substr(k,i.length-2-k),h.documentation=i;break}}if(h.documentation){var l=h.documentation.match(/Example context \(json\):([\s\S]*)/);if(l){var m=l[1].trim();try{h.example=a.parseJSON(m)}catch(n){c.debug("Could not parse json example context for template."),c.debug(n)}}}return h},j=function(a){var c=a.split("/"),e=c.shift(),g=c.shift();b.call([{methodname:"core_output_load_template",args:{component:e,template:g,themename:"clean"},done:function(c){b.call([{methodname:"core_output_load_template",args:{component:e,template:g,themename:f.theme},done:function(b){h(a,c,b)},fail:d.exception}])},fail:d.exception}])};return a('[data-region="list-templates"]').on("click","[data-templatename]",function(){var b=a(this).data("templatename");j(b)}),{}});