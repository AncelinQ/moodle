define(["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues","core/pending"],function(a,b,c,d,e,f,g,h){var i=function(b,c,d,e,g,i,j){f.prototype.constructor.apply(this,[]);var k=a(b);if(!k.length)throw new Error("Could not find the trigger");var l=new h("tool_lp/grade_user_competency_inline:setup");this._scaleId=c,this._competencyId=d,this._userId=e,this._planId=g,this._courseId=i,this._chooseStr=j,this._setUp(),k.click(function(a){a.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId}),l.resolve()};return i.prototype=Object.create(f.prototype),i.prototype._setUp=function(){var a=[],d=this,f=new h("tool_lp/grade_user_competency_inline:_setUp"),i=g.get_values(d._scaleId);i.then(function(b){a.push({value:"",name:d._chooseStr});for(var c=0;c<b.length;c++){var e=b[c];a.push({value:e.id,name:e.name})}return a}).then(function(a){return new e(a)}).then(function(a){return a.on("rated",function(a,e){var f=d._args;f.grade=e.rating,f.note=e.note,c.call([{methodname:d._methodName,args:f,done:function(a){d._trigger("competencyupdated",{args:f,evidence:a})},fail:b.exception}])}),a}).then(function(a){d._dialogue=a}).then(f.resolve).fail(b.exception)},i.prototype._scaleId=null,i.prototype._competencyId=null,i.prototype._userId=null,i.prototype._planId=null,i.prototype._courseId=null,i.prototype._chooseStr=null,i.prototype._dialogue=null,i});