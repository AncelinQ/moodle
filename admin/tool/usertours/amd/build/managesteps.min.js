define(["jquery","core/ajax","core/str","core/yui","core/templates","core/notification"],function(a,b,c,d,e,f){d.use("moodle-core-notification-dialogue");var g={dialogue:null,getDialogue:function(){return null===g.dialogue&&(g.dialogue=new M.core.dialogue({modal:!0,visible:!1})),g.dialogue},getDialogueNode:function(){var b=g.getDialogue();return a(b.get("boundingBox").getDOMNode())},startAddStepDialogue:function(){b.call([{methodname:"tool_usertours_get_targettypes",args:{},done:g.displayTargetTypeList,fail:f.exception}])},displayTargetTypeList:function(a){e.render("tool_usertours/selecttarget",{targetTypes:a}).done(g.updateDialogueContent).fail(f.exception)},handleSubmissionResponse:function(a){a.template&&a.context&&e.render(a.template,a.context).done(g.updateDialogueContent).fail(f.exception),a.closeDialogue&&g.getDialogue().hide(),a.redirectTo&&(window.location.href=a.redirectTo)},updateDialogueContent:function(a){var b=g.getDialogue();c.get_string("selecttype","tool_usertours").then(function(c){b.set("headerContent",c).set("bodyContent",a),g.getDialogueNode().find("form").submit(g.handleSubmission),b.show()})},handleSubmission:function(c){c.preventDefault();var d=a(c.target),e={};d.serializeArray().map(function(a){return e[a.name]=a.value,!0}),e.tourid=g.tourid,b.call([{methodname:"tool_usertours_set_target",args:e,done:g.handleSubmissionResponse,fail:f.exception}])},removeStep:function(b){b.preventDefault(),c.get_strings([{key:"confirmstepremovaltitle",component:"tool_usertours"},{key:"confirmstepremovalquestion",component:"tool_usertours"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(c){f.confirm(c[0],c[1],c[2],c[3],a.proxy(function(){window.location=a(this).attr("href")},b.currentTarget))})},setup:function(b){g.tourid=b,a(".createstep").click(function(a){a.preventDefault(),g.startAddStepDialogue()}),a("body").delegate('[data-action="delete"]',"click",g.removeStep)}};return{setup:function(a){g.setup(a)}}});