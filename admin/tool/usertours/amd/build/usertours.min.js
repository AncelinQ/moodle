define ("tool_usertours/usertours",["exports","core/ajax","tool_usertours/tour","core/templates","core/log","core/notification"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.resetTourState=a.init=void 0;b=g(b);c=g(c);d=g(d);e=g(e);f=g(f);var s="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){return r(a)||j(a,b)||m(a,b)||l()}function j(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function k(a){return r(a)||q(a)||m(a)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(a,b){if(!a)return;if("string"==typeof a)return p(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return p(a,b)}function p(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function q(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function r(a){if(Array.isArray(a))return a}var t=null,u=null;a.init=function init(a,b){var c=b.map(function(a){return"function"==typeof s.define&&s.define.amd?new Promise(function(b,c){s.require(["tool_usertours/filter_".concat(a)],b,c)}):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&s.require&&"component"===s.require.loader?Promise.resolve(require(("tool_usertours/filter_".concat(a)))):Promise.resolve(s["tool_usertours/filter_".concat(a)])});return Promise.all(c).then(function(b){var c=k(b),d=c.slice(0);return a.find(function(a){return d.find(function(b){return b.filterMatches(a)})},a)}).then(function(a){return v(a)})};var v=function(a){if(!a){return}t=a.tourId;var b=a.startTour;if("undefined"==typeof b){b=!0}if(b){w(t)}x();document.addEventListener("click",function(a){if(a.target.closest("[data-action=\"tool_usertours/resetpagetour\"]")){a.preventDefault();D(t)}})},w=function(a){M.util.js_pending("admin_usertour_fetchTour"+a);return Promise.all([b.default.call([{methodname:"tool_usertours_fetch_and_start_tour",args:{tourid:a,context:M.cfg.contextid,pageurl:window.location.href}}])[0],d.default.renderForPromise("tool_usertours/tourstep",{})]).then(function(b){var c=h(b,2),d=c[0],e=c[1].html;if(d&&d.tourconfig){A(a,e,d.tourconfig)}}).then(M.util.js_complete("admin_usertour_fetchTour"+a)).catch(f.default.exception)},x=function(){M.util.js_pending("admin_usertour_addResetLink");return d.default.renderForPromise("tool_usertours/resettour",{}).then(function(a){var b=a.html,c=a.js;return d.default.appendNodeContents(y(),b,c)}).then(M.util.js_complete("admin_usertour_addResetLink")).catch()},y=function(){var a=document.querySelector(".tool_usertours-resettourcontainer");if(a){return a}a=document.querySelector(".logininfo");if(a){return a}a=document.querySelector("footer");if(a){return a}return document.querySelector("body")},z=function(a,b,d){if(u){d.onEnd=null;u.endTour();u=null}d.eventHandlers={afterEnd:[C],afterRender:[B]};d.tourName=d.name;delete d.name;d.template=b;d.steps=d.steps.map(function(a){if("undefined"!=typeof a.element){a.target=a.element;delete a.element}if("undefined"!=typeof a.reflex){a.moveOnClick=!!a.reflex;delete a.reflex}if("undefined"!=typeof a.content){a.body=a.content;delete a.content}return a});return new c.default(d)},A=function(a,b,c){u=z(a,b,c);return u.startTour()},B=function(a){var c=a.getStepConfig(a.getCurrentStepNumber());return b.default.call([{methodname:"tool_usertours_step_shown",args:{tourid:t,context:M.cfg.contextid,pageurl:window.location.href,stepid:c.stepid,stepindex:a.getCurrentStepNumber()}}])[0].catch(e.default.error)},C=function(a){var c=a.getStepConfig(a.getCurrentStepNumber());return b.default.call([{methodname:"tool_usertours_complete_tour",args:{tourid:t,context:M.cfg.contextid,pageurl:window.location.href,stepid:c.stepid,stepindex:a.getCurrentStepNumber()}}])[0].catch(e.default.error)},D=function(a){return b.default.call([{methodname:"tool_usertours_reset_tour",args:{tourid:a,context:M.cfg.contextid,pageurl:window.location.href}}])[0].then(function(a){if(a.startTour){w(a.startTour)}}).catch(f.default.exception)};a.resetTourState=D});
//# sourceMappingURL=usertours.min.js.map
