define(["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue","core/pending"],function(a,b,c,d,e,f,g,h){var i=function(b,c){this._regionSelector=b,this._userCompetencySelector=c,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return i.prototype._handleClick=function(c){var f=new h("report_competency/grading_popup:_handleClick"),g=a(c.target).closest(this._userCompetencySelector),i=a(g).data("competencyid"),j=a(g).data("courseid"),k=a(g).data("userid");e.debug("Clicked on cell: competencyId="+i+", courseId="+j+", userId="+k);var l=d.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:k,competencyid:i,courseid:j}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:k,competencyid:i,courseid:j}}]);a.when(l[0],l[1]).then(this._contextLoaded.bind(this)).always(f.resolve)["catch"](b.exception)},i.prototype._contextLoaded=function(d){var e=new h("report_competency/grading_popup:_contextLoaded");d.displayuser=!0,a.when(f.render("tool_lp/user_competency_summary_in_course",d),c.get_string("usercompetencysummary","report_competency")).then(function(a,b){return new g(b,a[0],f.runTemplateJS.bind(f,a[1]),this._refresh.bind(this),(!0))}.bind(this)).always(e.resolve)["catch"](b.exception)},i.prototype._refresh=function(){var c=new h("report_competency/grading_popup:_refresh"),e=a(this._regionSelector),f=e.data("courseid"),g=e.data("moduleid"),i=e.data("userid");""===g&&(g=0),d.call([{methodname:"report_competency_data_for_report",args:{courseid:f,userid:i,moduleid:g}}])[0].then(this._pageContextLoaded.bind(this)).always(c.resolve)["catch"](b.exception)},i.prototype._pageContextLoaded=function(a){var c=new h("report_competency/grading_popup:_pageContextLoaded");f.render("report_competency/report",a).then(function(a,b){f.replaceNode(this._regionSelector,a,b)}.bind(this)).always(c.resolve)["catch"](b.exception)},i.prototype._regionSelector=null,i.prototype._userCompetencySelector=null,i});